{
  "{\"filename\":\"/canvas/src/index.js\",\"env\":{\"development\":{\"plugins\":[]}},\"retainLines\":false,\"highlightCode\":true,\"suppressDeprecationMessages\":false,\"presets\":[],\"plugins\":[[[],null],[[],null],[[],null],[[],null],[[],null],[[],null],[[],null],[[],null],[[],null],[[],null],[[],null],[[],null],[[],{\"loose\":false,\"spec\":false}],[[],null],[[],null],[[],{\"spec\":false}],[[],null],[[],{\"loose\":false}],[[],null],[[],null],[[],null],[[],{\"loose\":false}],[[],{\"loose\":false}],[[],null],[[],null],[[],null],[[],{\"loose\":false}],[[],null],[[],{\"loose\":false}],[[],null],[[],null],[[],{\"loose\":false}],[[],{\"async\":false,\"asyncGenerators\":false}],[[],null],[[],null],[[],null],[[],null],[[],null],[[],null],[[],null],[[],null],[[],null],[[],null],[[],null],[[],null],[[],null],[[],null],[[],null],[[],null],[[],null],[[],null],[[],null],[[],null],[[],{\"loose\":false,\"spec\":false}],[[],null],[[],null],[[],{\"spec\":false}],[[],null],[[],{\"loose\":false}],[[],null],[[],null],[[],null],[[],{\"loose\":false}],[[],{\"loose\":false}],[[],null],[[],null],[[],null],[[],{\"loose\":false}],[[],null],[[],{\"loose\":false}],[[],null],[[],null],[[],{\"loose\":false}],[[],{\"async\":false,\"asyncGenerators\":false}]],\"ignore\":[],\"code\":true,\"metadata\":true,\"ast\":true,\"comments\":true,\"compact\":\"auto\",\"minified\":false,\"sourceRoot\":\"/canvas/src\",\"babelrc\":true,\"sourceType\":\"module\",\"moduleIds\":false,\"passPerPreset\":false,\"parserOpts\":false,\"generatorOpts\":false}:6.26.0:development": {
    "metadata": {
      "usedHelpers": [
        "extends",
        "interopRequireDefault"
      ],
      "marked": [],
      "modules": {
        "imports": [
          {
            "source": "express",
            "imported": [
              "default"
            ],
            "specifiers": [
              {
                "kind": "named",
                "imported": "default",
                "local": "express"
              }
            ]
          },
          {
            "source": "path",
            "imported": [
              "default"
            ],
            "specifiers": [
              {
                "kind": "named",
                "imported": "default",
                "local": "path"
              }
            ]
          },
          {
            "source": "../webpack.config.js",
            "imported": [
              "default"
            ],
            "specifiers": [
              {
                "kind": "named",
                "imported": "default",
                "local": "webpackConfig"
              }
            ]
          },
          {
            "source": "./app",
            "imported": [
              "default"
            ],
            "specifiers": [
              {
                "kind": "named",
                "imported": "default",
                "local": "canvas"
              }
            ]
          }
        ],
        "exports": {
          "exported": [],
          "specifiers": []
        }
      }
    },
    "options": {
      "filename": "/canvas/src/index.js",
      "filenameRelative": "/canvas/src/index.js",
      "env": {},
      "retainLines": false,
      "highlightCode": true,
      "suppressDeprecationMessages": false,
      "presets": [],
      "plugins": [
        [
          [],
          null
        ],
        [
          [],
          null
        ],
        [
          [],
          null
        ],
        [
          [],
          null
        ],
        [
          [],
          null
        ],
        [
          [],
          null
        ],
        [
          [],
          null
        ],
        [
          [],
          null
        ],
        [
          [],
          null
        ],
        [
          [],
          null
        ],
        [
          [],
          null
        ],
        [
          [],
          null
        ],
        [
          [],
          {
            "loose": false,
            "spec": false
          }
        ],
        [
          [],
          null
        ],
        [
          [],
          null
        ],
        [
          [],
          {
            "spec": false
          }
        ],
        [
          [],
          null
        ],
        [
          [],
          {
            "loose": false
          }
        ],
        [
          [],
          null
        ],
        [
          [],
          null
        ],
        [
          [],
          null
        ],
        [
          [],
          {
            "loose": false
          }
        ],
        [
          [],
          {
            "loose": false
          }
        ],
        [
          [],
          null
        ],
        [
          [],
          null
        ],
        [
          [],
          null
        ],
        [
          [],
          {
            "loose": false
          }
        ],
        [
          [],
          null
        ],
        [
          [],
          {
            "loose": false
          }
        ],
        [
          [],
          null
        ],
        [
          [],
          null
        ],
        [
          [],
          {
            "loose": false
          }
        ],
        [
          [],
          {
            "async": false,
            "asyncGenerators": false
          }
        ],
        [
          [],
          null
        ],
        [
          [],
          null
        ],
        [
          [],
          null
        ],
        [
          [],
          null
        ],
        [
          [],
          null
        ],
        [
          [],
          null
        ],
        [
          [],
          null
        ],
        [
          [],
          null
        ],
        [
          [],
          null
        ],
        [
          [],
          null
        ],
        [
          [],
          null
        ],
        [
          [],
          null
        ],
        [
          [],
          null
        ],
        [
          [],
          null
        ],
        [
          [],
          null
        ],
        [
          [],
          null
        ],
        [
          [],
          null
        ],
        [
          [],
          null
        ],
        [
          [],
          null
        ],
        [
          [],
          null
        ],
        [
          [],
          {
            "loose": false,
            "spec": false
          }
        ],
        [
          [],
          null
        ],
        [
          [],
          null
        ],
        [
          [],
          {
            "spec": false
          }
        ],
        [
          [],
          null
        ],
        [
          [],
          {
            "loose": false
          }
        ],
        [
          [],
          null
        ],
        [
          [],
          null
        ],
        [
          [],
          null
        ],
        [
          [],
          {
            "loose": false
          }
        ],
        [
          [],
          {
            "loose": false
          }
        ],
        [
          [],
          null
        ],
        [
          [],
          null
        ],
        [
          [],
          null
        ],
        [
          [],
          {
            "loose": false
          }
        ],
        [
          [],
          null
        ],
        [
          [],
          {
            "loose": false
          }
        ],
        [
          [],
          null
        ],
        [
          [],
          null
        ],
        [
          [],
          {
            "loose": false
          }
        ],
        [
          [],
          {
            "async": false,
            "asyncGenerators": false
          }
        ]
      ],
      "ignore": [],
      "code": true,
      "metadata": true,
      "ast": false,
      "comments": true,
      "compact": "auto",
      "minified": false,
      "sourceMaps": "both",
      "sourceMapTarget": "index.js",
      "sourceFileName": "index.js",
      "sourceRoot": "/canvas/src",
      "babelrc": false,
      "sourceType": "module",
      "moduleRoot": "/canvas/src",
      "moduleIds": false,
      "passPerPreset": false,
      "parserOpts": false,
      "generatorOpts": false,
      "basename": "index"
    },
    "ignored": false,
    "code": "\"use strict\";\n\nvar _extends2 = require(\"babel-runtime/helpers/extends\");\n\nvar _extends3 = _interopRequireDefault(_extends2);\n\nvar _express = require(\"express\");\n\nvar _express2 = _interopRequireDefault(_express);\n\nvar _path = require(\"path\");\n\nvar _path2 = _interopRequireDefault(_path);\n\nvar _webpackConfig = require(\"../webpack.config.js\");\n\nvar _webpackConfig2 = _interopRequireDefault(_webpackConfig);\n\nvar _app = require(\"./app\");\n\nvar _app2 = _interopRequireDefault(_app);\n\nfunction _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }\n\nvar ENV = process.env.NODE_ENV;\nvar PORT = process.env.PORT || 8000;\n\nvar app = (0, _express2.default)();\n\napp.use(function (req, res, next) {\n  res.header(\"Access-Control-Allow-Origin\", \"*\");\n  res.header(\"Access-Control-Allow-Headers\", \"Origin, X-Requested-With, Content-Type, Accept\");\n  next();\n});\n\napp.use(\"/api\", _app2.default);\n\napp.get(\"/render/:campaignId\", function (req, res) {\n  res.send({ id: req.params.campaignId });\n});\n\napp.use(\"/files\", _express2.default.static(_path2.default.join(__dirname, \"../files\")));\n\nif (ENV !== \"production\") {\n  var webpack = require(\"webpack\");\n  var webpackDev = require(\"webpack-dev-middleware\");\n  var webpackHot = require(\"webpack-hot-middleware\");\n  var compiler = webpack((0, _extends3.default)({}, _webpackConfig2.default, { mode: \"development\" }));\n  var history = require(\"connect-history-api-fallback\");\n  app.use(history());\n  app.use(webpackDev(compiler, {\n    noInfo: true,\n    publicPath: _webpackConfig2.default.output.publicPath\n  }));\n  app.use(webpackHot(compiler, {\n    log: console.log,\n    path: \"/__webpack_hmr\",\n    heartbeat: 10 * 1000\n  }));\n} else {\n  app.use(_express2.default.static(_webpackConfig2.default.output.path));\n  app.get(\"/*\", function (req, res) {\n    res.sendFile(_path2.default.join(_webpackConfig2.default.output.path, \"index.html\"));\n  });\n}\n\napp.listen(PORT, function () {\n  console.log(\"App listening on port \" + PORT);\n});\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImluZGV4LmpzIl0sIm5hbWVzIjpbIkVOViIsInByb2Nlc3MiLCJlbnYiLCJOT0RFX0VOViIsIlBPUlQiLCJhcHAiLCJ1c2UiLCJyZXEiLCJyZXMiLCJuZXh0IiwiaGVhZGVyIiwiZ2V0Iiwic2VuZCIsImlkIiwicGFyYW1zIiwiY2FtcGFpZ25JZCIsInN0YXRpYyIsImpvaW4iLCJfX2Rpcm5hbWUiLCJ3ZWJwYWNrIiwicmVxdWlyZSIsIndlYnBhY2tEZXYiLCJ3ZWJwYWNrSG90IiwiY29tcGlsZXIiLCJtb2RlIiwiaGlzdG9yeSIsIm5vSW5mbyIsInB1YmxpY1BhdGgiLCJvdXRwdXQiLCJsb2ciLCJjb25zb2xlIiwicGF0aCIsImhlYXJ0YmVhdCIsInNlbmRGaWxlIiwibGlzdGVuIl0sIm1hcHBpbmdzIjoiOzs7Ozs7QUFBQTs7OztBQUNBOzs7O0FBQ0E7Ozs7QUFDQTs7Ozs7O0FBRUEsSUFBTUEsTUFBTUMsUUFBUUMsR0FBUixDQUFZQyxRQUF4QjtBQUNBLElBQU1DLE9BQU9ILFFBQVFDLEdBQVIsQ0FBWUUsSUFBWixJQUFvQixJQUFqQzs7QUFFQSxJQUFNQyxNQUFNLHdCQUFaOztBQUVBQSxJQUFJQyxHQUFKLENBQVEsVUFBU0MsR0FBVCxFQUFjQyxHQUFkLEVBQW1CQyxJQUFuQixFQUF5QjtBQUMvQkQsTUFBSUUsTUFBSixDQUFXLDZCQUFYLEVBQTBDLEdBQTFDO0FBQ0FGLE1BQUlFLE1BQUosQ0FDRSw4QkFERixFQUVFLGdEQUZGO0FBSUFEO0FBQ0QsQ0FQRDs7QUFTQUosSUFBSUMsR0FBSixDQUFRLE1BQVI7O0FBRUFELElBQUlNLEdBQUosQ0FBUSxxQkFBUixFQUErQixVQUFDSixHQUFELEVBQU1DLEdBQU4sRUFBYztBQUMzQ0EsTUFBSUksSUFBSixDQUFTLEVBQUVDLElBQUlOLElBQUlPLE1BQUosQ0FBV0MsVUFBakIsRUFBVDtBQUNELENBRkQ7O0FBSUFWLElBQUlDLEdBQUosQ0FBUSxRQUFSLEVBQWtCLGtCQUFRVSxNQUFSLENBQWUsZUFBS0MsSUFBTCxDQUFVQyxTQUFWLEVBQXFCLFVBQXJCLENBQWYsQ0FBbEI7O0FBRUEsSUFBSWxCLFFBQVEsWUFBWixFQUEwQjtBQUN4QixNQUFNbUIsVUFBVUMsUUFBUSxTQUFSLENBQWhCO0FBQ0EsTUFBTUMsYUFBYUQsUUFBUSx3QkFBUixDQUFuQjtBQUNBLE1BQU1FLGFBQWFGLFFBQVEsd0JBQVIsQ0FBbkI7QUFDQSxNQUFNRyxXQUFXSiw4REFBNEJLLE1BQU0sYUFBbEMsSUFBakI7QUFDQSxNQUFNQyxVQUFVTCxRQUFRLDhCQUFSLENBQWhCO0FBQ0FmLE1BQUlDLEdBQUosQ0FBUW1CLFNBQVI7QUFDQXBCLE1BQUlDLEdBQUosQ0FDRWUsV0FBV0UsUUFBWCxFQUFxQjtBQUNuQkcsWUFBUSxJQURXO0FBRW5CQyxnQkFBWSx3QkFBY0MsTUFBZCxDQUFxQkQ7QUFGZCxHQUFyQixDQURGO0FBTUF0QixNQUFJQyxHQUFKLENBQ0VnQixXQUFXQyxRQUFYLEVBQXFCO0FBQ25CTSxTQUFLQyxRQUFRRCxHQURNO0FBRW5CRSxVQUFNLGdCQUZhO0FBR25CQyxlQUFXLEtBQUs7QUFIRyxHQUFyQixDQURGO0FBT0QsQ0FwQkQsTUFvQk87QUFDTDNCLE1BQUlDLEdBQUosQ0FBUSxrQkFBUVUsTUFBUixDQUFlLHdCQUFjWSxNQUFkLENBQXFCRyxJQUFwQyxDQUFSO0FBQ0ExQixNQUFJTSxHQUFKLENBQVEsSUFBUixFQUFjLFVBQUNKLEdBQUQsRUFBTUMsR0FBTixFQUFjO0FBQzFCQSxRQUFJeUIsUUFBSixDQUFhLGVBQUtoQixJQUFMLENBQVUsd0JBQWNXLE1BQWQsQ0FBcUJHLElBQS9CLEVBQXFDLFlBQXJDLENBQWI7QUFDRCxHQUZEO0FBR0Q7O0FBRUQxQixJQUFJNkIsTUFBSixDQUFXOUIsSUFBWCxFQUFpQixZQUFNO0FBQ3JCMEIsVUFBUUQsR0FBUiw0QkFBcUN6QixJQUFyQztBQUNELENBRkQiLCJmaWxlIjoiaW5kZXguanMiLCJzb3VyY2VSb290IjoiL2NhbnZhcy9zcmMiLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgZXhwcmVzcyBmcm9tIFwiZXhwcmVzc1wiO1xuaW1wb3J0IHBhdGggZnJvbSBcInBhdGhcIjtcbmltcG9ydCB3ZWJwYWNrQ29uZmlnIGZyb20gXCIuLi93ZWJwYWNrLmNvbmZpZy5qc1wiO1xuaW1wb3J0IGNhbnZhcyBmcm9tIFwiLi9hcHBcIjtcblxuY29uc3QgRU5WID0gcHJvY2Vzcy5lbnYuTk9ERV9FTlY7XG5jb25zdCBQT1JUID0gcHJvY2Vzcy5lbnYuUE9SVCB8fCA4MDAwO1xuXG5jb25zdCBhcHAgPSBleHByZXNzKCk7XG5cbmFwcC51c2UoZnVuY3Rpb24ocmVxLCByZXMsIG5leHQpIHtcbiAgcmVzLmhlYWRlcihcIkFjY2Vzcy1Db250cm9sLUFsbG93LU9yaWdpblwiLCBcIipcIik7XG4gIHJlcy5oZWFkZXIoXG4gICAgXCJBY2Nlc3MtQ29udHJvbC1BbGxvdy1IZWFkZXJzXCIsXG4gICAgXCJPcmlnaW4sIFgtUmVxdWVzdGVkLVdpdGgsIENvbnRlbnQtVHlwZSwgQWNjZXB0XCJcbiAgKTtcbiAgbmV4dCgpO1xufSk7XG5cbmFwcC51c2UoXCIvYXBpXCIsIGNhbnZhcyk7XG5cbmFwcC5nZXQoXCIvcmVuZGVyLzpjYW1wYWlnbklkXCIsIChyZXEsIHJlcykgPT4ge1xuICByZXMuc2VuZCh7IGlkOiByZXEucGFyYW1zLmNhbXBhaWduSWQgfSk7XG59KTtcblxuYXBwLnVzZShcIi9maWxlc1wiLCBleHByZXNzLnN0YXRpYyhwYXRoLmpvaW4oX19kaXJuYW1lLCBcIi4uL2ZpbGVzXCIpKSk7XG5cbmlmIChFTlYgIT09IFwicHJvZHVjdGlvblwiKSB7XG4gIGNvbnN0IHdlYnBhY2sgPSByZXF1aXJlKFwid2VicGFja1wiKTtcbiAgY29uc3Qgd2VicGFja0RldiA9IHJlcXVpcmUoXCJ3ZWJwYWNrLWRldi1taWRkbGV3YXJlXCIpO1xuICBjb25zdCB3ZWJwYWNrSG90ID0gcmVxdWlyZShcIndlYnBhY2staG90LW1pZGRsZXdhcmVcIik7XG4gIGNvbnN0IGNvbXBpbGVyID0gd2VicGFjayh7IC4uLndlYnBhY2tDb25maWcsIG1vZGU6IFwiZGV2ZWxvcG1lbnRcIiB9KTtcbiAgY29uc3QgaGlzdG9yeSA9IHJlcXVpcmUoXCJjb25uZWN0LWhpc3RvcnktYXBpLWZhbGxiYWNrXCIpO1xuICBhcHAudXNlKGhpc3RvcnkoKSk7XG4gIGFwcC51c2UoXG4gICAgd2VicGFja0Rldihjb21waWxlciwge1xuICAgICAgbm9JbmZvOiB0cnVlLFxuICAgICAgcHVibGljUGF0aDogd2VicGFja0NvbmZpZy5vdXRwdXQucHVibGljUGF0aFxuICAgIH0pXG4gICk7XG4gIGFwcC51c2UoXG4gICAgd2VicGFja0hvdChjb21waWxlciwge1xuICAgICAgbG9nOiBjb25zb2xlLmxvZyxcbiAgICAgIHBhdGg6IFwiL19fd2VicGFja19obXJcIixcbiAgICAgIGhlYXJ0YmVhdDogMTAgKiAxMDAwXG4gICAgfSlcbiAgKTtcbn0gZWxzZSB7XG4gIGFwcC51c2UoZXhwcmVzcy5zdGF0aWMod2VicGFja0NvbmZpZy5vdXRwdXQucGF0aCkpO1xuICBhcHAuZ2V0KFwiLypcIiwgKHJlcSwgcmVzKSA9PiB7XG4gICAgcmVzLnNlbmRGaWxlKHBhdGguam9pbih3ZWJwYWNrQ29uZmlnLm91dHB1dC5wYXRoLCBcImluZGV4Lmh0bWxcIikpO1xuICB9KTtcbn1cblxuYXBwLmxpc3RlbihQT1JULCAoKSA9PiB7XG4gIGNvbnNvbGUubG9nKGBBcHAgbGlzdGVuaW5nIG9uIHBvcnQgJHtQT1JUfWApO1xufSk7XG4iXX0=",
    "ast": null,
    "map": {
      "version": 3,
      "sources": [
        "index.js"
      ],
      "names": [
        "ENV",
        "process",
        "env",
        "NODE_ENV",
        "PORT",
        "app",
        "use",
        "req",
        "res",
        "next",
        "header",
        "get",
        "send",
        "id",
        "params",
        "campaignId",
        "static",
        "join",
        "__dirname",
        "webpack",
        "require",
        "webpackDev",
        "webpackHot",
        "compiler",
        "mode",
        "history",
        "noInfo",
        "publicPath",
        "output",
        "log",
        "console",
        "path",
        "heartbeat",
        "sendFile",
        "listen"
      ],
      "mappings": ";;;;;;AAAA;;;;AACA;;;;AACA;;;;AACA;;;;;;AAEA,IAAMA,MAAMC,QAAQC,GAAR,CAAYC,QAAxB;AACA,IAAMC,OAAOH,QAAQC,GAAR,CAAYE,IAAZ,IAAoB,IAAjC;;AAEA,IAAMC,MAAM,wBAAZ;;AAEAA,IAAIC,GAAJ,CAAQ,UAASC,GAAT,EAAcC,GAAd,EAAmBC,IAAnB,EAAyB;AAC/BD,MAAIE,MAAJ,CAAW,6BAAX,EAA0C,GAA1C;AACAF,MAAIE,MAAJ,CACE,8BADF,EAEE,gDAFF;AAIAD;AACD,CAPD;;AASAJ,IAAIC,GAAJ,CAAQ,MAAR;;AAEAD,IAAIM,GAAJ,CAAQ,qBAAR,EAA+B,UAACJ,GAAD,EAAMC,GAAN,EAAc;AAC3CA,MAAII,IAAJ,CAAS,EAAEC,IAAIN,IAAIO,MAAJ,CAAWC,UAAjB,EAAT;AACD,CAFD;;AAIAV,IAAIC,GAAJ,CAAQ,QAAR,EAAkB,kBAAQU,MAAR,CAAe,eAAKC,IAAL,CAAUC,SAAV,EAAqB,UAArB,CAAf,CAAlB;;AAEA,IAAIlB,QAAQ,YAAZ,EAA0B;AACxB,MAAMmB,UAAUC,QAAQ,SAAR,CAAhB;AACA,MAAMC,aAAaD,QAAQ,wBAAR,CAAnB;AACA,MAAME,aAAaF,QAAQ,wBAAR,CAAnB;AACA,MAAMG,WAAWJ,8DAA4BK,MAAM,aAAlC,IAAjB;AACA,MAAMC,UAAUL,QAAQ,8BAAR,CAAhB;AACAf,MAAIC,GAAJ,CAAQmB,SAAR;AACApB,MAAIC,GAAJ,CACEe,WAAWE,QAAX,EAAqB;AACnBG,YAAQ,IADW;AAEnBC,gBAAY,wBAAcC,MAAd,CAAqBD;AAFd,GAArB,CADF;AAMAtB,MAAIC,GAAJ,CACEgB,WAAWC,QAAX,EAAqB;AACnBM,SAAKC,QAAQD,GADM;AAEnBE,UAAM,gBAFa;AAGnBC,eAAW,KAAK;AAHG,GAArB,CADF;AAOD,CApBD,MAoBO;AACL3B,MAAIC,GAAJ,CAAQ,kBAAQU,MAAR,CAAe,wBAAcY,MAAd,CAAqBG,IAApC,CAAR;AACA1B,MAAIM,GAAJ,CAAQ,IAAR,EAAc,UAACJ,GAAD,EAAMC,GAAN,EAAc;AAC1BA,QAAIyB,QAAJ,CAAa,eAAKhB,IAAL,CAAU,wBAAcW,MAAd,CAAqBG,IAA/B,EAAqC,YAArC,CAAb;AACD,GAFD;AAGD;;AAED1B,IAAI6B,MAAJ,CAAW9B,IAAX,EAAiB,YAAM;AACrB0B,UAAQD,GAAR,4BAAqCzB,IAArC;AACD,CAFD",
      "file": "index.js",
      "sourceRoot": "/canvas/src",
      "sourcesContent": [
        "import express from \"express\";\nimport path from \"path\";\nimport webpackConfig from \"../webpack.config.js\";\nimport canvas from \"./app\";\n\nconst ENV = process.env.NODE_ENV;\nconst PORT = process.env.PORT || 8000;\n\nconst app = express();\n\napp.use(function(req, res, next) {\n  res.header(\"Access-Control-Allow-Origin\", \"*\");\n  res.header(\n    \"Access-Control-Allow-Headers\",\n    \"Origin, X-Requested-With, Content-Type, Accept\"\n  );\n  next();\n});\n\napp.use(\"/api\", canvas);\n\napp.get(\"/render/:campaignId\", (req, res) => {\n  res.send({ id: req.params.campaignId });\n});\n\napp.use(\"/files\", express.static(path.join(__dirname, \"../files\")));\n\nif (ENV !== \"production\") {\n  const webpack = require(\"webpack\");\n  const webpackDev = require(\"webpack-dev-middleware\");\n  const webpackHot = require(\"webpack-hot-middleware\");\n  const compiler = webpack({ ...webpackConfig, mode: \"development\" });\n  const history = require(\"connect-history-api-fallback\");\n  app.use(history());\n  app.use(\n    webpackDev(compiler, {\n      noInfo: true,\n      publicPath: webpackConfig.output.publicPath\n    })\n  );\n  app.use(\n    webpackHot(compiler, {\n      log: console.log,\n      path: \"/__webpack_hmr\",\n      heartbeat: 10 * 1000\n    })\n  );\n} else {\n  app.use(express.static(webpackConfig.output.path));\n  app.get(\"/*\", (req, res) => {\n    res.sendFile(path.join(webpackConfig.output.path, \"index.html\"));\n  });\n}\n\napp.listen(PORT, () => {\n  console.log(`App listening on port ${PORT}`);\n});\n"
      ]
    },
    "mtime": 1525732613000
  },
  "{\"filename\":\"/canvas/webpack.config.js\",\"env\":{\"development\":{\"plugins\":[]}},\"retainLines\":false,\"highlightCode\":true,\"suppressDeprecationMessages\":false,\"presets\":[],\"plugins\":[[[],null],[[],null],[[],null],[[],null],[[],null],[[],null],[[],null],[[],null],[[],null],[[],null],[[],null],[[],null],[[],{\"loose\":false,\"spec\":false}],[[],null],[[],null],[[],{\"spec\":false}],[[],null],[[],{\"loose\":false}],[[],null],[[],null],[[],null],[[],{\"loose\":false}],[[],{\"loose\":false}],[[],null],[[],null],[[],null],[[],{\"loose\":false}],[[],null],[[],{\"loose\":false}],[[],null],[[],null],[[],{\"loose\":false}],[[],{\"async\":false,\"asyncGenerators\":false}],[[],null],[[],null],[[],null],[[],null],[[],null],[[],null],[[],null],[[],null],[[],null],[[],null],[[],null],[[],null],[[],null],[[],null],[[],null],[[],null],[[],null],[[],null],[[],null],[[],null],[[],{\"loose\":false,\"spec\":false}],[[],null],[[],null],[[],{\"spec\":false}],[[],null],[[],{\"loose\":false}],[[],null],[[],null],[[],null],[[],{\"loose\":false}],[[],{\"loose\":false}],[[],null],[[],null],[[],null],[[],{\"loose\":false}],[[],null],[[],{\"loose\":false}],[[],null],[[],null],[[],{\"loose\":false}],[[],{\"async\":false,\"asyncGenerators\":false}]],\"ignore\":[],\"code\":true,\"metadata\":true,\"ast\":true,\"comments\":true,\"compact\":\"auto\",\"minified\":false,\"sourceRoot\":\"/canvas\",\"babelrc\":true,\"sourceType\":\"module\",\"moduleIds\":false,\"passPerPreset\":false,\"parserOpts\":false,\"generatorOpts\":false}:6.26.0:development": {
    "metadata": {
      "usedHelpers": [
        "toConsumableArray",
        "interopRequireDefault"
      ],
      "marked": [],
      "modules": {
        "imports": [],
        "exports": {
          "exported": [],
          "specifiers": []
        }
      }
    },
    "options": {
      "filename": "/canvas/webpack.config.js",
      "filenameRelative": "/canvas/webpack.config.js",
      "env": {},
      "retainLines": false,
      "highlightCode": true,
      "suppressDeprecationMessages": false,
      "presets": [],
      "plugins": [
        [
          [],
          null
        ],
        [
          [],
          null
        ],
        [
          [],
          null
        ],
        [
          [],
          null
        ],
        [
          [],
          null
        ],
        [
          [],
          null
        ],
        [
          [],
          null
        ],
        [
          [],
          null
        ],
        [
          [],
          null
        ],
        [
          [],
          null
        ],
        [
          [],
          null
        ],
        [
          [],
          null
        ],
        [
          [],
          {
            "loose": false,
            "spec": false
          }
        ],
        [
          [],
          null
        ],
        [
          [],
          null
        ],
        [
          [],
          {
            "spec": false
          }
        ],
        [
          [],
          null
        ],
        [
          [],
          {
            "loose": false
          }
        ],
        [
          [],
          null
        ],
        [
          [],
          null
        ],
        [
          [],
          null
        ],
        [
          [],
          {
            "loose": false
          }
        ],
        [
          [],
          {
            "loose": false
          }
        ],
        [
          [],
          null
        ],
        [
          [],
          null
        ],
        [
          [],
          null
        ],
        [
          [],
          {
            "loose": false
          }
        ],
        [
          [],
          null
        ],
        [
          [],
          {
            "loose": false
          }
        ],
        [
          [],
          null
        ],
        [
          [],
          null
        ],
        [
          [],
          {
            "loose": false
          }
        ],
        [
          [],
          {
            "async": false,
            "asyncGenerators": false
          }
        ],
        [
          [],
          null
        ],
        [
          [],
          null
        ],
        [
          [],
          null
        ],
        [
          [],
          null
        ],
        [
          [],
          null
        ],
        [
          [],
          null
        ],
        [
          [],
          null
        ],
        [
          [],
          null
        ],
        [
          [],
          null
        ],
        [
          [],
          null
        ],
        [
          [],
          null
        ],
        [
          [],
          null
        ],
        [
          [],
          null
        ],
        [
          [],
          null
        ],
        [
          [],
          null
        ],
        [
          [],
          null
        ],
        [
          [],
          null
        ],
        [
          [],
          null
        ],
        [
          [],
          null
        ],
        [
          [],
          null
        ],
        [
          [],
          {
            "loose": false,
            "spec": false
          }
        ],
        [
          [],
          null
        ],
        [
          [],
          null
        ],
        [
          [],
          {
            "spec": false
          }
        ],
        [
          [],
          null
        ],
        [
          [],
          {
            "loose": false
          }
        ],
        [
          [],
          null
        ],
        [
          [],
          null
        ],
        [
          [],
          null
        ],
        [
          [],
          {
            "loose": false
          }
        ],
        [
          [],
          {
            "loose": false
          }
        ],
        [
          [],
          null
        ],
        [
          [],
          null
        ],
        [
          [],
          null
        ],
        [
          [],
          {
            "loose": false
          }
        ],
        [
          [],
          null
        ],
        [
          [],
          {
            "loose": false
          }
        ],
        [
          [],
          null
        ],
        [
          [],
          null
        ],
        [
          [],
          {
            "loose": false
          }
        ],
        [
          [],
          {
            "async": false,
            "asyncGenerators": false
          }
        ]
      ],
      "ignore": [],
      "code": true,
      "metadata": true,
      "ast": false,
      "comments": true,
      "compact": "auto",
      "minified": false,
      "sourceMaps": "both",
      "sourceMapTarget": "webpack.config.js",
      "sourceFileName": "webpack.config.js",
      "sourceRoot": "/canvas",
      "babelrc": false,
      "sourceType": "module",
      "moduleRoot": "/canvas",
      "moduleIds": false,
      "passPerPreset": false,
      "parserOpts": false,
      "generatorOpts": false,
      "basename": "webpack.config"
    },
    "ignored": false,
    "code": "\"use strict\";\n\nvar _toConsumableArray2 = require(\"babel-runtime/helpers/toConsumableArray\");\n\nvar _toConsumableArray3 = _interopRequireDefault(_toConsumableArray2);\n\nfunction _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }\n\nvar path = require(\"path\");\nvar webpack = require(\"webpack\");\nvar HTMLWebpackPlugin = require(\"html-webpack-plugin\");\nvar GeneratePDF = require(\"./lib/pdf-webpack-plugin\");\n\nvar ENV = process.env.NODE_ENV;\n\nvar hotMiddlewareScript = \"webpack-hot-middleware/client?path=/__webpack_hmr&timeout=20000&reload=true\";\n\nvar entry = [\"./client/index.jsx\"];\nvar plugins = [new HTMLWebpackPlugin({\n  template: path.resolve(\"client\", \"index.html\"),\n  filename: \"index.html\",\n  inject: \"body\"\n})];\n\nif (ENV !== \"production\") {\n  plugins = [].concat((0, _toConsumableArray3.default)(plugins), [new webpack.HotModuleReplacementPlugin()]);\n  entry = [].concat((0, _toConsumableArray3.default)(entry), [hotMiddlewareScript]);\n}\n\nmodule.exports = {\n  entry: entry,\n  resolve: {\n    modules: [\"client\", \"node_modules\"]\n  },\n  output: {\n    path: path.resolve(\"public\"),\n    publicPath: \"/\",\n    filename: function filename() {\n      if (ENV == \"production\") {\n        return \"[name]-[hash].js\";\n      } else {\n        return \"[name].js\";\n      }\n    }\n  },\n  plugins: plugins,\n  module: {\n    rules: [{\n      test: /\\.js(x)?$/,\n      use: {\n        loader: \"babel-loader\"\n      },\n      exclude: /node_modules/\n    }, {\n      test: /\\.(css|less)$/,\n      use: [\"style-loader\", \"css-loader\", \"less-loader\"]\n    }, {\n      test: /\\.(sass|scss)$/,\n      use: [\"style-loader\", \"css-loader\", \"sass-loader\"]\n    }, {\n      test: /fonts\\/(.*)\\.(ttf|otf|eot|svg|woff(2)?)(\\?[a-z0-9]+)?$/,\n      use: \"file-loader?name=fonts/[name].[ext]&publicPath=./\"\n    }, {\n      test: /\\.(png|jpg|svg|gif|mp4)$/,\n      use: \"file-loader?name=assets/[name].[hash].[ext]&publicPath=./\"\n    }]\n  }\n};\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIndlYnBhY2suY29uZmlnLmpzIl0sIm5hbWVzIjpbInBhdGgiLCJyZXF1aXJlIiwid2VicGFjayIsIkhUTUxXZWJwYWNrUGx1Z2luIiwiR2VuZXJhdGVQREYiLCJFTlYiLCJwcm9jZXNzIiwiZW52IiwiTk9ERV9FTlYiLCJob3RNaWRkbGV3YXJlU2NyaXB0IiwiZW50cnkiLCJwbHVnaW5zIiwidGVtcGxhdGUiLCJyZXNvbHZlIiwiZmlsZW5hbWUiLCJpbmplY3QiLCJIb3RNb2R1bGVSZXBsYWNlbWVudFBsdWdpbiIsIm1vZHVsZSIsImV4cG9ydHMiLCJtb2R1bGVzIiwib3V0cHV0IiwicHVibGljUGF0aCIsInJ1bGVzIiwidGVzdCIsInVzZSIsImxvYWRlciIsImV4Y2x1ZGUiXSwibWFwcGluZ3MiOiI7Ozs7Ozs7O0FBQUEsSUFBTUEsT0FBT0MsUUFBUSxNQUFSLENBQWI7QUFDQSxJQUFNQyxVQUFVRCxRQUFRLFNBQVIsQ0FBaEI7QUFDQSxJQUFNRSxvQkFBb0JGLFFBQVEscUJBQVIsQ0FBMUI7QUFDQSxJQUFNRyxjQUFjSCxRQUFRLDBCQUFSLENBQXBCOztBQUVBLElBQU1JLE1BQU1DLFFBQVFDLEdBQVIsQ0FBWUMsUUFBeEI7O0FBRUEsSUFBTUMsc0JBQ0osNkVBREY7O0FBR0EsSUFBSUMsUUFBUSxDQUFDLG9CQUFELENBQVo7QUFDQSxJQUFJQyxVQUFVLENBQ1osSUFBSVIsaUJBQUosQ0FBc0I7QUFDcEJTLFlBQVVaLEtBQUthLE9BQUwsQ0FBYSxRQUFiLEVBQXVCLFlBQXZCLENBRFU7QUFFcEJDLFlBQVUsWUFGVTtBQUdwQkMsVUFBUTtBQUhZLENBQXRCLENBRFksQ0FBZDs7QUFRQSxJQUFJVixRQUFRLFlBQVosRUFBMEI7QUFDeEJNLHVEQUFjQSxPQUFkLElBQXVCLElBQUlULFFBQVFjLDBCQUFaLEVBQXZCO0FBQ0FOLHFEQUFZQSxLQUFaLElBQW1CRCxtQkFBbkI7QUFDRDs7QUFFRFEsT0FBT0MsT0FBUCxHQUFpQjtBQUNmUixjQURlO0FBRWZHLFdBQVM7QUFDUE0sYUFBUyxDQUFDLFFBQUQsRUFBVyxjQUFYO0FBREYsR0FGTTtBQUtmQyxVQUFRO0FBQ05wQixVQUFNQSxLQUFLYSxPQUFMLENBQWEsUUFBYixDQURBO0FBRU5RLGdCQUFZLEdBRk47QUFHTlAsY0FBVSxvQkFBa0I7QUFDMUIsVUFBSVQsT0FBTyxZQUFYLEVBQXlCO0FBQ3ZCLGVBQU8sa0JBQVA7QUFDRCxPQUZELE1BRU87QUFDTCxlQUFPLFdBQVA7QUFDRDtBQUNGO0FBVEssR0FMTztBQWdCZk0sa0JBaEJlO0FBaUJmTSxVQUFRO0FBQ05LLFdBQU8sQ0FDTDtBQUNFQyxZQUFNLFdBRFI7QUFFRUMsV0FBSztBQUNIQyxnQkFBUTtBQURMLE9BRlA7QUFLRUMsZUFBUztBQUxYLEtBREssRUFRTDtBQUNFSCxZQUFNLGVBRFI7QUFFRUMsV0FBSyxDQUFDLGNBQUQsRUFBaUIsWUFBakIsRUFBK0IsYUFBL0I7QUFGUCxLQVJLLEVBWUw7QUFDRUQsWUFBTSxnQkFEUjtBQUVFQyxXQUFLLENBQUMsY0FBRCxFQUFpQixZQUFqQixFQUErQixhQUEvQjtBQUZQLEtBWkssRUFnQkw7QUFDRUQsWUFBTSx3REFEUjtBQUVFQyxXQUFLO0FBRlAsS0FoQkssRUFvQkw7QUFDRUQsWUFBTSwwQkFEUjtBQUVFQyxXQUFLO0FBRlAsS0FwQks7QUFERDtBQWpCTyxDQUFqQiIsImZpbGUiOiJ3ZWJwYWNrLmNvbmZpZy5qcyIsInNvdXJjZVJvb3QiOiIvY2FudmFzIiwic291cmNlc0NvbnRlbnQiOlsiY29uc3QgcGF0aCA9IHJlcXVpcmUoXCJwYXRoXCIpO1xuY29uc3Qgd2VicGFjayA9IHJlcXVpcmUoXCJ3ZWJwYWNrXCIpO1xuY29uc3QgSFRNTFdlYnBhY2tQbHVnaW4gPSByZXF1aXJlKFwiaHRtbC13ZWJwYWNrLXBsdWdpblwiKTtcbmNvbnN0IEdlbmVyYXRlUERGID0gcmVxdWlyZShcIi4vbGliL3BkZi13ZWJwYWNrLXBsdWdpblwiKTtcblxuY29uc3QgRU5WID0gcHJvY2Vzcy5lbnYuTk9ERV9FTlY7XG5cbmNvbnN0IGhvdE1pZGRsZXdhcmVTY3JpcHQgPVxuICBcIndlYnBhY2staG90LW1pZGRsZXdhcmUvY2xpZW50P3BhdGg9L19fd2VicGFja19obXImdGltZW91dD0yMDAwMCZyZWxvYWQ9dHJ1ZVwiO1xuXG5sZXQgZW50cnkgPSBbXCIuL2NsaWVudC9pbmRleC5qc3hcIl07XG5sZXQgcGx1Z2lucyA9IFtcbiAgbmV3IEhUTUxXZWJwYWNrUGx1Z2luKHtcbiAgICB0ZW1wbGF0ZTogcGF0aC5yZXNvbHZlKFwiY2xpZW50XCIsIFwiaW5kZXguaHRtbFwiKSxcbiAgICBmaWxlbmFtZTogXCJpbmRleC5odG1sXCIsXG4gICAgaW5qZWN0OiBcImJvZHlcIlxuICB9KVxuXTtcblxuaWYgKEVOViAhPT0gXCJwcm9kdWN0aW9uXCIpIHtcbiAgcGx1Z2lucyA9IFsuLi5wbHVnaW5zLCBuZXcgd2VicGFjay5Ib3RNb2R1bGVSZXBsYWNlbWVudFBsdWdpbigpXTtcbiAgZW50cnkgPSBbLi4uZW50cnksIGhvdE1pZGRsZXdhcmVTY3JpcHRdO1xufVxuXG5tb2R1bGUuZXhwb3J0cyA9IHtcbiAgZW50cnksXG4gIHJlc29sdmU6IHtcbiAgICBtb2R1bGVzOiBbXCJjbGllbnRcIiwgXCJub2RlX21vZHVsZXNcIl1cbiAgfSxcbiAgb3V0cHV0OiB7XG4gICAgcGF0aDogcGF0aC5yZXNvbHZlKFwicHVibGljXCIpLFxuICAgIHB1YmxpY1BhdGg6IFwiL1wiLFxuICAgIGZpbGVuYW1lOiBmdW5jdGlvbiguLi5hcmdzKSB7XG4gICAgICBpZiAoRU5WID09IFwicHJvZHVjdGlvblwiKSB7XG4gICAgICAgIHJldHVybiBcIltuYW1lXS1baGFzaF0uanNcIjtcbiAgICAgIH0gZWxzZSB7XG4gICAgICAgIHJldHVybiBcIltuYW1lXS5qc1wiO1xuICAgICAgfVxuICAgIH1cbiAgfSxcbiAgcGx1Z2lucyxcbiAgbW9kdWxlOiB7XG4gICAgcnVsZXM6IFtcbiAgICAgIHtcbiAgICAgICAgdGVzdDogL1xcLmpzKHgpPyQvLFxuICAgICAgICB1c2U6IHtcbiAgICAgICAgICBsb2FkZXI6IFwiYmFiZWwtbG9hZGVyXCJcbiAgICAgICAgfSxcbiAgICAgICAgZXhjbHVkZTogL25vZGVfbW9kdWxlcy9cbiAgICAgIH0sXG4gICAgICB7XG4gICAgICAgIHRlc3Q6IC9cXC4oY3NzfGxlc3MpJC8sXG4gICAgICAgIHVzZTogW1wic3R5bGUtbG9hZGVyXCIsIFwiY3NzLWxvYWRlclwiLCBcImxlc3MtbG9hZGVyXCJdXG4gICAgICB9LFxuICAgICAge1xuICAgICAgICB0ZXN0OiAvXFwuKHNhc3N8c2NzcykkLyxcbiAgICAgICAgdXNlOiBbXCJzdHlsZS1sb2FkZXJcIiwgXCJjc3MtbG9hZGVyXCIsIFwic2Fzcy1sb2FkZXJcIl1cbiAgICAgIH0sXG4gICAgICB7XG4gICAgICAgIHRlc3Q6IC9mb250c1xcLyguKilcXC4odHRmfG90Znxlb3R8c3ZnfHdvZmYoMik/KShcXD9bYS16MC05XSspPyQvLFxuICAgICAgICB1c2U6IFwiZmlsZS1sb2FkZXI/bmFtZT1mb250cy9bbmFtZV0uW2V4dF0mcHVibGljUGF0aD0uL1wiXG4gICAgICB9LFxuICAgICAge1xuICAgICAgICB0ZXN0OiAvXFwuKHBuZ3xqcGd8c3ZnfGdpZnxtcDQpJC8sXG4gICAgICAgIHVzZTogXCJmaWxlLWxvYWRlcj9uYW1lPWFzc2V0cy9bbmFtZV0uW2hhc2hdLltleHRdJnB1YmxpY1BhdGg9Li9cIlxuICAgICAgfVxuICAgIF1cbiAgfVxufTtcbiJdfQ==",
    "ast": null,
    "map": {
      "version": 3,
      "sources": [
        "webpack.config.js"
      ],
      "names": [
        "path",
        "require",
        "webpack",
        "HTMLWebpackPlugin",
        "GeneratePDF",
        "ENV",
        "process",
        "env",
        "NODE_ENV",
        "hotMiddlewareScript",
        "entry",
        "plugins",
        "template",
        "resolve",
        "filename",
        "inject",
        "HotModuleReplacementPlugin",
        "module",
        "exports",
        "modules",
        "output",
        "publicPath",
        "rules",
        "test",
        "use",
        "loader",
        "exclude"
      ],
      "mappings": ";;;;;;;;AAAA,IAAMA,OAAOC,QAAQ,MAAR,CAAb;AACA,IAAMC,UAAUD,QAAQ,SAAR,CAAhB;AACA,IAAME,oBAAoBF,QAAQ,qBAAR,CAA1B;AACA,IAAMG,cAAcH,QAAQ,0BAAR,CAApB;;AAEA,IAAMI,MAAMC,QAAQC,GAAR,CAAYC,QAAxB;;AAEA,IAAMC,sBACJ,6EADF;;AAGA,IAAIC,QAAQ,CAAC,oBAAD,CAAZ;AACA,IAAIC,UAAU,CACZ,IAAIR,iBAAJ,CAAsB;AACpBS,YAAUZ,KAAKa,OAAL,CAAa,QAAb,EAAuB,YAAvB,CADU;AAEpBC,YAAU,YAFU;AAGpBC,UAAQ;AAHY,CAAtB,CADY,CAAd;;AAQA,IAAIV,QAAQ,YAAZ,EAA0B;AACxBM,uDAAcA,OAAd,IAAuB,IAAIT,QAAQc,0BAAZ,EAAvB;AACAN,qDAAYA,KAAZ,IAAmBD,mBAAnB;AACD;;AAEDQ,OAAOC,OAAP,GAAiB;AACfR,cADe;AAEfG,WAAS;AACPM,aAAS,CAAC,QAAD,EAAW,cAAX;AADF,GAFM;AAKfC,UAAQ;AACNpB,UAAMA,KAAKa,OAAL,CAAa,QAAb,CADA;AAENQ,gBAAY,GAFN;AAGNP,cAAU,oBAAkB;AAC1B,UAAIT,OAAO,YAAX,EAAyB;AACvB,eAAO,kBAAP;AACD,OAFD,MAEO;AACL,eAAO,WAAP;AACD;AACF;AATK,GALO;AAgBfM,kBAhBe;AAiBfM,UAAQ;AACNK,WAAO,CACL;AACEC,YAAM,WADR;AAEEC,WAAK;AACHC,gBAAQ;AADL,OAFP;AAKEC,eAAS;AALX,KADK,EAQL;AACEH,YAAM,eADR;AAEEC,WAAK,CAAC,cAAD,EAAiB,YAAjB,EAA+B,aAA/B;AAFP,KARK,EAYL;AACED,YAAM,gBADR;AAEEC,WAAK,CAAC,cAAD,EAAiB,YAAjB,EAA+B,aAA/B;AAFP,KAZK,EAgBL;AACED,YAAM,wDADR;AAEEC,WAAK;AAFP,KAhBK,EAoBL;AACED,YAAM,0BADR;AAEEC,WAAK;AAFP,KApBK;AADD;AAjBO,CAAjB",
      "file": "webpack.config.js",
      "sourceRoot": "/canvas",
      "sourcesContent": [
        "const path = require(\"path\");\nconst webpack = require(\"webpack\");\nconst HTMLWebpackPlugin = require(\"html-webpack-plugin\");\nconst GeneratePDF = require(\"./lib/pdf-webpack-plugin\");\n\nconst ENV = process.env.NODE_ENV;\n\nconst hotMiddlewareScript =\n  \"webpack-hot-middleware/client?path=/__webpack_hmr&timeout=20000&reload=true\";\n\nlet entry = [\"./client/index.jsx\"];\nlet plugins = [\n  new HTMLWebpackPlugin({\n    template: path.resolve(\"client\", \"index.html\"),\n    filename: \"index.html\",\n    inject: \"body\"\n  })\n];\n\nif (ENV !== \"production\") {\n  plugins = [...plugins, new webpack.HotModuleReplacementPlugin()];\n  entry = [...entry, hotMiddlewareScript];\n}\n\nmodule.exports = {\n  entry,\n  resolve: {\n    modules: [\"client\", \"node_modules\"]\n  },\n  output: {\n    path: path.resolve(\"public\"),\n    publicPath: \"/\",\n    filename: function(...args) {\n      if (ENV == \"production\") {\n        return \"[name]-[hash].js\";\n      } else {\n        return \"[name].js\";\n      }\n    }\n  },\n  plugins,\n  module: {\n    rules: [\n      {\n        test: /\\.js(x)?$/,\n        use: {\n          loader: \"babel-loader\"\n        },\n        exclude: /node_modules/\n      },\n      {\n        test: /\\.(css|less)$/,\n        use: [\"style-loader\", \"css-loader\", \"less-loader\"]\n      },\n      {\n        test: /\\.(sass|scss)$/,\n        use: [\"style-loader\", \"css-loader\", \"sass-loader\"]\n      },\n      {\n        test: /fonts\\/(.*)\\.(ttf|otf|eot|svg|woff(2)?)(\\?[a-z0-9]+)?$/,\n        use: \"file-loader?name=fonts/[name].[ext]&publicPath=./\"\n      },\n      {\n        test: /\\.(png|jpg|svg|gif|mp4)$/,\n        use: \"file-loader?name=assets/[name].[hash].[ext]&publicPath=./\"\n      }\n    ]\n  }\n};\n"
      ]
    },
    "mtime": 1525787134000
  },
  "{\"filename\":\"/canvas/lib/pdf-webpack-plugin.js\",\"env\":{\"development\":{\"plugins\":[]}},\"retainLines\":false,\"highlightCode\":true,\"suppressDeprecationMessages\":false,\"presets\":[],\"plugins\":[[[],null],[[],null],[[],null],[[],null],[[],null],[[],null],[[],null],[[],null],[[],null],[[],null],[[],null],[[],null],[[],{\"loose\":false,\"spec\":false}],[[],null],[[],null],[[],{\"spec\":false}],[[],null],[[],{\"loose\":false}],[[],null],[[],null],[[],null],[[],{\"loose\":false}],[[],{\"loose\":false}],[[],null],[[],null],[[],null],[[],{\"loose\":false}],[[],null],[[],{\"loose\":false}],[[],null],[[],null],[[],{\"loose\":false}],[[],{\"async\":false,\"asyncGenerators\":false}],[[],null],[[],null],[[],null],[[],null],[[],null],[[],null],[[],null],[[],null],[[],null],[[],null],[[],null],[[],null],[[],null],[[],null],[[],null],[[],null],[[],null],[[],null],[[],null],[[],null],[[],{\"loose\":false,\"spec\":false}],[[],null],[[],null],[[],{\"spec\":false}],[[],null],[[],{\"loose\":false}],[[],null],[[],null],[[],null],[[],{\"loose\":false}],[[],{\"loose\":false}],[[],null],[[],null],[[],null],[[],{\"loose\":false}],[[],null],[[],{\"loose\":false}],[[],null],[[],null],[[],{\"loose\":false}],[[],{\"async\":false,\"asyncGenerators\":false}]],\"ignore\":[],\"code\":true,\"metadata\":true,\"ast\":true,\"comments\":true,\"compact\":\"auto\",\"minified\":false,\"sourceRoot\":\"/canvas/lib\",\"babelrc\":true,\"sourceType\":\"module\",\"moduleIds\":false,\"passPerPreset\":false,\"parserOpts\":false,\"generatorOpts\":false}:6.26.0:development": {
    "metadata": {
      "usedHelpers": [
        "createClass",
        "classCallCheck",
        "asyncToGenerator",
        "interopRequireDefault"
      ],
      "marked": [],
      "modules": {
        "imports": [],
        "exports": {
          "exported": [],
          "specifiers": []
        }
      }
    },
    "options": {
      "filename": "/canvas/lib/pdf-webpack-plugin.js",
      "filenameRelative": "/canvas/lib/pdf-webpack-plugin.js",
      "env": {},
      "retainLines": false,
      "highlightCode": true,
      "suppressDeprecationMessages": false,
      "presets": [],
      "plugins": [
        [
          [],
          null
        ],
        [
          [],
          null
        ],
        [
          [],
          null
        ],
        [
          [],
          null
        ],
        [
          [],
          null
        ],
        [
          [],
          null
        ],
        [
          [],
          null
        ],
        [
          [],
          null
        ],
        [
          [],
          null
        ],
        [
          [],
          null
        ],
        [
          [],
          null
        ],
        [
          [],
          null
        ],
        [
          [],
          {
            "loose": false,
            "spec": false
          }
        ],
        [
          [],
          null
        ],
        [
          [],
          null
        ],
        [
          [],
          {
            "spec": false
          }
        ],
        [
          [],
          null
        ],
        [
          [],
          {
            "loose": false
          }
        ],
        [
          [],
          null
        ],
        [
          [],
          null
        ],
        [
          [],
          null
        ],
        [
          [],
          {
            "loose": false
          }
        ],
        [
          [],
          {
            "loose": false
          }
        ],
        [
          [],
          null
        ],
        [
          [],
          null
        ],
        [
          [],
          null
        ],
        [
          [],
          {
            "loose": false
          }
        ],
        [
          [],
          null
        ],
        [
          [],
          {
            "loose": false
          }
        ],
        [
          [],
          null
        ],
        [
          [],
          null
        ],
        [
          [],
          {
            "loose": false
          }
        ],
        [
          [],
          {
            "async": false,
            "asyncGenerators": false
          }
        ],
        [
          [],
          null
        ],
        [
          [],
          null
        ],
        [
          [],
          null
        ],
        [
          [],
          null
        ],
        [
          [],
          null
        ],
        [
          [],
          null
        ],
        [
          [],
          null
        ],
        [
          [],
          null
        ],
        [
          [],
          null
        ],
        [
          [],
          null
        ],
        [
          [],
          null
        ],
        [
          [],
          null
        ],
        [
          [],
          null
        ],
        [
          [],
          null
        ],
        [
          [],
          null
        ],
        [
          [],
          null
        ],
        [
          [],
          null
        ],
        [
          [],
          null
        ],
        [
          [],
          null
        ],
        [
          [],
          null
        ],
        [
          [],
          {
            "loose": false,
            "spec": false
          }
        ],
        [
          [],
          null
        ],
        [
          [],
          null
        ],
        [
          [],
          {
            "spec": false
          }
        ],
        [
          [],
          null
        ],
        [
          [],
          {
            "loose": false
          }
        ],
        [
          [],
          null
        ],
        [
          [],
          null
        ],
        [
          [],
          null
        ],
        [
          [],
          {
            "loose": false
          }
        ],
        [
          [],
          {
            "loose": false
          }
        ],
        [
          [],
          null
        ],
        [
          [],
          null
        ],
        [
          [],
          null
        ],
        [
          [],
          {
            "loose": false
          }
        ],
        [
          [],
          null
        ],
        [
          [],
          {
            "loose": false
          }
        ],
        [
          [],
          null
        ],
        [
          [],
          null
        ],
        [
          [],
          {
            "loose": false
          }
        ],
        [
          [],
          {
            "async": false,
            "asyncGenerators": false
          }
        ]
      ],
      "ignore": [],
      "code": true,
      "metadata": true,
      "ast": false,
      "comments": true,
      "compact": "auto",
      "minified": false,
      "sourceMaps": "both",
      "sourceMapTarget": "pdf-webpack-plugin.js",
      "sourceFileName": "pdf-webpack-plugin.js",
      "sourceRoot": "/canvas/lib",
      "babelrc": false,
      "sourceType": "module",
      "moduleRoot": "/canvas/lib",
      "moduleIds": false,
      "passPerPreset": false,
      "parserOpts": false,
      "generatorOpts": false,
      "basename": "pdf-webpack-plugin"
    },
    "ignored": false,
    "code": "\"use strict\";\n\nvar _regenerator = require(\"babel-runtime/regenerator\");\n\nvar _regenerator2 = _interopRequireDefault(_regenerator);\n\nvar _asyncToGenerator2 = require(\"babel-runtime/helpers/asyncToGenerator\");\n\nvar _asyncToGenerator3 = _interopRequireDefault(_asyncToGenerator2);\n\nvar _classCallCheck2 = require(\"babel-runtime/helpers/classCallCheck\");\n\nvar _classCallCheck3 = _interopRequireDefault(_classCallCheck2);\n\nvar _createClass2 = require(\"babel-runtime/helpers/createClass\");\n\nvar _createClass3 = _interopRequireDefault(_createClass2);\n\nfunction _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }\n\nvar puppeteer = require(\"puppeteer\");\nvar _ = require(\"underscore\");\nvar path = require(\"path\");\n\nvar GeneratePDF = function () {\n  function GeneratePDF(options) {\n    (0, _classCallCheck3.default)(this, GeneratePDF);\n\n    this.options = _.extend({\n      path: undefined,\n      filename: \"file.pdf\",\n      format: \"A4\",\n      scale: 1,\n      printBackground: true,\n      landscape: false,\n      content: \"\"\n    }, options);\n  }\n\n  (0, _createClass3.default)(GeneratePDF, [{\n    key: \"apply\",\n    value: function apply(compiler) {\n      var _this = this;\n\n      var options = this.options;\n      compiler.hooks.done.tap(\"GeneratePDF\", function (stats) {\n        var _stats$compilation = stats.compilation,\n            assets = _stats$compilation.assets,\n            outputOptions = _stats$compilation.outputOptions;\n\n        (0, _asyncToGenerator3.default)( /*#__PURE__*/_regenerator2.default.mark(function _callee() {\n          var browser, page, html, key;\n          return _regenerator2.default.wrap(function _callee$(_context) {\n            while (1) {\n              switch (_context.prev = _context.next) {\n                case 0:\n                  _context.next = 2;\n                  return puppeteer.launch({\n                    args: [\"--no-sandbox\", \"--disable-setuid-sandbox\"]\n                  });\n\n                case 2:\n                  browser = _context.sent;\n                  _context.next = 5;\n                  return browser.newPage();\n\n                case 5:\n                  page = _context.sent;\n\n                  if (!options.content) {\n                    _context.next = 20;\n                    break;\n                  }\n\n                  html = \"<!DOCTYPE html><html><head><meta charset=\\\"utf-8\\\"></head><body>\" + options.content + \"</body></html>\";\n                  _context.next = 10;\n                  return page.setContent(html);\n\n                case 10:\n                  _context.t0 = _regenerator2.default.keys(assets);\n\n                case 11:\n                  if ((_context.t1 = _context.t0()).done) {\n                    _context.next = 18;\n                    break;\n                  }\n\n                  key = _context.t1.value;\n\n                  if (!(path.extname(key) == \".js\")) {\n                    _context.next = 16;\n                    break;\n                  }\n\n                  _context.next = 16;\n                  return page.addScriptTag({ path: assets[key].existsAt });\n\n                case 16:\n                  _context.next = 11;\n                  break;\n\n                case 18:\n                  _context.next = 33;\n                  break;\n\n                case 20:\n                  _context.t2 = _regenerator2.default.keys(assets);\n\n                case 21:\n                  if ((_context.t3 = _context.t2()).done) {\n                    _context.next = 33;\n                    break;\n                  }\n\n                  key = _context.t3.value;\n\n                  if (!(path.extname(key) == \".html\")) {\n                    _context.next = 28;\n                    break;\n                  }\n\n                  _context.next = 26;\n                  return page.goto(\"file://\" + assets[key].existsAt);\n\n                case 26:\n                  _context.next = 31;\n                  break;\n\n                case 28:\n                  if (!(path.extname(key) == \".js\")) {\n                    _context.next = 31;\n                    break;\n                  }\n\n                  _context.next = 31;\n                  return page.addScriptTag({ path: assets[key].existsAt });\n\n                case 31:\n                  _context.next = 21;\n                  break;\n\n                case 33:\n                  _context.next = 35;\n                  return page.setViewport({\n                    width: 800,\n                    height: 600,\n                    deviceScaleFactor: 2\n                  });\n\n                case 35:\n                  _context.next = 37;\n                  return page.pdf({\n                    path: options.path || outputOptions.path + \"/\" + options.filename,\n                    format: options.format,\n                    scale: options.scale,\n                    landscape: options.landscape,\n                    printBackground: options.printBackground\n                  });\n\n                case 37:\n                  _context.next = 39;\n                  return browser.close();\n\n                case 39:\n                case \"end\":\n                  return _context.stop();\n              }\n            }\n          }, _callee, _this);\n        }))();\n      });\n    }\n  }]);\n  return GeneratePDF;\n}();\n\nmodule.exports = GeneratePDF;\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbInBkZi13ZWJwYWNrLXBsdWdpbi5qcyJdLCJuYW1lcyI6WyJwdXBwZXRlZXIiLCJyZXF1aXJlIiwiXyIsInBhdGgiLCJHZW5lcmF0ZVBERiIsIm9wdGlvbnMiLCJleHRlbmQiLCJ1bmRlZmluZWQiLCJmaWxlbmFtZSIsImZvcm1hdCIsInNjYWxlIiwicHJpbnRCYWNrZ3JvdW5kIiwibGFuZHNjYXBlIiwiY29udGVudCIsImNvbXBpbGVyIiwiaG9va3MiLCJkb25lIiwidGFwIiwic3RhdHMiLCJjb21waWxhdGlvbiIsImFzc2V0cyIsIm91dHB1dE9wdGlvbnMiLCJsYXVuY2giLCJhcmdzIiwiYnJvd3NlciIsIm5ld1BhZ2UiLCJwYWdlIiwiaHRtbCIsInNldENvbnRlbnQiLCJrZXkiLCJleHRuYW1lIiwiYWRkU2NyaXB0VGFnIiwiZXhpc3RzQXQiLCJnb3RvIiwic2V0Vmlld3BvcnQiLCJ3aWR0aCIsImhlaWdodCIsImRldmljZVNjYWxlRmFjdG9yIiwicGRmIiwiY2xvc2UiLCJtb2R1bGUiLCJleHBvcnRzIl0sIm1hcHBpbmdzIjoiOzs7Ozs7Ozs7Ozs7Ozs7Ozs7OztBQUFBLElBQU1BLFlBQVlDLFFBQVEsV0FBUixDQUFsQjtBQUNBLElBQU1DLElBQUlELFFBQVEsWUFBUixDQUFWO0FBQ0EsSUFBTUUsT0FBT0YsUUFBUSxNQUFSLENBQWI7O0lBRU1HLFc7QUFDSix1QkFBWUMsT0FBWixFQUFxQjtBQUFBOztBQUNuQixTQUFLQSxPQUFMLEdBQWVILEVBQUVJLE1BQUYsQ0FDYjtBQUNFSCxZQUFNSSxTQURSO0FBRUVDLGdCQUFVLFVBRlo7QUFHRUMsY0FBUSxJQUhWO0FBSUVDLGFBQU8sQ0FKVDtBQUtFQyx1QkFBaUIsSUFMbkI7QUFNRUMsaUJBQVcsS0FOYjtBQU9FQyxlQUFTO0FBUFgsS0FEYSxFQVViUixPQVZhLENBQWY7QUFZRDs7OzswQkFDS1MsUSxFQUFVO0FBQUE7O0FBQ2QsVUFBTVQsVUFBVSxLQUFLQSxPQUFyQjtBQUNBUyxlQUFTQyxLQUFULENBQWVDLElBQWYsQ0FBb0JDLEdBQXBCLENBQXdCLGFBQXhCLEVBQXVDLGlCQUFTO0FBQUEsaUNBQ1pDLE1BQU1DLFdBRE07QUFBQSxZQUN0Q0MsTUFEc0Msc0JBQ3RDQSxNQURzQztBQUFBLFlBQzlCQyxhQUQ4QixzQkFDOUJBLGFBRDhCOztBQUU5QyxpRkFBQztBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBLHlCQUN1QnJCLFVBQVVzQixNQUFWLENBQWlCO0FBQ3JDQywwQkFBTSxDQUFDLGNBQUQsRUFBaUIsMEJBQWpCO0FBRCtCLG1CQUFqQixDQUR2Qjs7QUFBQTtBQUNPQyx5QkFEUDtBQUFBO0FBQUEseUJBSW9CQSxRQUFRQyxPQUFSLEVBSnBCOztBQUFBO0FBSU9DLHNCQUpQOztBQUFBLHVCQUtLckIsUUFBUVEsT0FMYjtBQUFBO0FBQUE7QUFBQTs7QUFNU2Msc0JBTlQsd0VBT0t0QixRQUFRUSxPQVBiO0FBQUE7QUFBQSx5QkFTU2EsS0FBS0UsVUFBTCxDQUFnQkQsSUFBaEIsQ0FUVDs7QUFBQTtBQUFBLDJEQVVtQlAsTUFWbkI7O0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTs7QUFVWVMscUJBVlo7O0FBQUEsd0JBV1MxQixLQUFLMkIsT0FBTCxDQUFhRCxHQUFiLEtBQXFCLEtBWDlCO0FBQUE7QUFBQTtBQUFBOztBQUFBO0FBQUEseUJBWWFILEtBQUtLLFlBQUwsQ0FBa0IsRUFBRTVCLE1BQU1pQixPQUFPUyxHQUFQLEVBQVlHLFFBQXBCLEVBQWxCLENBWmI7O0FBQUE7QUFBQTtBQUFBOztBQUFBO0FBQUE7QUFBQTs7QUFBQTtBQUFBLDJEQWdCbUJaLE1BaEJuQjs7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBOztBQWdCWVMscUJBaEJaOztBQUFBLHdCQWlCUzFCLEtBQUsyQixPQUFMLENBQWFELEdBQWIsS0FBcUIsT0FqQjlCO0FBQUE7QUFBQTtBQUFBOztBQUFBO0FBQUEseUJBa0JhSCxLQUFLTyxJQUFMLENBQVUsWUFBWWIsT0FBT1MsR0FBUCxFQUFZRyxRQUFsQyxDQWxCYjs7QUFBQTtBQUFBO0FBQUE7O0FBQUE7QUFBQSx3QkFtQmdCN0IsS0FBSzJCLE9BQUwsQ0FBYUQsR0FBYixLQUFxQixLQW5CckM7QUFBQTtBQUFBO0FBQUE7O0FBQUE7QUFBQSx5QkFvQmFILEtBQUtLLFlBQUwsQ0FBa0IsRUFBRTVCLE1BQU1pQixPQUFPUyxHQUFQLEVBQVlHLFFBQXBCLEVBQWxCLENBcEJiOztBQUFBO0FBQUE7QUFBQTs7QUFBQTtBQUFBO0FBQUEseUJBd0JPTixLQUFLUSxXQUFMLENBQWlCO0FBQ3JCQywyQkFBTyxHQURjO0FBRXJCQyw0QkFBUSxHQUZhO0FBR3JCQyx1Q0FBbUI7QUFIRSxtQkFBakIsQ0F4QlA7O0FBQUE7QUFBQTtBQUFBLHlCQTZCT1gsS0FBS1ksR0FBTCxDQUFTO0FBQ2JuQywwQkFBTUUsUUFBUUYsSUFBUixJQUFtQmtCLGNBQWNsQixJQUFqQyxTQUF5Q0UsUUFBUUcsUUFEMUM7QUFFYkMsNEJBQVFKLFFBQVFJLE1BRkg7QUFHYkMsMkJBQU9MLFFBQVFLLEtBSEY7QUFJYkUsK0JBQVdQLFFBQVFPLFNBSk47QUFLYkQscUNBQWlCTixRQUFRTTtBQUxaLG1CQUFULENBN0JQOztBQUFBO0FBQUE7QUFBQSx5QkFvQ09hLFFBQVFlLEtBQVIsRUFwQ1A7O0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUEsU0FBRDtBQXNDRCxPQXhDRDtBQXlDRDs7Ozs7QUFHSEMsT0FBT0MsT0FBUCxHQUFpQnJDLFdBQWpCIiwiZmlsZSI6InBkZi13ZWJwYWNrLXBsdWdpbi5qcyIsInNvdXJjZVJvb3QiOiIvY2FudmFzL2xpYiIsInNvdXJjZXNDb250ZW50IjpbImNvbnN0IHB1cHBldGVlciA9IHJlcXVpcmUoXCJwdXBwZXRlZXJcIik7XG5jb25zdCBfID0gcmVxdWlyZShcInVuZGVyc2NvcmVcIik7XG5jb25zdCBwYXRoID0gcmVxdWlyZShcInBhdGhcIik7XG5cbmNsYXNzIEdlbmVyYXRlUERGIHtcbiAgY29uc3RydWN0b3Iob3B0aW9ucykge1xuICAgIHRoaXMub3B0aW9ucyA9IF8uZXh0ZW5kKFxuICAgICAge1xuICAgICAgICBwYXRoOiB1bmRlZmluZWQsXG4gICAgICAgIGZpbGVuYW1lOiBcImZpbGUucGRmXCIsXG4gICAgICAgIGZvcm1hdDogXCJBNFwiLFxuICAgICAgICBzY2FsZTogMSxcbiAgICAgICAgcHJpbnRCYWNrZ3JvdW5kOiB0cnVlLFxuICAgICAgICBsYW5kc2NhcGU6IGZhbHNlLFxuICAgICAgICBjb250ZW50OiBcIlwiXG4gICAgICB9LFxuICAgICAgb3B0aW9uc1xuICAgICk7XG4gIH1cbiAgYXBwbHkoY29tcGlsZXIpIHtcbiAgICBjb25zdCBvcHRpb25zID0gdGhpcy5vcHRpb25zO1xuICAgIGNvbXBpbGVyLmhvb2tzLmRvbmUudGFwKFwiR2VuZXJhdGVQREZcIiwgc3RhdHMgPT4ge1xuICAgICAgY29uc3QgeyBhc3NldHMsIG91dHB1dE9wdGlvbnMgfSA9IHN0YXRzLmNvbXBpbGF0aW9uO1xuICAgICAgKGFzeW5jICgpID0+IHtcbiAgICAgICAgY29uc3QgYnJvd3NlciA9IGF3YWl0IHB1cHBldGVlci5sYXVuY2goe1xuICAgICAgICAgIGFyZ3M6IFtcIi0tbm8tc2FuZGJveFwiLCBcIi0tZGlzYWJsZS1zZXR1aWQtc2FuZGJveFwiXVxuICAgICAgICB9KTtcbiAgICAgICAgY29uc3QgcGFnZSA9IGF3YWl0IGJyb3dzZXIubmV3UGFnZSgpO1xuICAgICAgICBpZiAob3B0aW9ucy5jb250ZW50KSB7XG4gICAgICAgICAgY29uc3QgaHRtbCA9IGA8IURPQ1RZUEUgaHRtbD48aHRtbD48aGVhZD48bWV0YSBjaGFyc2V0PVwidXRmLThcIj48L2hlYWQ+PGJvZHk+JHtcbiAgICAgICAgICAgIG9wdGlvbnMuY29udGVudFxuICAgICAgICAgIH08L2JvZHk+PC9odG1sPmA7XG4gICAgICAgICAgYXdhaXQgcGFnZS5zZXRDb250ZW50KGh0bWwpO1xuICAgICAgICAgIGZvciAodmFyIGtleSBpbiBhc3NldHMpIHtcbiAgICAgICAgICAgIGlmIChwYXRoLmV4dG5hbWUoa2V5KSA9PSBcIi5qc1wiKSB7XG4gICAgICAgICAgICAgIGF3YWl0IHBhZ2UuYWRkU2NyaXB0VGFnKHsgcGF0aDogYXNzZXRzW2tleV0uZXhpc3RzQXQgfSk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgfVxuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgIGZvciAodmFyIGtleSBpbiBhc3NldHMpIHtcbiAgICAgICAgICAgIGlmIChwYXRoLmV4dG5hbWUoa2V5KSA9PSBcIi5odG1sXCIpIHtcbiAgICAgICAgICAgICAgYXdhaXQgcGFnZS5nb3RvKFwiZmlsZTovL1wiICsgYXNzZXRzW2tleV0uZXhpc3RzQXQpO1xuICAgICAgICAgICAgfSBlbHNlIGlmIChwYXRoLmV4dG5hbWUoa2V5KSA9PSBcIi5qc1wiKSB7XG4gICAgICAgICAgICAgIGF3YWl0IHBhZ2UuYWRkU2NyaXB0VGFnKHsgcGF0aDogYXNzZXRzW2tleV0uZXhpc3RzQXQgfSk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICAgIGF3YWl0IHBhZ2Uuc2V0Vmlld3BvcnQoe1xuICAgICAgICAgIHdpZHRoOiA4MDAsXG4gICAgICAgICAgaGVpZ2h0OiA2MDAsXG4gICAgICAgICAgZGV2aWNlU2NhbGVGYWN0b3I6IDJcbiAgICAgICAgfSk7XG4gICAgICAgIGF3YWl0IHBhZ2UucGRmKHtcbiAgICAgICAgICBwYXRoOiBvcHRpb25zLnBhdGggfHwgYCR7b3V0cHV0T3B0aW9ucy5wYXRofS8ke29wdGlvbnMuZmlsZW5hbWV9YCxcbiAgICAgICAgICBmb3JtYXQ6IG9wdGlvbnMuZm9ybWF0LFxuICAgICAgICAgIHNjYWxlOiBvcHRpb25zLnNjYWxlLFxuICAgICAgICAgIGxhbmRzY2FwZTogb3B0aW9ucy5sYW5kc2NhcGUsXG4gICAgICAgICAgcHJpbnRCYWNrZ3JvdW5kOiBvcHRpb25zLnByaW50QmFja2dyb3VuZFxuICAgICAgICB9KTtcbiAgICAgICAgYXdhaXQgYnJvd3Nlci5jbG9zZSgpO1xuICAgICAgfSkoKTtcbiAgICB9KTtcbiAgfVxufVxuXG5tb2R1bGUuZXhwb3J0cyA9IEdlbmVyYXRlUERGO1xuIl19",
    "ast": null,
    "map": {
      "version": 3,
      "sources": [
        "pdf-webpack-plugin.js"
      ],
      "names": [
        "puppeteer",
        "require",
        "_",
        "path",
        "GeneratePDF",
        "options",
        "extend",
        "undefined",
        "filename",
        "format",
        "scale",
        "printBackground",
        "landscape",
        "content",
        "compiler",
        "hooks",
        "done",
        "tap",
        "stats",
        "compilation",
        "assets",
        "outputOptions",
        "launch",
        "args",
        "browser",
        "newPage",
        "page",
        "html",
        "setContent",
        "key",
        "extname",
        "addScriptTag",
        "existsAt",
        "goto",
        "setViewport",
        "width",
        "height",
        "deviceScaleFactor",
        "pdf",
        "close",
        "module",
        "exports"
      ],
      "mappings": ";;;;;;;;;;;;;;;;;;;;AAAA,IAAMA,YAAYC,QAAQ,WAAR,CAAlB;AACA,IAAMC,IAAID,QAAQ,YAAR,CAAV;AACA,IAAME,OAAOF,QAAQ,MAAR,CAAb;;IAEMG,W;AACJ,uBAAYC,OAAZ,EAAqB;AAAA;;AACnB,SAAKA,OAAL,GAAeH,EAAEI,MAAF,CACb;AACEH,YAAMI,SADR;AAEEC,gBAAU,UAFZ;AAGEC,cAAQ,IAHV;AAIEC,aAAO,CAJT;AAKEC,uBAAiB,IALnB;AAMEC,iBAAW,KANb;AAOEC,eAAS;AAPX,KADa,EAUbR,OAVa,CAAf;AAYD;;;;0BACKS,Q,EAAU;AAAA;;AACd,UAAMT,UAAU,KAAKA,OAArB;AACAS,eAASC,KAAT,CAAeC,IAAf,CAAoBC,GAApB,CAAwB,aAAxB,EAAuC,iBAAS;AAAA,iCACZC,MAAMC,WADM;AAAA,YACtCC,MADsC,sBACtCA,MADsC;AAAA,YAC9BC,aAD8B,sBAC9BA,aAD8B;;AAE9C,iFAAC;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,yBACuBrB,UAAUsB,MAAV,CAAiB;AACrCC,0BAAM,CAAC,cAAD,EAAiB,0BAAjB;AAD+B,mBAAjB,CADvB;;AAAA;AACOC,yBADP;AAAA;AAAA,yBAIoBA,QAAQC,OAAR,EAJpB;;AAAA;AAIOC,sBAJP;;AAAA,uBAKKrB,QAAQQ,OALb;AAAA;AAAA;AAAA;;AAMSc,sBANT,wEAOKtB,QAAQQ,OAPb;AAAA;AAAA,yBASSa,KAAKE,UAAL,CAAgBD,IAAhB,CATT;;AAAA;AAAA,2DAUmBP,MAVnB;;AAAA;AAAA;AAAA;AAAA;AAAA;;AAUYS,qBAVZ;;AAAA,wBAWS1B,KAAK2B,OAAL,CAAaD,GAAb,KAAqB,KAX9B;AAAA;AAAA;AAAA;;AAAA;AAAA,yBAYaH,KAAKK,YAAL,CAAkB,EAAE5B,MAAMiB,OAAOS,GAAP,EAAYG,QAApB,EAAlB,CAZb;;AAAA;AAAA;AAAA;;AAAA;AAAA;AAAA;;AAAA;AAAA,2DAgBmBZ,MAhBnB;;AAAA;AAAA;AAAA;AAAA;AAAA;;AAgBYS,qBAhBZ;;AAAA,wBAiBS1B,KAAK2B,OAAL,CAAaD,GAAb,KAAqB,OAjB9B;AAAA;AAAA;AAAA;;AAAA;AAAA,yBAkBaH,KAAKO,IAAL,CAAU,YAAYb,OAAOS,GAAP,EAAYG,QAAlC,CAlBb;;AAAA;AAAA;AAAA;;AAAA;AAAA,wBAmBgB7B,KAAK2B,OAAL,CAAaD,GAAb,KAAqB,KAnBrC;AAAA;AAAA;AAAA;;AAAA;AAAA,yBAoBaH,KAAKK,YAAL,CAAkB,EAAE5B,MAAMiB,OAAOS,GAAP,EAAYG,QAApB,EAAlB,CApBb;;AAAA;AAAA;AAAA;;AAAA;AAAA;AAAA,yBAwBON,KAAKQ,WAAL,CAAiB;AACrBC,2BAAO,GADc;AAErBC,4BAAQ,GAFa;AAGrBC,uCAAmB;AAHE,mBAAjB,CAxBP;;AAAA;AAAA;AAAA,yBA6BOX,KAAKY,GAAL,CAAS;AACbnC,0BAAME,QAAQF,IAAR,IAAmBkB,cAAclB,IAAjC,SAAyCE,QAAQG,QAD1C;AAEbC,4BAAQJ,QAAQI,MAFH;AAGbC,2BAAOL,QAAQK,KAHF;AAIbE,+BAAWP,QAAQO,SAJN;AAKbD,qCAAiBN,QAAQM;AALZ,mBAAT,CA7BP;;AAAA;AAAA;AAAA,yBAoCOa,QAAQe,KAAR,EApCP;;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,SAAD;AAsCD,OAxCD;AAyCD;;;;;AAGHC,OAAOC,OAAP,GAAiBrC,WAAjB",
      "file": "pdf-webpack-plugin.js",
      "sourceRoot": "/canvas/lib",
      "sourcesContent": [
        "const puppeteer = require(\"puppeteer\");\nconst _ = require(\"underscore\");\nconst path = require(\"path\");\n\nclass GeneratePDF {\n  constructor(options) {\n    this.options = _.extend(\n      {\n        path: undefined,\n        filename: \"file.pdf\",\n        format: \"A4\",\n        scale: 1,\n        printBackground: true,\n        landscape: false,\n        content: \"\"\n      },\n      options\n    );\n  }\n  apply(compiler) {\n    const options = this.options;\n    compiler.hooks.done.tap(\"GeneratePDF\", stats => {\n      const { assets, outputOptions } = stats.compilation;\n      (async () => {\n        const browser = await puppeteer.launch({\n          args: [\"--no-sandbox\", \"--disable-setuid-sandbox\"]\n        });\n        const page = await browser.newPage();\n        if (options.content) {\n          const html = `<!DOCTYPE html><html><head><meta charset=\"utf-8\"></head><body>${\n            options.content\n          }</body></html>`;\n          await page.setContent(html);\n          for (var key in assets) {\n            if (path.extname(key) == \".js\") {\n              await page.addScriptTag({ path: assets[key].existsAt });\n            }\n          }\n        } else {\n          for (var key in assets) {\n            if (path.extname(key) == \".html\") {\n              await page.goto(\"file://\" + assets[key].existsAt);\n            } else if (path.extname(key) == \".js\") {\n              await page.addScriptTag({ path: assets[key].existsAt });\n            }\n          }\n        }\n        await page.setViewport({\n          width: 800,\n          height: 600,\n          deviceScaleFactor: 2\n        });\n        await page.pdf({\n          path: options.path || `${outputOptions.path}/${options.filename}`,\n          format: options.format,\n          scale: options.scale,\n          landscape: options.landscape,\n          printBackground: options.printBackground\n        });\n        await browser.close();\n      })();\n    });\n  }\n}\n\nmodule.exports = GeneratePDF;\n"
      ]
    },
    "mtime": 1523903738000
  },
  "{\"filename\":\"/canvas/src/app.js\",\"env\":{\"development\":{\"plugins\":[]}},\"retainLines\":false,\"highlightCode\":true,\"suppressDeprecationMessages\":false,\"presets\":[],\"plugins\":[[[],null],[[],null],[[],null],[[],null],[[],null],[[],null],[[],null],[[],null],[[],null],[[],null],[[],null],[[],null],[[],{\"loose\":false,\"spec\":false}],[[],null],[[],null],[[],{\"spec\":false}],[[],null],[[],{\"loose\":false}],[[],null],[[],null],[[],null],[[],{\"loose\":false}],[[],{\"loose\":false}],[[],null],[[],null],[[],null],[[],{\"loose\":false}],[[],null],[[],{\"loose\":false}],[[],null],[[],null],[[],{\"loose\":false}],[[],{\"async\":false,\"asyncGenerators\":false}],[[],null],[[],null],[[],null],[[],null],[[],null],[[],null],[[],null],[[],null],[[],null],[[],null],[[],null],[[],null],[[],null],[[],null],[[],null],[[],null],[[],null],[[],null],[[],null],[[],null],[[],{\"loose\":false,\"spec\":false}],[[],null],[[],null],[[],{\"spec\":false}],[[],null],[[],{\"loose\":false}],[[],null],[[],null],[[],null],[[],{\"loose\":false}],[[],{\"loose\":false}],[[],null],[[],null],[[],null],[[],{\"loose\":false}],[[],null],[[],{\"loose\":false}],[[],null],[[],null],[[],{\"loose\":false}],[[],{\"async\":false,\"asyncGenerators\":false}]],\"ignore\":[],\"code\":true,\"metadata\":true,\"ast\":true,\"comments\":true,\"compact\":\"auto\",\"minified\":false,\"sourceRoot\":\"/canvas/src\",\"babelrc\":true,\"sourceType\":\"module\",\"moduleIds\":false,\"passPerPreset\":false,\"parserOpts\":false,\"generatorOpts\":false}:6.26.0:development": {
    "metadata": {
      "usedHelpers": [
        "asyncToGenerator",
        "extends",
        "interopRequireDefault"
      ],
      "marked": [],
      "modules": {
        "imports": [
          {
            "source": "express",
            "imported": [
              "default"
            ],
            "specifiers": [
              {
                "kind": "named",
                "imported": "default",
                "local": "express"
              }
            ]
          },
          {
            "source": "body-parser",
            "imported": [
              "default"
            ],
            "specifiers": [
              {
                "kind": "named",
                "imported": "default",
                "local": "bodyParser"
              }
            ]
          },
          {
            "source": "ioredis",
            "imported": [
              "default"
            ],
            "specifiers": [
              {
                "kind": "named",
                "imported": "default",
                "local": "Redis"
              }
            ]
          },
          {
            "source": "puppeteer",
            "imported": [
              "default"
            ],
            "specifiers": [
              {
                "kind": "named",
                "imported": "default",
                "local": "puppeteer"
              }
            ]
          },
          {
            "source": "crypto",
            "imported": [
              "default"
            ],
            "specifiers": [
              {
                "kind": "named",
                "imported": "default",
                "local": "crypto"
              }
            ]
          },
          {
            "source": "fs",
            "imported": [
              "default"
            ],
            "specifiers": [
              {
                "kind": "named",
                "imported": "default",
                "local": "fs"
              }
            ]
          },
          {
            "source": "path",
            "imported": [
              "default"
            ],
            "specifiers": [
              {
                "kind": "named",
                "imported": "default",
                "local": "path"
              }
            ]
          }
        ],
        "exports": {
          "exported": [],
          "specifiers": []
        }
      }
    },
    "options": {
      "filename": "/canvas/src/app.js",
      "filenameRelative": "/canvas/src/app.js",
      "env": {},
      "retainLines": false,
      "highlightCode": true,
      "suppressDeprecationMessages": false,
      "presets": [],
      "plugins": [
        [
          [],
          null
        ],
        [
          [],
          null
        ],
        [
          [],
          null
        ],
        [
          [],
          null
        ],
        [
          [],
          null
        ],
        [
          [],
          null
        ],
        [
          [],
          null
        ],
        [
          [],
          null
        ],
        [
          [],
          null
        ],
        [
          [],
          null
        ],
        [
          [],
          null
        ],
        [
          [],
          null
        ],
        [
          [],
          {
            "loose": false,
            "spec": false
          }
        ],
        [
          [],
          null
        ],
        [
          [],
          null
        ],
        [
          [],
          {
            "spec": false
          }
        ],
        [
          [],
          null
        ],
        [
          [],
          {
            "loose": false
          }
        ],
        [
          [],
          null
        ],
        [
          [],
          null
        ],
        [
          [],
          null
        ],
        [
          [],
          {
            "loose": false
          }
        ],
        [
          [],
          {
            "loose": false
          }
        ],
        [
          [],
          null
        ],
        [
          [],
          null
        ],
        [
          [],
          null
        ],
        [
          [],
          {
            "loose": false
          }
        ],
        [
          [],
          null
        ],
        [
          [],
          {
            "loose": false
          }
        ],
        [
          [],
          null
        ],
        [
          [],
          null
        ],
        [
          [],
          {
            "loose": false
          }
        ],
        [
          [],
          {
            "async": false,
            "asyncGenerators": false
          }
        ],
        [
          [],
          null
        ],
        [
          [],
          null
        ],
        [
          [],
          null
        ],
        [
          [],
          null
        ],
        [
          [],
          null
        ],
        [
          [],
          null
        ],
        [
          [],
          null
        ],
        [
          [],
          null
        ],
        [
          [],
          null
        ],
        [
          [],
          null
        ],
        [
          [],
          null
        ],
        [
          [],
          null
        ],
        [
          [],
          null
        ],
        [
          [],
          null
        ],
        [
          [],
          null
        ],
        [
          [],
          null
        ],
        [
          [],
          null
        ],
        [
          [],
          null
        ],
        [
          [],
          null
        ],
        [
          [],
          null
        ],
        [
          [],
          {
            "loose": false,
            "spec": false
          }
        ],
        [
          [],
          null
        ],
        [
          [],
          null
        ],
        [
          [],
          {
            "spec": false
          }
        ],
        [
          [],
          null
        ],
        [
          [],
          {
            "loose": false
          }
        ],
        [
          [],
          null
        ],
        [
          [],
          null
        ],
        [
          [],
          null
        ],
        [
          [],
          {
            "loose": false
          }
        ],
        [
          [],
          {
            "loose": false
          }
        ],
        [
          [],
          null
        ],
        [
          [],
          null
        ],
        [
          [],
          null
        ],
        [
          [],
          {
            "loose": false
          }
        ],
        [
          [],
          null
        ],
        [
          [],
          {
            "loose": false
          }
        ],
        [
          [],
          null
        ],
        [
          [],
          null
        ],
        [
          [],
          {
            "loose": false
          }
        ],
        [
          [],
          {
            "async": false,
            "asyncGenerators": false
          }
        ]
      ],
      "ignore": [],
      "code": true,
      "metadata": true,
      "ast": false,
      "comments": true,
      "compact": "auto",
      "minified": false,
      "sourceMaps": "both",
      "sourceMapTarget": "app.js",
      "sourceFileName": "app.js",
      "sourceRoot": "/canvas/src",
      "babelrc": false,
      "sourceType": "module",
      "moduleRoot": "/canvas/src",
      "moduleIds": false,
      "passPerPreset": false,
      "parserOpts": false,
      "generatorOpts": false,
      "basename": "app"
    },
    "ignored": false,
    "code": "\"use strict\";\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\n\nvar _stringify = require(\"babel-runtime/core-js/json/stringify\");\n\nvar _stringify2 = _interopRequireDefault(_stringify);\n\nvar _extends2 = require(\"babel-runtime/helpers/extends\");\n\nvar _extends3 = _interopRequireDefault(_extends2);\n\nvar _promise = require(\"babel-runtime/core-js/promise\");\n\nvar _promise2 = _interopRequireDefault(_promise);\n\nvar _regenerator = require(\"babel-runtime/regenerator\");\n\nvar _regenerator2 = _interopRequireDefault(_regenerator);\n\nvar _getIterator2 = require(\"babel-runtime/core-js/get-iterator\");\n\nvar _getIterator3 = _interopRequireDefault(_getIterator2);\n\nvar _asyncToGenerator2 = require(\"babel-runtime/helpers/asyncToGenerator\");\n\nvar _asyncToGenerator3 = _interopRequireDefault(_asyncToGenerator2);\n\nvar _express = require(\"express\");\n\nvar _express2 = _interopRequireDefault(_express);\n\nvar _bodyParser = require(\"body-parser\");\n\nvar _bodyParser2 = _interopRequireDefault(_bodyParser);\n\nvar _ioredis = require(\"ioredis\");\n\nvar _ioredis2 = _interopRequireDefault(_ioredis);\n\nvar _puppeteer = require(\"puppeteer\");\n\nvar _puppeteer2 = _interopRequireDefault(_puppeteer);\n\nvar _crypto = require(\"crypto\");\n\nvar _crypto2 = _interopRequireDefault(_crypto);\n\nvar _fs = require(\"fs\");\n\nvar _fs2 = _interopRequireDefault(_fs);\n\nvar _path = require(\"path\");\n\nvar _path2 = _interopRequireDefault(_path);\n\nfunction _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }\n\nvar FILES_DIR = _path2.default.join(__dirname, \"../files\");\nvar FORMATS = [\"A3\", \"A2\"];\nvar URL = process.env.URL || \"http://localhost:8000\";\n\n/*\n * First render\n */\nif (!_fs2.default.existsSync(FILES_DIR)) {\n  _fs2.default.mkdirSync(FILES_DIR);\n}\nsetTimeout((0, _asyncToGenerator3.default)( /*#__PURE__*/_regenerator2.default.mark(function _callee() {\n  var _iteratorNormalCompletion, _didIteratorError, _iteratorError, _iterator, _step, format;\n\n  return _regenerator2.default.wrap(function _callee$(_context) {\n    while (1) {\n      switch (_context.prev = _context.next) {\n        case 0:\n          _iteratorNormalCompletion = true;\n          _didIteratorError = false;\n          _iteratorError = undefined;\n          _context.prev = 3;\n          _iterator = (0, _getIterator3.default)(FORMATS);\n\n        case 5:\n          if (_iteratorNormalCompletion = (_step = _iterator.next()).done) {\n            _context.next = 12;\n            break;\n          }\n\n          format = _step.value;\n          _context.next = 9;\n          return render(null, \"default\", format);\n\n        case 9:\n          _iteratorNormalCompletion = true;\n          _context.next = 5;\n          break;\n\n        case 12:\n          _context.next = 18;\n          break;\n\n        case 14:\n          _context.prev = 14;\n          _context.t0 = _context[\"catch\"](3);\n          _didIteratorError = true;\n          _iteratorError = _context.t0;\n\n        case 18:\n          _context.prev = 18;\n          _context.prev = 19;\n\n          if (!_iteratorNormalCompletion && _iterator.return) {\n            _iterator.return();\n          }\n\n        case 21:\n          _context.prev = 21;\n\n          if (!_didIteratorError) {\n            _context.next = 24;\n            break;\n          }\n\n          throw _iteratorError;\n\n        case 24:\n          return _context.finish(21);\n\n        case 25:\n          return _context.finish(18);\n\n        case 26:\n          console.log(\"Default PDF rendered\");\n\n        case 27:\n        case \"end\":\n          return _context.stop();\n      }\n    }\n  }, _callee, undefined, [[3, 14, 18, 26], [19,, 21, 25]]);\n})), 10000);\n\nvar app = (0, _express2.default)();\nvar redis = new _ioredis2.default(process.env.REDIS || \"redis://localhost:6379/electoral-canvas\");\n\nredis.on(\"connect\", function () {\n  console.log(\"Connected to redis server\");\n});\n\napp.use(_bodyParser2.default.json());\napp.use(_bodyParser2.default.urlencoded({ extended: true }));\n\nvar getCanvasPath = function getCanvasPath(name, format) {\n  return _path2.default.join(FILES_DIR, \"canvas-\" + name + \"-\" + format + \".pdf\");\n};\n\nvar render = function () {\n  var _ref2 = (0, _asyncToGenerator3.default)( /*#__PURE__*/_regenerator2.default.mark(function _callee2(id, name, format) {\n    var pageUrl, browser, page;\n    return _regenerator2.default.wrap(function _callee2$(_context2) {\n      while (1) {\n        switch (_context2.prev = _context2.next) {\n          case 0:\n            pageUrl = id ? URL + \"/\" + id : URL;\n            _context2.next = 3;\n            return _puppeteer2.default.launch({\n              args: [\"--no-sandbox\", \"--disable-setuid-sandbox\"]\n            });\n\n          case 3:\n            browser = _context2.sent;\n            _context2.next = 6;\n            return browser.newPage();\n\n          case 6:\n            page = _context2.sent;\n            _context2.next = 9;\n            return page.goto(pageUrl);\n\n          case 9:\n            _context2.next = 11;\n            return page.pdf({\n              path: getCanvasPath(id || name, format),\n              format: format,\n              scale: 1,\n              landscape: true,\n              printBackground: true\n            });\n\n          case 11:\n            _context2.next = 13;\n            return browser.close();\n\n          case 13:\n          case \"end\":\n            return _context2.stop();\n        }\n      }\n    }, _callee2, this);\n  }));\n\n  return function render(_x, _x2, _x3) {\n    return _ref2.apply(this, arguments);\n  };\n}();\n\nvar renderCanvas = function () {\n  var _ref3 = (0, _asyncToGenerator3.default)( /*#__PURE__*/_regenerator2.default.mark(function _callee3(id, name) {\n    var _this = this;\n\n    var _iteratorNormalCompletion2, _didIteratorError2, _iteratorError2, _loop, _iterator2, _step2;\n\n    return _regenerator2.default.wrap(function _callee3$(_context4) {\n      while (1) {\n        switch (_context4.prev = _context4.next) {\n          case 0:\n            _iteratorNormalCompletion2 = true;\n            _didIteratorError2 = false;\n            _iteratorError2 = undefined;\n            _context4.prev = 3;\n            _loop = /*#__PURE__*/_regenerator2.default.mark(function _loop() {\n              var format, exists;\n              return _regenerator2.default.wrap(function _loop$(_context3) {\n                while (1) {\n                  switch (_context3.prev = _context3.next) {\n                    case 0:\n                      format = _step2.value;\n                      _context3.next = 3;\n                      return new _promise2.default(function (resolve, reject) {\n                        _fs2.default.open(getCanvasPath(id || name, format), \"r\", function (err, fd) {\n                          if (err && err.code === \"ENOENT\") {\n                            resolve(false);\n                          } else {\n                            resolve(true);\n                          }\n                        });\n                      });\n\n                    case 3:\n                      exists = _context3.sent;\n\n                      if (exists) {\n                        _context3.next = 8;\n                        break;\n                      }\n\n                      console.log(\"Generating \" + format + \" PDF for \" + (id || name));\n                      _context3.next = 8;\n                      return render(id, name, format);\n\n                    case 8:\n                    case \"end\":\n                      return _context3.stop();\n                  }\n                }\n              }, _loop, _this);\n            });\n            _iterator2 = (0, _getIterator3.default)(FORMATS);\n\n          case 6:\n            if (_iteratorNormalCompletion2 = (_step2 = _iterator2.next()).done) {\n              _context4.next = 11;\n              break;\n            }\n\n            return _context4.delegateYield(_loop(), \"t0\", 8);\n\n          case 8:\n            _iteratorNormalCompletion2 = true;\n            _context4.next = 6;\n            break;\n\n          case 11:\n            _context4.next = 17;\n            break;\n\n          case 13:\n            _context4.prev = 13;\n            _context4.t1 = _context4[\"catch\"](3);\n            _didIteratorError2 = true;\n            _iteratorError2 = _context4.t1;\n\n          case 17:\n            _context4.prev = 17;\n            _context4.prev = 18;\n\n            if (!_iteratorNormalCompletion2 && _iterator2.return) {\n              _iterator2.return();\n            }\n\n          case 20:\n            _context4.prev = 20;\n\n            if (!_didIteratorError2) {\n              _context4.next = 23;\n              break;\n            }\n\n            throw _iteratorError2;\n\n          case 23:\n            return _context4.finish(20);\n\n          case 24:\n            return _context4.finish(17);\n\n          case 25:\n          case \"end\":\n            return _context4.stop();\n        }\n      }\n    }, _callee3, this, [[3, 13, 17, 25], [18,, 20, 24]]);\n  }));\n\n  return function renderCanvas(_x4, _x5) {\n    return _ref3.apply(this, arguments);\n  };\n}();\n\nvar parseFromLiane = function parseFromLiane(canvas) {\n  var result = (0, _extends3.default)({}, canvas);\n  if (result.basic_info && result.basic_info.location) {\n    result.basic_info.location = result.basic_info.location.city.name;\n  }\n  if (result.commitments && result.commitments.commitments) {\n    result.commitments = result.commitments.commitments.map(function (c) {\n      return c.title;\n    });\n  }\n  if (result.causes && result.causes.causes) {\n    result.causes = result.causes.causes.map(function (c) {\n      return c.title;\n    });\n  }\n  if (result.principles && result.principles.principles) {\n    result.principles = result.principles.principles.map(function (p) {\n      return p.title;\n    });\n  }\n  if (result.assets && result.assets.assets) {\n    result.assets = result.assets.assets.map(function (p) {\n      return p.description;\n    }).join(\"; \");\n  }\n  if (result.team && result.team.team) {\n    result.team = result.team.team.map(function (t) {\n      return [t.name, t.role];\n    });\n  }\n  if (result.potential_voter && result.potential_voter.profiles) {\n    result.electorate = result.potential_voter.profiles.map(function (profile) {\n      return (0, _extends3.default)({}, profile, {\n        location: profile.territory ? profile.territory.location.city.name : \"\"\n      });\n    });\n  }\n  return result;\n};\n\napp.post(\"/\", function (req, res) {\n  // Validate\n  if (!req.body.canvas) {\n    res.status(500).send(\"You must provide a canvas object\");\n  }\n\n  var canvas = req.body.canvas;\n\n  if (req.body.fromLiane) {\n    canvas = parseFromLiane(req.body.canvas);\n  }\n\n  var hash = _crypto2.default.createHash(\"sha1\").update((0, _stringify2.default)(canvas)).digest(\"hex\");\n\n  var id = hash.substr(0, 7);\n  var fromCache = false;\n\n  redis.get(id).then(function (payload) {\n    fromCache = !!payload;\n    payload = payload ? JSON.parse(payload) : {\n      id: id,\n      key: hash,\n      data: canvas\n    };\n    if (!fromCache) {\n      redis.set(payload.id, (0, _stringify2.default)(payload));\n    }\n    renderCanvas(payload.id).then(function () {\n      if (req.body.json) {\n        res.send({ id: payload.id });\n      } else {\n        res.redirect(\"/\" + payload.id);\n      }\n    }).catch(function (err) {\n      console.log(err);\n      res.send({ error: true });\n    });\n  });\n});\n\napp.get(/^\\/(\\b[0-9a-f]{5,40}\\b)$/, function (req, res) {\n  var id = req.params[0];\n  redis.get(id).then(function (payload) {\n    if (!payload) {\n      res.status(404).send(\"Not Found\");\n    } else {\n      res.send(JSON.parse(payload).data);\n    }\n  }).catch(function (err) {\n    console.log(err);\n  });\n});\n\nexports.default = app;\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImFwcC5qcyJdLCJuYW1lcyI6WyJGSUxFU19ESVIiLCJqb2luIiwiX19kaXJuYW1lIiwiRk9STUFUUyIsIlVSTCIsInByb2Nlc3MiLCJlbnYiLCJleGlzdHNTeW5jIiwibWtkaXJTeW5jIiwic2V0VGltZW91dCIsImZvcm1hdCIsInJlbmRlciIsImNvbnNvbGUiLCJsb2ciLCJhcHAiLCJyZWRpcyIsIlJFRElTIiwib24iLCJ1c2UiLCJqc29uIiwidXJsZW5jb2RlZCIsImV4dGVuZGVkIiwiZ2V0Q2FudmFzUGF0aCIsIm5hbWUiLCJpZCIsInBhZ2VVcmwiLCJsYXVuY2giLCJhcmdzIiwiYnJvd3NlciIsIm5ld1BhZ2UiLCJwYWdlIiwiZ290byIsInBkZiIsInBhdGgiLCJzY2FsZSIsImxhbmRzY2FwZSIsInByaW50QmFja2dyb3VuZCIsImNsb3NlIiwicmVuZGVyQ2FudmFzIiwicmVzb2x2ZSIsInJlamVjdCIsIm9wZW4iLCJlcnIiLCJmZCIsImNvZGUiLCJleGlzdHMiLCJwYXJzZUZyb21MaWFuZSIsImNhbnZhcyIsInJlc3VsdCIsImJhc2ljX2luZm8iLCJsb2NhdGlvbiIsImNpdHkiLCJjb21taXRtZW50cyIsIm1hcCIsImMiLCJ0aXRsZSIsImNhdXNlcyIsInByaW5jaXBsZXMiLCJwIiwiYXNzZXRzIiwiZGVzY3JpcHRpb24iLCJ0ZWFtIiwidCIsInJvbGUiLCJwb3RlbnRpYWxfdm90ZXIiLCJwcm9maWxlcyIsImVsZWN0b3JhdGUiLCJwcm9maWxlIiwidGVycml0b3J5IiwicG9zdCIsInJlcSIsInJlcyIsImJvZHkiLCJzdGF0dXMiLCJzZW5kIiwiZnJvbUxpYW5lIiwiaGFzaCIsImNyZWF0ZUhhc2giLCJ1cGRhdGUiLCJkaWdlc3QiLCJzdWJzdHIiLCJmcm9tQ2FjaGUiLCJnZXQiLCJ0aGVuIiwicGF5bG9hZCIsIkpTT04iLCJwYXJzZSIsImtleSIsImRhdGEiLCJzZXQiLCJyZWRpcmVjdCIsImNhdGNoIiwiZXJyb3IiLCJwYXJhbXMiXSwibWFwcGlu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LENBQUNDLE9BQUwsRUFBYztBQUNaYixVQUFJRSxNQUFKLENBQVcsR0FBWCxFQUFnQkMsSUFBaEIsQ0FBcUIsV0FBckI7QUFDRCxLQUZELE1BRU87QUFDTEgsVUFBSUcsSUFBSixDQUFTVyxLQUFLQyxLQUFMLENBQVdGLE9BQVgsRUFBb0JJLElBQTdCO0FBQ0Q7QUFDRixHQVJILEVBU0dHLEtBVEgsQ0FTUyxlQUFPO0FBQ1ovRSxZQUFRQyxHQUFSLENBQVk2QixHQUFaO0FBQ0QsR0FYSDtBQVlELENBZEQ7O2tCQWdCZTVCLEciLCJmaWxlIjoiYXBwLmpzIiwic291cmNlUm9vdCI6Ii9jYW52YXMvc3JjIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IGV4cHJlc3MgZnJvbSBcImV4cHJlc3NcIjtcbmltcG9ydCBib2R5UGFyc2VyIGZyb20gXCJib2R5LXBhcnNlclwiO1xuaW1wb3J0IFJlZGlzIGZyb20gXCJpb3JlZGlzXCI7XG5pbXBvcnQgcHVwcGV0ZWVyIGZyb20gXCJwdXBwZXRlZXJcIjtcbmltcG9ydCBjcnlwdG8gZnJvbSBcImNyeXB0b1wiO1xuaW1wb3J0IGZzIGZyb20gXCJmc1wiO1xuaW1wb3J0IHBhdGggZnJvbSBcInBhdGhcIjtcblxuY29uc3QgRklMRVNfRElSID0gcGF0aC5qb2luKF9fZGlybmFtZSwgXCIuLi9maWxlc1wiKTtcbmNvbnN0IEZPUk1BVFMgPSBbXCJBM1wiLCBcIkEyXCJdO1xuY29uc3QgVVJMID0gcHJvY2Vzcy5lbnYuVVJMIHx8IFwiaHR0cDovL2xvY2FsaG9zdDo4MDAwXCI7XG5cbi8qXG4gKiBGaXJzdCByZW5kZXJcbiAqL1xuaWYgKCFmcy5leGlzdHNTeW5jKEZJTEVTX0RJUikpIHtcbiAgZnMubWtkaXJTeW5jKEZJTEVTX0RJUik7XG59XG5zZXRUaW1lb3V0KGFzeW5jICgpID0+IHtcbiAgZm9yIChjb25zdCBmb3JtYXQgb2YgRk9STUFUUykge1xuICAgIGF3YWl0IHJlbmRlcihudWxsLCBcImRlZmF1bHRcIiwgZm9ybWF0KTtcbiAgfVxuICBjb25zb2xlLmxvZyhcIkRlZmF1bHQgUERGIHJlbmRlcmVkXCIpO1xufSwgMTAwMDApO1xuXG5jb25zdCBhcHAgPSBleHByZXNzKCk7XG5jb25zdCByZWRpcyA9IG5ldyBSZWRpcyhcbiAgcHJvY2Vzcy5lbnYuUkVESVMgfHwgXCJyZWRpczovL2xvY2FsaG9zdDo2Mzc5L2VsZWN0b3JhbC1jYW52YXNcIlxuKTtcblxucmVkaXMub24oXCJjb25uZWN0XCIsICgpID0+IHtcbiAgY29uc29sZS5sb2coXCJDb25uZWN0ZWQgdG8gcmVkaXMgc2VydmVyXCIpO1xufSk7XG5cbmFwcC51c2UoYm9keVBhcnNlci5qc29uKCkpO1xuYXBwLnVzZShib2R5UGFyc2VyLnVybGVuY29kZWQoeyBleHRlbmRlZDogdHJ1ZSB9KSk7XG5cbmNvbnN0IGdldENhbnZhc1BhdGggPSAobmFtZSwgZm9ybWF0KSA9PiB7XG4gIHJldHVybiBwYXRoLmpvaW4oRklMRVNfRElSLCBgY2FudmFzLSR7bmFtZX0tJHtmb3JtYXR9LnBkZmApO1xufTtcblxuY29uc3QgcmVuZGVyID0gYXN5bmMgZnVuY3Rpb24oaWQsIG5hbWUsIGZvcm1hdCkge1xuICBjb25zdCBwYWdlVXJsID0gaWQgPyBVUkwgKyBcIi9cIiArIGlkIDogVVJMO1xuICBjb25zdCBicm93c2VyID0gYXdhaXQgcHVwcGV0ZWVyLmxhdW5jaCh7XG4gICAgYXJnczogW1wiLS1uby1zYW5kYm94XCIsIFwiLS1kaXNhYmxlLXNldHVpZC1zYW5kYm94XCJdXG4gIH0pO1xuICBjb25zdCBwYWdlID0gYXdhaXQgYnJvd3Nlci5uZXdQYWdlKCk7XG4gIGF3YWl0IHBhZ2UuZ290byhwYWdlVXJsKTtcbiAgYXdhaXQgcGFnZS5wZGYoe1xuICAgIHBhdGg6IGdldENhbnZhc1BhdGgoaWQgfHwgbmFtZSwgZm9ybWF0KSxcbiAgICBmb3JtYXQsXG4gICAgc2NhbGU6IDEsXG4gICAgbGFuZHNjYXBlOiB0cnVlLFxuICAgIHByaW50QmFja2dyb3VuZDogdHJ1ZVxuICB9KTtcbiAgYXdhaXQgYnJvd3Nlci5jbG9zZSgpO1xufTtcblxuY29uc3QgcmVuZGVyQ2FudmFzID0gYXN5bmMgZnVuY3Rpb24oaWQsIG5hbWUpIHtcbiAgZm9yIChjb25zdCBmb3JtYXQgb2YgRk9STUFUUykge1xuICAgIGNvbnN0IGV4aXN0cyA9IGF3YWl0IG5ldyBQcm9taXNlKChyZXNvbHZlLCByZWplY3QpID0+IHtcbiAgICAgIGZzLm9wZW4oZ2V0Q2FudmFzUGF0aChpZCB8fCBuYW1lLCBmb3JtYXQpLCBcInJcIiwgKGVyciwgZmQpID0+IHtcbiAgICAgICAgaWYgKGVyciAmJiBlcnIuY29kZSA9PT0gXCJFTk9FTlRcIikge1xuICAgICAgICAgIHJlc29sdmUoZmFsc2UpO1xuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgIHJlc29sdmUodHJ1ZSk7XG4gICAgICAgIH1cbiAgICAgIH0pO1xuICAgIH0pO1xuICAgIGlmICghZXhpc3RzKSB7XG4gICAgICBjb25zb2xlLmxvZyhgR2VuZXJhdGluZyAke2Zvcm1hdH0gUERGIGZvciAke2lkIHx8IG5hbWV9YCk7XG4gICAgICBhd2FpdCByZW5kZXIoaWQsIG5hbWUsIGZvcm1hdCk7XG4gICAgfVxuICB9XG59O1xuXG5jb25zdCBwYXJzZUZyb21MaWFuZSA9IGZ1bmN0aW9uKGNhbnZhcykge1xuICBsZXQgcmVzdWx0ID0geyAuLi5jYW52YXMgfTtcbiAgaWYgKHJlc3VsdC5iYXNpY19pbmZvICYmIHJlc3VsdC5iYXNpY19pbmZvLmxvY2F0aW9uKSB7XG4gICAgcmVzdWx0LmJhc2ljX2luZm8ubG9jYXRpb24gPSByZXN1bHQuYmFzaWNfaW5mby5sb2NhdGlvbi5jaXR5Lm5hbWU7XG4gIH1cbiAgaWYgKHJlc3VsdC5jb21taXRtZW50cyAmJiByZXN1bHQuY29tbWl0bWVudHMuY29tbWl0bWVudHMpIHtcbiAgICByZXN1bHQuY29tbWl0bWVudHMgPSByZXN1bHQuY29tbWl0bWVudHMuY29tbWl0bWVudHMubWFwKGMgPT4gYy50aXRsZSk7XG4gIH1cbiAgaWYgKHJlc3VsdC5jYXVzZXMgJiYgcmVzdWx0LmNhdXNlcy5jYXVzZXMpIHtcbiAgICByZXN1bHQuY2F1c2VzID0gcmVzdWx0LmNhdXNlcy5jYXVzZXMubWFwKGMgPT4gYy50aXRsZSk7XG4gIH1cbiAgaWYgKHJlc3VsdC5wcmluY2lwbGVzICYmIHJlc3VsdC5wcmluY2lwbGVzLnByaW5jaXBsZXMpIHtcbiAgICByZXN1bHQucHJpbmNpcGxlcyA9IHJlc3VsdC5wcmluY2lwbGVzLnByaW5jaXBsZXMubWFwKHAgPT4gcC50aXRsZSk7XG4gIH1cbiAgaWYgKHJlc3VsdC5hc3NldHMgJiYgcmVzdWx0LmFzc2V0cy5hc3NldHMpIHtcbiAgICByZXN1bHQuYXNzZXRzID0gcmVzdWx0LmFzc2V0cy5hc3NldHMubWFwKHAgPT4gcC5kZXNjcmlwdGlvbikuam9pbihcIjsgXCIpO1xuICB9XG4gIGlmIChyZXN1bHQudGVhbSAmJiByZXN1bHQudGVhbS50ZWFtKSB7XG4gICAgcmVzdWx0LnRlYW0gPSByZXN1bHQudGVhbS50ZWFtLm1hcCh0ID0+IFt0Lm5hbWUsIHQucm9sZV0pO1xuICB9XG4gIGlmIChyZXN1bHQucG90ZW50aWFsX3ZvdGVyICYmIHJlc3VsdC5wb3RlbnRpYWxfdm90ZXIucHJvZmlsZXMpIHtcbiAgICByZXN1bHQuZWxlY3RvcmF0ZSA9IHJlc3VsdC5wb3RlbnRpYWxfdm90ZXIucHJvZmlsZXMubWFwKHByb2ZpbGUgPT4ge1xuICAgICAgcmV0dXJuIHtcbiAgICAgICAgLi4ucHJvZmlsZSxcbiAgICAgICAgbG9jYXRpb246IHByb2ZpbGUudGVycml0b3J5ID8gcHJvZmlsZS50ZXJyaXRvcnkubG9jYXRpb24uY2l0eS5uYW1lIDogXCJcIlxuICAgICAgfTtcbiAgICB9KTtcbiAgfVxuICByZXR1cm4gcmVzdWx0O1xufTtcblxuYXBwLnBvc3QoXCIvXCIsIChyZXEsIHJlcykgPT4ge1xuICAvLyBWYWxpZGF0ZVxuICBpZiAoIXJlcS5ib2R5LmNhbnZhcykge1xuICAgIHJlcy5zdGF0dXMoNTAwKS5zZW5kKFwiWW91IG11c3QgcHJvdmlkZSBhIGNhbnZhcyBvYmplY3RcIik7XG4gIH1cblxuICBsZXQgY2FudmFzID0gcmVxLmJvZHkuY2FudmFzO1xuXG4gIGlmIChyZXEuYm9keS5mcm9tTGlhbmUpIHtcbiAgICBjYW52YXMgPSBwYXJzZUZyb21MaWFuZShyZXEuYm9keS5jYW52YXMpO1xuICB9XG5cbiAgY29uc3QgaGFzaCA9IGNyeXB0b1xuICAgIC5jcmVhdGVIYXNoKFwic2hhMVwiKVxuICAgIC51cGRhdGUoSlNPTi5zdHJpbmdpZnkoY2FudmFzKSlcbiAgICAuZGlnZXN0KFwiaGV4XCIpO1xuXG4gIGNvbnN0IGlkID0gaGFzaC5zdWJzdHIoMCwgNyk7XG4gIGxldCBmcm9tQ2FjaGUgPSBmYWxzZTtcblxuICByZWRpcy5nZXQoaWQpLnRoZW4ocGF5bG9hZCA9PiB7XG4gICAgZnJvbUNhY2hlID0gISFwYXlsb2FkO1xuICAgIHBheWxvYWQgPSBwYXlsb2FkXG4gICAgICA/IEpTT04ucGFyc2UocGF5bG9hZClcbiAgICAgIDoge1xuICAgICAgICAgIGlkLFxuICAgICAgICAgIGtleTogaGFzaCxcbiAgICAgICAgICBkYXRhOiBjYW52YXNcbiAgICAgICAgfTtcbiAgICBpZiAoIWZyb21DYWNoZSkge1xuICAgICAgcmVkaXMuc2V0KHBheWxvYWQuaWQsIEpTT04uc3RyaW5naWZ5KHBheWxvYWQpKTtcbiAgICB9XG4gICAgcmVuZGVyQ2FudmFzKHBheWxvYWQuaWQpXG4gICAgICAudGhlbigoKSA9PiB7XG4gICAgICAgIGlmIChyZXEuYm9keS5qc29uKSB7XG4gICAgICAgICAgcmVzLnNlbmQoeyBpZDogcGF5bG9hZC5pZCB9KTtcbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICByZXMucmVkaXJlY3QoYC8ke3BheWxvYWQuaWR9YCk7XG4gICAgICAgIH1cbiAgICAgIH0pXG4gICAgICAuY2F0Y2goZXJyID0+IHtcbiAgICAgICAgY29uc29sZS5sb2coZXJyKTtcbiAgICAgICAgcmVzLnNlbmQoeyBlcnJvcjogdHJ1ZSB9KTtcbiAgICAgIH0pO1xuICB9KTtcbn0pO1xuXG5hcHAuZ2V0KC9eXFwvKFxcYlswLTlhLWZdezUsNDB9XFxiKSQvLCAocmVxLCByZXMpID0+IHtcbiAgY29uc3QgaWQgPSByZXEucGFyYW1zWzBdO1xuICByZWRpc1xuICAgIC5nZXQoaWQpXG4gICAgLnRoZW4ocGF5bG9hZCA9PiB7XG4gICAgICBpZiAoIXBheWxvYWQpIHtcbiAgICAgICAgcmVzLnN0YXR1cyg0MDQpLnNlbmQoXCJOb3QgRm91bmRcIik7XG4gICAgICB9IGVsc2Uge1xuICAgICAgICByZXMuc2VuZChKU09OLnBhcnNlKHBheWxvYWQpLmRhdGEpO1xuICAgICAgfVxuICAgIH0pXG4gICAgLmNhdGNoKGVyciA9PiB7XG4gICAgICBjb25zb2xlLmxvZyhlcnIpO1xuICAgIH0pO1xufSk7XG5cbmV4cG9ydCBkZWZhdWx0IGFwcDtcbiJdfQ==",
    "ast": null,
    "map": {
      "version": 3,
      "sources": [
        "app.js"
      ],
      "names": [
        "FILES_DIR",
        "join",
        "__dirname",
        "FORMATS",
        "URL",
        "process",
        "env",
        "existsSync",
        "mkdirSync",
        "setTimeout",
        "format",
        "render",
        "console",
        "log",
        "app",
        "redis",
        "REDIS",
        "on",
        "use",
        "json",
        "urlencoded",
        "extended",
        "getCanvasPath",
        "name",
        "id",
        "pageUrl",
        "launch",
        "args",
        "browser",
        "newPage",
        "page",
        "goto",
        "pdf",
        "path",
        "scale",
        "landscape",
        "printBackground",
        "close",
        "renderCanvas",
        "resolve",
        "reject",
        "open",
        "err",
        "fd",
        "code",
        "exists",
        "parseFromLiane",
        "canvas",
        "result",
        "basic_info",
        "location",
        "city",
        "commitments",
        "map",
        "c",
        "title",
        "causes",
        "principles",
        "p",
        "assets",
        "description",
        "team",
        "t",
        "role",
        "potential_voter",
        "profiles",
        "electorate",
        "profile",
        "territory",
        "post",
        "req",
        "res",
        "body",
        "status",
        "send",
        "fromLiane",
        "hash",
        "createHash",
        "update",
        "digest",
        "substr",
        "fromCache",
        "get",
        "then",
        "payload",
        "JSON",
        "parse",
        "key",
        "data",
        "set",
        "redirect",
        "catch",
        "error",
        "params"
      ],
      "mappings": "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",
      "file": "app.js",
      "sourceRoot": "/canvas/src",
      "sourcesContent": [
        "import express from \"express\";\nimport bodyParser from \"body-parser\";\nimport Redis from \"ioredis\";\nimport puppeteer from \"puppeteer\";\nimport crypto from \"crypto\";\nimport fs from \"fs\";\nimport path from \"path\";\n\nconst FILES_DIR = path.join(__dirname, \"../files\");\nconst FORMATS = [\"A3\", \"A2\"];\nconst URL = process.env.URL || \"http://localhost:8000\";\n\n/*\n * First render\n */\nif (!fs.existsSync(FILES_DIR)) {\n  fs.mkdirSync(FILES_DIR);\n}\nsetTimeout(async () => {\n  for (const format of FORMATS) {\n    await render(null, \"default\", format);\n  }\n  console.log(\"Default PDF rendered\");\n}, 10000);\n\nconst app = express();\nconst redis = new Redis(\n  process.env.REDIS || \"redis://localhost:6379/electoral-canvas\"\n);\n\nredis.on(\"connect\", () => {\n  console.log(\"Connected to redis server\");\n});\n\napp.use(bodyParser.json());\napp.use(bodyParser.urlencoded({ extended: true }));\n\nconst getCanvasPath = (name, format) => {\n  return path.join(FILES_DIR, `canvas-${name}-${format}.pdf`);\n};\n\nconst render = async function(id, name, format) {\n  const pageUrl = id ? URL + \"/\" + id : URL;\n  const browser = await puppeteer.launch({\n    args: [\"--no-sandbox\", \"--disable-setuid-sandbox\"]\n  });\n  const page = await browser.newPage();\n  await page.goto(pageUrl);\n  await page.pdf({\n    path: getCanvasPath(id || name, format),\n    format,\n    scale: 1,\n    landscape: true,\n    printBackground: true\n  });\n  await browser.close();\n};\n\nconst renderCanvas = async function(id, name) {\n  for (const format of FORMATS) {\n    const exists = await new Promise((resolve, reject) => {\n      fs.open(getCanvasPath(id || name, format), \"r\", (err, fd) => {\n        if (err && err.code === \"ENOENT\") {\n          resolve(false);\n        } else {\n          resolve(true);\n        }\n      });\n    });\n    if (!exists) {\n      console.log(`Generating ${format} PDF for ${id || name}`);\n      await render(id, name, format);\n    }\n  }\n};\n\nconst parseFromLiane = function(canvas) {\n  let result = { ...canvas };\n  if (result.basic_info && result.basic_info.location) {\n    result.basic_info.location = result.basic_info.location.city.name;\n  }\n  if (result.commitments && result.commitments.commitments) {\n    result.commitments = result.commitments.commitments.map(c => c.title);\n  }\n  if (result.causes && result.causes.causes) {\n    result.causes = result.causes.causes.map(c => c.title);\n  }\n  if (result.principles && result.principles.principles) {\n    result.principles = result.principles.principles.map(p => p.title);\n  }\n  if (result.assets && result.assets.assets) {\n    result.assets = result.assets.assets.map(p => p.description).join(\"; \");\n  }\n  if (result.team && result.team.team) {\n    result.team = result.team.team.map(t => [t.name, t.role]);\n  }\n  if (result.potential_voter && result.potential_voter.profiles) {\n    result.electorate = result.potential_voter.profiles.map(profile => {\n      return {\n        ...profile,\n        location: profile.territory ? profile.territory.location.city.name : \"\"\n      };\n    });\n  }\n  return result;\n};\n\napp.post(\"/\", (req, res) => {\n  // Validate\n  if (!req.body.canvas) {\n    res.status(500).send(\"You must provide a canvas object\");\n  }\n\n  let canvas = req.body.canvas;\n\n  if (req.body.fromLiane) {\n    canvas = parseFromLiane(req.body.canvas);\n  }\n\n  const hash = crypto\n    .createHash(\"sha1\")\n    .update(JSON.stringify(canvas))\n    .digest(\"hex\");\n\n  const id = hash.substr(0, 7);\n  let fromCache = false;\n\n  redis.get(id).then(payload => {\n    fromCache = !!payload;\n    payload = payload\n      ? JSON.parse(payload)\n      : {\n          id,\n          key: hash,\n          data: canvas\n        };\n    if (!fromCache) {\n      redis.set(payload.id, JSON.stringify(payload));\n    }\n    renderCanvas(payload.id)\n      .then(() => {\n        if (req.body.json) {\n          res.send({ id: payload.id });\n        } else {\n          res.redirect(`/${payload.id}`);\n        }\n      })\n      .catch(err => {\n        console.log(err);\n        res.send({ error: true });\n      });\n  });\n});\n\napp.get(/^\\/(\\b[0-9a-f]{5,40}\\b)$/, (req, res) => {\n  const id = req.params[0];\n  redis\n    .get(id)\n    .then(payload => {\n      if (!payload) {\n        res.status(404).send(\"Not Found\");\n      } else {\n        res.send(JSON.parse(payload).data);\n      }\n    })\n    .catch(err => {\n      console.log(err);\n    });\n});\n\nexport default app;\n"
      ]
    },
    "mtime": 1525786590000
  },
  "{\"filename\":\"/canvas/src/index.js\",\"env\":{\"development\":{\"plugins\":[]}},\"retainLines\":false,\"highlightCode\":true,\"suppressDeprecationMessages\":false,\"presets\":[],\"plugins\":[[[],null],[[],null],[[],null],[[],null],[[],null],[[],null],[[],null],[[],null],[[],null],[[],null],[[],null],[[],null],[[],{\"loose\":false,\"spec\":false}],[[],null],[[],null],[[],{\"spec\":false}],[[],null],[[],{\"loose\":false}],[[],null],[[],null],[[],null],[[],{\"loose\":false}],[[],{\"loose\":false}],[[],null],[[],null],[[],null],[[],{\"loose\":false}],[[],null],[[],{\"loose\":false}],[[],null],[[],null],[[],{\"loose\":false}],[[],{\"async\":false,\"asyncGenerators\":false}],[[],null],[[],null],[[],null],[[],null],[[],null],[[],null],[[],null],[[],null],[[],null],[[],null],[[],null],[[],null],[[],null],[[],null],[[],null],[[],null],[[],null],[[],null],[[],null],[[],null],[[],{\"loose\":false,\"spec\":false}],[[],null],[[],null],[[],{\"spec\":false}],[[],null],[[],{\"loose\":false}],[[],null],[[],null],[[],null],[[],{\"loose\":false}],[[],{\"loose\":false}],[[],null],[[],null],[[],null],[[],{\"loose\":false}],[[],null],[[],{\"loose\":false}],[[],null],[[],null],[[],{\"loose\":false}],[[],{\"async\":false,\"asyncGenerators\":false}]],\"ignore\":[],\"code\":true,\"metadata\":true,\"ast\":true,\"comments\":true,\"compact\":\"auto\",\"minified\":false,\"sourceRoot\":\"/canvas/src\",\"babelrc\":true,\"sourceType\":\"module\",\"moduleIds\":false,\"passPerPreset\":false,\"parserOpts\":false,\"generatorOpts\":false}:6.26.0:production": {
    "metadata": {
      "usedHelpers": [
        "extends",
        "interopRequireDefault"
      ],
      "marked": [],
      "modules": {
        "imports": [
          {
            "source": "express",
            "imported": [
              "default"
            ],
            "specifiers": [
              {
                "kind": "named",
                "imported": "default",
                "local": "express"
              }
            ]
          },
          {
            "source": "path",
            "imported": [
              "default"
            ],
            "specifiers": [
              {
                "kind": "named",
                "imported": "default",
                "local": "path"
              }
            ]
          },
          {
            "source": "../webpack.config.js",
            "imported": [
              "default"
            ],
            "specifiers": [
              {
                "kind": "named",
                "imported": "default",
                "local": "webpackConfig"
              }
            ]
          },
          {
            "source": "./app",
            "imported": [
              "default"
            ],
            "specifiers": [
              {
                "kind": "named",
                "imported": "default",
                "local": "canvas"
              }
            ]
          }
        ],
        "exports": {
          "exported": [],
          "specifiers": []
        }
      }
    },
    "options": {
      "filename": "/canvas/src/index.js",
      "filenameRelative": "/canvas/src/index.js",
      "env": {},
      "retainLines": false,
      "highlightCode": true,
      "suppressDeprecationMessages": false,
      "presets": [],
      "plugins": [
        [
          [],
          null
        ],
        [
          [],
          null
        ],
        [
          [],
          null
        ],
        [
          [],
          null
        ],
        [
          [],
          null
        ],
        [
          [],
          null
        ],
        [
          [],
          null
        ],
        [
          [],
          null
        ],
        [
          [],
          null
        ],
        [
          [],
          null
        ],
        [
          [],
          null
        ],
        [
          [],
          null
        ],
        [
          [],
          {
            "loose": false,
            "spec": false
          }
        ],
        [
          [],
          null
        ],
        [
          [],
          null
        ],
        [
          [],
          {
            "spec": false
          }
        ],
        [
          [],
          null
        ],
        [
          [],
          {
            "loose": false
          }
        ],
        [
          [],
          null
        ],
        [
          [],
          null
        ],
        [
          [],
          null
        ],
        [
          [],
          {
            "loose": false
          }
        ],
        [
          [],
          {
            "loose": false
          }
        ],
        [
          [],
          null
        ],
        [
          [],
          null
        ],
        [
          [],
          null
        ],
        [
          [],
          {
            "loose": false
          }
        ],
        [
          [],
          null
        ],
        [
          [],
          {
            "loose": false
          }
        ],
        [
          [],
          null
        ],
        [
          [],
          null
        ],
        [
          [],
          {
            "loose": false
          }
        ],
        [
          [],
          {
            "async": false,
            "asyncGenerators": false
          }
        ],
        [
          [],
          null
        ],
        [
          [],
          null
        ],
        [
          [],
          null
        ],
        [
          [],
          null
        ],
        [
          [],
          null
        ],
        [
          [],
          null
        ],
        [
          [],
          null
        ],
        [
          [],
          null
        ],
        [
          [],
          null
        ],
        [
          [],
          null
        ],
        [
          [],
          null
        ],
        [
          [],
          null
        ],
        [
          [],
          null
        ],
        [
          [],
          null
        ],
        [
          [],
          null
        ],
        [
          [],
          null
        ],
        [
          [],
          null
        ],
        [
          [],
          null
        ],
        [
          [],
          null
        ],
        [
          [],
          null
        ],
        [
          [],
          {
            "loose": false,
            "spec": false
          }
        ],
        [
          [],
          null
        ],
        [
          [],
          null
        ],
        [
          [],
          {
            "spec": false
          }
        ],
        [
          [],
          null
        ],
        [
          [],
          {
            "loose": false
          }
        ],
        [
          [],
          null
        ],
        [
          [],
          null
        ],
        [
          [],
          null
        ],
        [
          [],
          {
            "loose": false
          }
        ],
        [
          [],
          {
            "loose": false
          }
        ],
        [
          [],
          null
        ],
        [
          [],
          null
        ],
        [
          [],
          null
        ],
        [
          [],
          {
            "loose": false
          }
        ],
        [
          [],
          null
        ],
        [
          [],
          {
            "loose": false
          }
        ],
        [
          [],
          null
        ],
        [
          [],
          null
        ],
        [
          [],
          {
            "loose": false
          }
        ],
        [
          [],
          {
            "async": false,
            "asyncGenerators": false
          }
        ]
      ],
      "ignore": [],
      "code": true,
      "metadata": true,
      "ast": false,
      "comments": true,
      "compact": "auto",
      "minified": false,
      "sourceMaps": "both",
      "sourceMapTarget": "index.js",
      "sourceFileName": "index.js",
      "sourceRoot": "/canvas/src",
      "babelrc": false,
      "sourceType": "module",
      "moduleRoot": "/canvas/src",
      "moduleIds": false,
      "passPerPreset": false,
      "parserOpts": false,
      "generatorOpts": false,
      "basename": "index"
    },
    "ignored": false,
    "code": "\"use strict\";\n\nvar _extends2 = require(\"babel-runtime/helpers/extends\");\n\nvar _extends3 = _interopRequireDefault(_extends2);\n\nvar _express = require(\"express\");\n\nvar _express2 = _interopRequireDefault(_express);\n\nvar _path = require(\"path\");\n\nvar _path2 = _interopRequireDefault(_path);\n\nvar _webpackConfig = require(\"../webpack.config.js\");\n\nvar _webpackConfig2 = _interopRequireDefault(_webpackConfig);\n\nvar _app = require(\"./app\");\n\nvar _app2 = _interopRequireDefault(_app);\n\nfunction _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }\n\nvar ENV = process.env.NODE_ENV;\nvar PORT = process.env.PORT || 8000;\n\nvar app = (0, _express2.default)();\n\napp.use(function (req, res, next) {\n  res.header(\"Access-Control-Allow-Origin\", \"*\");\n  res.header(\"Access-Control-Allow-Headers\", \"Origin, X-Requested-With, Content-Type, Accept\");\n  next();\n});\n\napp.use(\"/api\", _app2.default);\n\napp.get(\"/render/:campaignId\", function (req, res) {\n  res.send({ id: req.params.campaignId });\n});\n\napp.use(\"/files\", _express2.default.static(_path2.default.join(__dirname, \"../files\")));\n\nif (ENV !== \"production\") {\n  var webpack = require(\"webpack\");\n  var webpackDev = require(\"webpack-dev-middleware\");\n  var webpackHot = require(\"webpack-hot-middleware\");\n  var compiler = webpack((0, _extends3.default)({}, _webpackConfig2.default, { mode: \"development\" }));\n  var history = require(\"connect-history-api-fallback\");\n  app.use(history());\n  app.use(webpackDev(compiler, {\n    noInfo: true,\n    publicPath: _webpackConfig2.default.output.publicPath\n  }));\n  app.use(webpackHot(compiler, {\n    log: console.log,\n    path: \"/__webpack_hmr\",\n    heartbeat: 10 * 1000\n  }));\n} else {\n  app.use(_express2.default.static(_webpackConfig2.default.output.path));\n  app.get(\"/*\", function (req, res) {\n    res.sendFile(_path2.default.join(_webpackConfig2.default.output.path, \"index.html\"));\n  });\n}\n\napp.listen(PORT, function () {\n  console.log(\"App listening on port \" + PORT);\n});\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImluZGV4LmpzIl0sIm5hbWVzIjpbIkVOViIsInByb2Nlc3MiLCJlbnYiLCJOT0RFX0VOViIsIlBPUlQiLCJhcHAiLCJ1c2UiLCJyZXEiLCJyZXMiLCJuZXh0IiwiaGVhZGVyIiwiZ2V0Iiwic2VuZCIsImlkIiwicGFyYW1zIiwiY2FtcGFpZ25JZCIsInN0YXRpYyIsImpvaW4iLCJfX2Rpcm5hbWUiLCJ3ZWJwYWNrIiwicmVxdWlyZSIsIndlYnBhY2tEZXYiLCJ3ZWJwYWNrSG90IiwiY29tcGlsZXIiLCJtb2RlIiwiaGlzdG9yeSIsIm5vSW5mbyIsInB1YmxpY1BhdGgiLCJvdXRwdXQiLCJsb2ciLCJjb25zb2xlIiwicGF0aCIsImhlYXJ0YmVhdCIsInNlbmRGaWxlIiwibGlzdGVuIl0sIm1hcHBpbmdzIjoiOzs7Ozs7QUFBQTs7OztBQUNBOzs7O0FBQ0E7Ozs7QUFDQTs7Ozs7O0FBRUEsSUFBTUEsTUFBTUMsUUFBUUMsR0FBUixDQUFZQyxRQUF4QjtBQUNBLElBQU1DLE9BQU9ILFFBQVFDLEdBQVIsQ0FBWUUsSUFBWixJQUFvQixJQUFqQzs7QUFFQSxJQUFNQyxNQUFNLHdCQUFaOztBQUVBQSxJQUFJQyxHQUFKLENBQVEsVUFBU0MsR0FBVCxFQUFjQyxHQUFkLEVBQW1CQyxJQUFuQixFQUF5QjtBQUMvQkQsTUFBSUUsTUFBSixDQUFXLDZCQUFYLEVBQTBDLEdBQTFDO0FBQ0FGLE1BQUlFLE1BQUosQ0FDRSw4QkFERixFQUVFLGdEQUZGO0FBSUFEO0FBQ0QsQ0FQRDs7QUFTQUosSUFBSUMsR0FBSixDQUFRLE1BQVI7O0FBRUFELElBQUlNLEdBQUosQ0FBUSxxQkFBUixFQUErQixVQUFDSixHQUFELEVBQU1DLEdBQU4sRUFBYztBQUMzQ0EsTUFBSUksSUFBSixDQUFTLEVBQUVDLElBQUlOLElBQUlPLE1BQUosQ0FBV0MsVUFBakIsRUFBVDtBQUNELENBRkQ7O0FBSUFWLElBQUlDLEdBQUosQ0FBUSxRQUFSLEVBQWtCLGtCQUFRVSxNQUFSLENBQWUsZUFBS0MsSUFBTCxDQUFVQyxTQUFWLEVBQXFCLFVBQXJCLENBQWYsQ0FBbEI7O0FBRUEsSUFBSWxCLFFBQVEsWUFBWixFQUEwQjtBQUN4QixNQUFNbUIsVUFBVUMsUUFBUSxTQUFSLENBQWhCO0FBQ0EsTUFBTUMsYUFBYUQsUUFBUSx3QkFBUixDQUFuQjtBQUNBLE1BQU1FLGFBQWFGLFFBQVEsd0JBQVIsQ0FBbkI7QUFDQSxNQUFNRyxXQUFXSiw4REFBNEJLLE1BQU0sYUFBbEMsSUFBakI7QUFDQSxNQUFNQyxVQUFVTCxRQUFRLDhCQUFSLENBQWhCO0FBQ0FmLE1BQUlDLEdBQUosQ0FBUW1CLFNBQVI7QUFDQXBCLE1BQUlDLEdBQUosQ0FDRWUsV0FBV0UsUUFBWCxFQUFxQjtBQUNuQkcsWUFBUSxJQURXO0FBRW5CQyxnQkFBWSx3QkFBY0MsTUFBZCxDQUFxQkQ7QUFGZCxHQUFyQixDQURGO0FBTUF0QixNQUFJQyxHQUFKLENBQ0VnQixXQUFXQyxRQUFYLEVBQXFCO0FBQ25CTSxTQUFLQyxRQUFRRCxHQURNO0FBRW5CRSxVQUFNLGdCQUZhO0FBR25CQyxlQUFXLEtBQUs7QUFIRyxHQUFyQixDQURGO0FBT0QsQ0FwQkQsTUFvQk87QUFDTDNCLE1BQUlDLEdBQUosQ0FBUSxrQkFBUVUsTUFBUixDQUFlLHdCQUFjWSxNQUFkLENBQXFCRyxJQUFwQyxDQUFSO0FBQ0ExQixNQUFJTSxHQUFKLENBQVEsSUFBUixFQUFjLFVBQUNKLEdBQUQsRUFBTUMsR0FBTixFQUFjO0FBQzFCQSxRQUFJeUIsUUFBSixDQUFhLGVBQUtoQixJQUFMLENBQVUsd0JBQWNXLE1BQWQsQ0FBcUJHLElBQS9CLEVBQXFDLFlBQXJDLENBQWI7QUFDRCxHQUZEO0FBR0Q7O0FBRUQxQixJQUFJNkIsTUFBSixDQUFXOUIsSUFBWCxFQUFpQixZQUFNO0FBQ3JCMEIsVUFBUUQsR0FBUiw0QkFBcUN6QixJQUFyQztBQUNELENBRkQiLCJmaWxlIjoiaW5kZXguanMiLCJzb3VyY2VSb290IjoiL2NhbnZhcy9zcmMiLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgZXhwcmVzcyBmcm9tIFwiZXhwcmVzc1wiO1xuaW1wb3J0IHBhdGggZnJvbSBcInBhdGhcIjtcbmltcG9ydCB3ZWJwYWNrQ29uZmlnIGZyb20gXCIuLi93ZWJwYWNrLmNvbmZpZy5qc1wiO1xuaW1wb3J0IGNhbnZhcyBmcm9tIFwiLi9hcHBcIjtcblxuY29uc3QgRU5WID0gcHJvY2Vzcy5lbnYuTk9ERV9FTlY7XG5jb25zdCBQT1JUID0gcHJvY2Vzcy5lbnYuUE9SVCB8fCA4MDAwO1xuXG5jb25zdCBhcHAgPSBleHByZXNzKCk7XG5cbmFwcC51c2UoZnVuY3Rpb24ocmVxLCByZXMsIG5leHQpIHtcbiAgcmVzLmhlYWRlcihcIkFjY2Vzcy1Db250cm9sLUFsbG93LU9yaWdpblwiLCBcIipcIik7XG4gIHJlcy5oZWFkZXIoXG4gICAgXCJBY2Nlc3MtQ29udHJvbC1BbGxvdy1IZWFkZXJzXCIsXG4gICAgXCJPcmlnaW4sIFgtUmVxdWVzdGVkLVdpdGgsIENvbnRlbnQtVHlwZSwgQWNjZXB0XCJcbiAgKTtcbiAgbmV4dCgpO1xufSk7XG5cbmFwcC51c2UoXCIvYXBpXCIsIGNhbnZhcyk7XG5cbmFwcC5nZXQoXCIvcmVuZGVyLzpjYW1wYWlnbklkXCIsIChyZXEsIHJlcykgPT4ge1xuICByZXMuc2VuZCh7IGlkOiByZXEucGFyYW1zLmNhbXBhaWduSWQgfSk7XG59KTtcblxuYXBwLnVzZShcIi9maWxlc1wiLCBleHByZXNzLnN0YXRpYyhwYXRoLmpvaW4oX19kaXJuYW1lLCBcIi4uL2ZpbGVzXCIpKSk7XG5cbmlmIChFTlYgIT09IFwicHJvZHVjdGlvblwiKSB7XG4gIGNvbnN0IHdlYnBhY2sgPSByZXF1aXJlKFwid2VicGFja1wiKTtcbiAgY29uc3Qgd2VicGFja0RldiA9IHJlcXVpcmUoXCJ3ZWJwYWNrLWRldi1taWRkbGV3YXJlXCIpO1xuICBjb25zdCB3ZWJwYWNrSG90ID0gcmVxdWlyZShcIndlYnBhY2staG90LW1pZGRsZXdhcmVcIik7XG4gIGNvbnN0IGNvbXBpbGVyID0gd2VicGFjayh7IC4uLndlYnBhY2tDb25maWcsIG1vZGU6IFwiZGV2ZWxvcG1lbnRcIiB9KTtcbiAgY29uc3QgaGlzdG9yeSA9IHJlcXVpcmUoXCJjb25uZWN0LWhpc3RvcnktYXBpLWZhbGxiYWNrXCIpO1xuICBhcHAudXNlKGhpc3RvcnkoKSk7XG4gIGFwcC51c2UoXG4gICAgd2VicGFja0Rldihjb21waWxlciwge1xuICAgICAgbm9JbmZvOiB0cnVlLFxuICAgICAgcHVibGljUGF0aDogd2VicGFja0NvbmZpZy5vdXRwdXQucHVibGljUGF0aFxuICAgIH0pXG4gICk7XG4gIGFwcC51c2UoXG4gICAgd2VicGFja0hvdChjb21waWxlciwge1xuICAgICAgbG9nOiBjb25zb2xlLmxvZyxcbiAgICAgIHBhdGg6IFwiL19fd2VicGFja19obXJcIixcbiAgICAgIGhlYXJ0YmVhdDogMTAgKiAxMDAwXG4gICAgfSlcbiAgKTtcbn0gZWxzZSB7XG4gIGFwcC51c2UoZXhwcmVzcy5zdGF0aWMod2VicGFja0NvbmZpZy5vdXRwdXQucGF0aCkpO1xuICBhcHAuZ2V0KFwiLypcIiwgKHJlcSwgcmVzKSA9PiB7XG4gICAgcmVzLnNlbmRGaWxlKHBhdGguam9pbih3ZWJwYWNrQ29uZmlnLm91dHB1dC5wYXRoLCBcImluZGV4Lmh0bWxcIikpO1xuICB9KTtcbn1cblxuYXBwLmxpc3RlbihQT1JULCAoKSA9PiB7XG4gIGNvbnNvbGUubG9nKGBBcHAgbGlzdGVuaW5nIG9uIHBvcnQgJHtQT1JUfWApO1xufSk7XG4iXX0=",
    "ast": null,
    "map": {
      "version": 3,
      "sources": [
        "index.js"
      ],
      "names": [
        "ENV",
        "process",
        "env",
        "NODE_ENV",
        "PORT",
        "app",
        "use",
        "req",
        "res",
        "next",
        "header",
        "get",
        "send",
        "id",
        "params",
        "campaignId",
        "static",
        "join",
        "__dirname",
        "webpack",
        "require",
        "webpackDev",
        "webpackHot",
        "compiler",
        "mode",
        "history",
        "noInfo",
        "publicPath",
        "output",
        "log",
        "console",
        "path",
        "heartbeat",
        "sendFile",
        "listen"
      ],
      "mappings": ";;;;;;AAAA;;;;AACA;;;;AACA;;;;AACA;;;;;;AAEA,IAAMA,MAAMC,QAAQC,GAAR,CAAYC,QAAxB;AACA,IAAMC,OAAOH,QAAQC,GAAR,CAAYE,IAAZ,IAAoB,IAAjC;;AAEA,IAAMC,MAAM,wBAAZ;;AAEAA,IAAIC,GAAJ,CAAQ,UAASC,GAAT,EAAcC,GAAd,EAAmBC,IAAnB,EAAyB;AAC/BD,MAAIE,MAAJ,CAAW,6BAAX,EAA0C,GAA1C;AACAF,MAAIE,MAAJ,CACE,8BADF,EAEE,gDAFF;AAIAD;AACD,CAPD;;AASAJ,IAAIC,GAAJ,CAAQ,MAAR;;AAEAD,IAAIM,GAAJ,CAAQ,qBAAR,EAA+B,UAACJ,GAAD,EAAMC,GAAN,EAAc;AAC3CA,MAAII,IAAJ,CAAS,EAAEC,IAAIN,IAAIO,MAAJ,CAAWC,UAAjB,EAAT;AACD,CAFD;;AAIAV,IAAIC,GAAJ,CAAQ,QAAR,EAAkB,kBAAQU,MAAR,CAAe,eAAKC,IAAL,CAAUC,SAAV,EAAqB,UAArB,CAAf,CAAlB;;AAEA,IAAIlB,QAAQ,YAAZ,EAA0B;AACxB,MAAMmB,UAAUC,QAAQ,SAAR,CAAhB;AACA,MAAMC,aAAaD,QAAQ,wBAAR,CAAnB;AACA,MAAME,aAAaF,QAAQ,wBAAR,CAAnB;AACA,MAAMG,WAAWJ,8DAA4BK,MAAM,aAAlC,IAAjB;AACA,MAAMC,UAAUL,QAAQ,8BAAR,CAAhB;AACAf,MAAIC,GAAJ,CAAQmB,SAAR;AACApB,MAAIC,GAAJ,CACEe,WAAWE,QAAX,EAAqB;AACnBG,YAAQ,IADW;AAEnBC,gBAAY,wBAAcC,MAAd,CAAqBD;AAFd,GAArB,CADF;AAMAtB,MAAIC,GAAJ,CACEgB,WAAWC,QAAX,EAAqB;AACnBM,SAAKC,QAAQD,GADM;AAEnBE,UAAM,gBAFa;AAGnBC,eAAW,KAAK;AAHG,GAArB,CADF;AAOD,CApBD,MAoBO;AACL3B,MAAIC,GAAJ,CAAQ,kBAAQU,MAAR,CAAe,wBAAcY,MAAd,CAAqBG,IAApC,CAAR;AACA1B,MAAIM,GAAJ,CAAQ,IAAR,EAAc,UAACJ,GAAD,EAAMC,GAAN,EAAc;AAC1BA,QAAIyB,QAAJ,CAAa,eAAKhB,IAAL,CAAU,wBAAcW,MAAd,CAAqBG,IAA/B,EAAqC,YAArC,CAAb;AACD,GAFD;AAGD;;AAED1B,IAAI6B,MAAJ,CAAW9B,IAAX,EAAiB,YAAM;AACrB0B,UAAQD,GAAR,4BAAqCzB,IAArC;AACD,CAFD",
      "file": "index.js",
      "sourceRoot": "/canvas/src",
      "sourcesContent": [
        "import express from \"express\";\nimport path from \"path\";\nimport webpackConfig from \"../webpack.config.js\";\nimport canvas from \"./app\";\n\nconst ENV = process.env.NODE_ENV;\nconst PORT = process.env.PORT || 8000;\n\nconst app = express();\n\napp.use(function(req, res, next) {\n  res.header(\"Access-Control-Allow-Origin\", \"*\");\n  res.header(\n    \"Access-Control-Allow-Headers\",\n    \"Origin, X-Requested-With, Content-Type, Accept\"\n  );\n  next();\n});\n\napp.use(\"/api\", canvas);\n\napp.get(\"/render/:campaignId\", (req, res) => {\n  res.send({ id: req.params.campaignId });\n});\n\napp.use(\"/files\", express.static(path.join(__dirname, \"../files\")));\n\nif (ENV !== \"production\") {\n  const webpack = require(\"webpack\");\n  const webpackDev = require(\"webpack-dev-middleware\");\n  const webpackHot = require(\"webpack-hot-middleware\");\n  const compiler = webpack({ ...webpackConfig, mode: \"development\" });\n  const history = require(\"connect-history-api-fallback\");\n  app.use(history());\n  app.use(\n    webpackDev(compiler, {\n      noInfo: true,\n      publicPath: webpackConfig.output.publicPath\n    })\n  );\n  app.use(\n    webpackHot(compiler, {\n      log: console.log,\n      path: \"/__webpack_hmr\",\n      heartbeat: 10 * 1000\n    })\n  );\n} else {\n  app.use(express.static(webpackConfig.output.path));\n  app.get(\"/*\", (req, res) => {\n    res.sendFile(path.join(webpackConfig.output.path, \"index.html\"));\n  });\n}\n\napp.listen(PORT, () => {\n  console.log(`App listening on port ${PORT}`);\n});\n"
      ]
    },
    "mtime": 1525732613000
  },
  "{\"filename\":\"/canvas/webpack.config.js\",\"env\":{\"development\":{\"plugins\":[]}},\"retainLines\":false,\"highlightCode\":true,\"suppressDeprecationMessages\":false,\"presets\":[],\"plugins\":[[[],null],[[],null],[[],null],[[],null],[[],null],[[],null],[[],null],[[],null],[[],null],[[],null],[[],null],[[],null],[[],{\"loose\":false,\"spec\":false}],[[],null],[[],null],[[],{\"spec\":false}],[[],null],[[],{\"loose\":false}],[[],null],[[],null],[[],null],[[],{\"loose\":false}],[[],{\"loose\":false}],[[],null],[[],null],[[],null],[[],{\"loose\":false}],[[],null],[[],{\"loose\":false}],[[],null],[[],null],[[],{\"loose\":false}],[[],{\"async\":false,\"asyncGenerators\":false}],[[],null],[[],null],[[],null],[[],null],[[],null],[[],null],[[],null],[[],null],[[],null],[[],null],[[],null],[[],null],[[],null],[[],null],[[],null],[[],null],[[],null],[[],null],[[],null],[[],null],[[],{\"loose\":false,\"spec\":false}],[[],null],[[],null],[[],{\"spec\":false}],[[],null],[[],{\"loose\":false}],[[],null],[[],null],[[],null],[[],{\"loose\":false}],[[],{\"loose\":false}],[[],null],[[],null],[[],null],[[],{\"loose\":false}],[[],null],[[],{\"loose\":false}],[[],null],[[],null],[[],{\"loose\":false}],[[],{\"async\":false,\"asyncGenerators\":false}]],\"ignore\":[],\"code\":true,\"metadata\":true,\"ast\":true,\"comments\":true,\"compact\":\"auto\",\"minified\":false,\"sourceRoot\":\"/canvas\",\"babelrc\":true,\"sourceType\":\"module\",\"moduleIds\":false,\"passPerPreset\":false,\"parserOpts\":false,\"generatorOpts\":false}:6.26.0:production": {
    "metadata": {
      "usedHelpers": [
        "toConsumableArray",
        "interopRequireDefault"
      ],
      "marked": [],
      "modules": {
        "imports": [],
        "exports": {
          "exported": [],
          "specifiers": []
        }
      }
    },
    "options": {
      "filename": "/canvas/webpack.config.js",
      "filenameRelative": "/canvas/webpack.config.js",
      "env": {},
      "retainLines": false,
      "highlightCode": true,
      "suppressDeprecationMessages": false,
      "presets": [],
      "plugins": [
        [
          [],
          null
        ],
        [
          [],
          null
        ],
        [
          [],
          null
        ],
        [
          [],
          null
        ],
        [
          [],
          null
        ],
        [
          [],
          null
        ],
        [
          [],
          null
        ],
        [
          [],
          null
        ],
        [
          [],
          null
        ],
        [
          [],
          null
        ],
        [
          [],
          null
        ],
        [
          [],
          null
        ],
        [
          [],
          {
            "loose": false,
            "spec": false
          }
        ],
        [
          [],
          null
        ],
        [
          [],
          null
        ],
        [
          [],
          {
            "spec": false
          }
        ],
        [
          [],
          null
        ],
        [
          [],
          {
            "loose": false
          }
        ],
        [
          [],
          null
        ],
        [
          [],
          null
        ],
        [
          [],
          null
        ],
        [
          [],
          {
            "loose": false
          }
        ],
        [
          [],
          {
            "loose": false
          }
        ],
        [
          [],
          null
        ],
        [
          [],
          null
        ],
        [
          [],
          null
        ],
        [
          [],
          {
            "loose": false
          }
        ],
        [
          [],
          null
        ],
        [
          [],
          {
            "loose": false
          }
        ],
        [
          [],
          null
        ],
        [
          [],
          null
        ],
        [
          [],
          {
            "loose": false
          }
        ],
        [
          [],
          {
            "async": false,
            "asyncGenerators": false
          }
        ],
        [
          [],
          null
        ],
        [
          [],
          null
        ],
        [
          [],
          null
        ],
        [
          [],
          null
        ],
        [
          [],
          null
        ],
        [
          [],
          null
        ],
        [
          [],
          null
        ],
        [
          [],
          null
        ],
        [
          [],
          null
        ],
        [
          [],
          null
        ],
        [
          [],
          null
        ],
        [
          [],
          null
        ],
        [
          [],
          null
        ],
        [
          [],
          null
        ],
        [
          [],
          null
        ],
        [
          [],
          null
        ],
        [
          [],
          null
        ],
        [
          [],
          null
        ],
        [
          [],
          null
        ],
        [
          [],
          null
        ],
        [
          [],
          {
            "loose": false,
            "spec": false
          }
        ],
        [
          [],
          null
        ],
        [
          [],
          null
        ],
        [
          [],
          {
            "spec": false
          }
        ],
        [
          [],
          null
        ],
        [
          [],
          {
            "loose": false
          }
        ],
        [
          [],
          null
        ],
        [
          [],
          null
        ],
        [
          [],
          null
        ],
        [
          [],
          {
            "loose": false
          }
        ],
        [
          [],
          {
            "loose": false
          }
        ],
        [
          [],
          null
        ],
        [
          [],
          null
        ],
        [
          [],
          null
        ],
        [
          [],
          {
            "loose": false
          }
        ],
        [
          [],
          null
        ],
        [
          [],
          {
            "loose": false
          }
        ],
        [
          [],
          null
        ],
        [
          [],
          null
        ],
        [
          [],
          {
            "loose": false
          }
        ],
        [
          [],
          {
            "async": false,
            "asyncGenerators": false
          }
        ]
      ],
      "ignore": [],
      "code": true,
      "metadata": true,
      "ast": false,
      "comments": true,
      "compact": "auto",
      "minified": false,
      "sourceMaps": "both",
      "sourceMapTarget": "webpack.config.js",
      "sourceFileName": "webpack.config.js",
      "sourceRoot": "/canvas",
      "babelrc": false,
      "sourceType": "module",
      "moduleRoot": "/canvas",
      "moduleIds": false,
      "passPerPreset": false,
      "parserOpts": false,
      "generatorOpts": false,
      "basename": "webpack.config"
    },
    "ignored": false,
    "code": "\"use strict\";\n\nvar _toConsumableArray2 = require(\"babel-runtime/helpers/toConsumableArray\");\n\nvar _toConsumableArray3 = _interopRequireDefault(_toConsumableArray2);\n\nfunction _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }\n\nvar path = require(\"path\");\nvar webpack = require(\"webpack\");\nvar HTMLWebpackPlugin = require(\"html-webpack-plugin\");\nvar GeneratePDF = require(\"./lib/pdf-webpack-plugin\");\n\nvar ENV = process.env.NODE_ENV;\n\nvar hotMiddlewareScript = \"webpack-hot-middleware/client?path=/__webpack_hmr&timeout=20000&reload=true\";\n\nvar entry = [\"./client/index.jsx\"];\nvar plugins = [new HTMLWebpackPlugin({\n  template: path.resolve(\"client\", \"index.html\"),\n  filename: \"index.html\",\n  inject: \"body\"\n})];\n\nif (ENV !== \"production\") {\n  plugins = [].concat((0, _toConsumableArray3.default)(plugins), [new webpack.HotModuleReplacementPlugin()]);\n  entry = [].concat((0, _toConsumableArray3.default)(entry), [hotMiddlewareScript]);\n}\n\nmodule.exports = {\n  entry: entry,\n  resolve: {\n    modules: [\"client\", \"node_modules\"]\n  },\n  output: {\n    path: path.resolve(\"public\"),\n    publicPath: \"/\",\n    filename: function filename() {\n      if (ENV == \"production\") {\n        return \"[name]-[hash].js\";\n      } else {\n        return \"[name].js\";\n      }\n    }\n  },\n  plugins: plugins,\n  module: {\n    rules: [{\n      test: /\\.js(x)?$/,\n      use: {\n        loader: \"babel-loader\"\n      },\n      exclude: /node_modules/\n    }, {\n      test: /\\.(css|less)$/,\n      use: [\"style-loader\", \"css-loader\", \"less-loader\"]\n    }, {\n      test: /\\.(sass|scss)$/,\n      use: [\"style-loader\", \"css-loader\", \"sass-loader\"]\n    }, {\n      test: /fonts\\/(.*)\\.(ttf|otf|eot|svg|woff(2)?)(\\?[a-z0-9]+)?$/,\n      use: \"file-loader?name=fonts/[name].[ext]&publicPath=./\"\n    }, {\n      test: /\\.(png|jpg|svg|gif|mp4)$/,\n      use: \"file-loader?name=assets/[name].[hash].[ext]&publicPath=./\"\n    }]\n  }\n};\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIndlYnBhY2suY29uZmlnLmpzIl0sIm5hbWVzIjpbInBhdGgiLCJyZXF1aXJlIiwid2VicGFjayIsIkhUTUxXZWJwYWNrUGx1Z2luIiwiR2VuZXJhdGVQREYiLCJFTlYiLCJwcm9jZXNzIiwiZW52IiwiTk9ERV9FTlYiLCJob3RNaWRkbGV3YXJlU2NyaXB0IiwiZW50cnkiLCJwbHVnaW5zIiwidGVtcGxhdGUiLCJyZXNvbHZlIiwiZmlsZW5hbWUiLCJpbmplY3QiLCJIb3RNb2R1bGVSZXBsYWNlbWVudFBsdWdpbiIsIm1vZHVsZSIsImV4cG9ydHMiLCJtb2R1bGVzIiwib3V0cHV0IiwicHVibGljUGF0aCIsInJ1bGVzIiwidGVzdCIsInVzZSIsImxvYWRlciIsImV4Y2x1ZGUiXSwibWFwcGluZ3MiOiI7Ozs7Ozs7O0FBQUEsSUFBTUEsT0FBT0MsUUFBUSxNQUFSLENBQWI7QUFDQSxJQUFNQyxVQUFVRCxRQUFRLFNBQVIsQ0FBaEI7QUFDQSxJQUFNRSxvQkFBb0JGLFFBQVEscUJBQVIsQ0FBMUI7QUFDQSxJQUFNRyxjQUFjSCxRQUFRLDBCQUFSLENBQXBCOztBQUVBLElBQU1JLE1BQU1DLFFBQVFDLEdBQVIsQ0FBWUMsUUFBeEI7O0FBRUEsSUFBTUMsc0JBQ0osNkVBREY7O0FBR0EsSUFBSUMsUUFBUSxDQUFDLG9CQUFELENBQVo7QUFDQSxJQUFJQyxVQUFVLENBQ1osSUFBSVIsaUJBQUosQ0FBc0I7QUFDcEJTLFlBQVVaLEtBQUthLE9BQUwsQ0FBYSxRQUFiLEVBQXVCLFlBQXZCLENBRFU7QUFFcEJDLFlBQVUsWUFGVTtBQUdwQkMsVUFBUTtBQUhZLENBQXRCLENBRFksQ0FBZDs7QUFRQSxJQUFJVixRQUFRLFlBQVosRUFBMEI7QUFDeEJNLHVEQUFjQSxPQUFkLElBQXVCLElBQUlULFFBQVFjLDBCQUFaLEVBQXZCO0FBQ0FOLHFEQUFZQSxLQUFaLElBQW1CRCxtQkFBbkI7QUFDRDs7QUFFRFEsT0FBT0MsT0FBUCxHQUFpQjtBQUNmUixjQURlO0FBRWZHLFdBQVM7QUFDUE0sYUFBUyxDQUFDLFFBQUQsRUFBVyxjQUFYO0FBREYsR0FGTTtBQUtmQyxVQUFRO0FBQ05wQixVQUFNQSxLQUFLYSxPQUFMLENBQWEsUUFBYixDQURBO0FBRU5RLGdCQUFZLEdBRk47QUFHTlAsY0FBVSxvQkFBa0I7QUFDMUIsVUFBSVQsT0FBTyxZQUFYLEVBQXlCO0FBQ3ZCLGVBQU8sa0JBQVA7QUFDRCxPQUZELE1BRU87QUFDTCxlQUFPLFdBQVA7QUFDRDtBQUNGO0FBVEssR0FMTztBQWdCZk0sa0JBaEJlO0FBaUJmTSxVQUFRO0FBQ05LLFdBQU8sQ0FDTDtBQUNFQyxZQUFNLFdBRFI7QUFFRUMsV0FBSztBQUNIQyxnQkFBUTtBQURMLE9BRlA7QUFLRUMsZUFBUztBQUxYLEtBREssRUFRTDtBQUNFSCxZQUFNLGVBRFI7QUFFRUMsV0FBSyxDQUFDLGNBQUQsRUFBaUIsWUFBakIsRUFBK0IsYUFBL0I7QUFGUCxLQVJLLEVBWUw7QUFDRUQsWUFBTSxnQkFEUjtBQUVFQyxXQUFLLENBQUMsY0FBRCxFQUFpQixZQUFqQixFQUErQixhQUEvQjtBQUZQLEtBWkssRUFnQkw7QUFDRUQsWUFBTSx3REFEUjtBQUVFQyxXQUFLO0FBRlAsS0FoQkssRUFvQkw7QUFDRUQsWUFBTSwwQkFEUjtBQUVFQyxXQUFLO0FBRlAsS0FwQks7QUFERDtBQWpCTyxDQUFqQiIsImZpbGUiOiJ3ZWJwYWNrLmNvbmZpZy5qcyIsInNvdXJjZVJvb3QiOiIvY2FudmFzIiwic291cmNlc0NvbnRlbnQiOlsiY29uc3QgcGF0aCA9IHJlcXVpcmUoXCJwYXRoXCIpO1xuY29uc3Qgd2VicGFjayA9IHJlcXVpcmUoXCJ3ZWJwYWNrXCIpO1xuY29uc3QgSFRNTFdlYnBhY2tQbHVnaW4gPSByZXF1aXJlKFwiaHRtbC13ZWJwYWNrLXBsdWdpblwiKTtcbmNvbnN0IEdlbmVyYXRlUERGID0gcmVxdWlyZShcIi4vbGliL3BkZi13ZWJwYWNrLXBsdWdpblwiKTtcblxuY29uc3QgRU5WID0gcHJvY2Vzcy5lbnYuTk9ERV9FTlY7XG5cbmNvbnN0IGhvdE1pZGRsZXdhcmVTY3JpcHQgPVxuICBcIndlYnBhY2staG90LW1pZGRsZXdhcmUvY2xpZW50P3BhdGg9L19fd2VicGFja19obXImdGltZW91dD0yMDAwMCZyZWxvYWQ9dHJ1ZVwiO1xuXG5sZXQgZW50cnkgPSBbXCIuL2NsaWVudC9pbmRleC5qc3hcIl07XG5sZXQgcGx1Z2lucyA9IFtcbiAgbmV3IEhUTUxXZWJwYWNrUGx1Z2luKHtcbiAgICB0ZW1wbGF0ZTogcGF0aC5yZXNvbHZlKFwiY2xpZW50XCIsIFwiaW5kZXguaHRtbFwiKSxcbiAgICBmaWxlbmFtZTogXCJpbmRleC5odG1sXCIsXG4gICAgaW5qZWN0OiBcImJvZHlcIlxuICB9KVxuXTtcblxuaWYgKEVOViAhPT0gXCJwcm9kdWN0aW9uXCIpIHtcbiAgcGx1Z2lucyA9IFsuLi5wbHVnaW5zLCBuZXcgd2VicGFjay5Ib3RNb2R1bGVSZXBsYWNlbWVudFBsdWdpbigpXTtcbiAgZW50cnkgPSBbLi4uZW50cnksIGhvdE1pZGRsZXdhcmVTY3JpcHRdO1xufVxuXG5tb2R1bGUuZXhwb3J0cyA9IHtcbiAgZW50cnksXG4gIHJlc29sdmU6IHtcbiAgICBtb2R1bGVzOiBbXCJjbGllbnRcIiwgXCJub2RlX21vZHVsZXNcIl1cbiAgfSxcbiAgb3V0cHV0OiB7XG4gICAgcGF0aDogcGF0aC5yZXNvbHZlKFwicHVibGljXCIpLFxuICAgIHB1YmxpY1BhdGg6IFwiL1wiLFxuICAgIGZpbGVuYW1lOiBmdW5jdGlvbiguLi5hcmdzKSB7XG4gICAgICBpZiAoRU5WID09IFwicHJvZHVjdGlvblwiKSB7XG4gICAgICAgIHJldHVybiBcIltuYW1lXS1baGFzaF0uanNcIjtcbiAgICAgIH0gZWxzZSB7XG4gICAgICAgIHJldHVybiBcIltuYW1lXS5qc1wiO1xuICAgICAgfVxuICAgIH1cbiAgfSxcbiAgcGx1Z2lucyxcbiAgbW9kdWxlOiB7XG4gICAgcnVsZXM6IFtcbiAgICAgIHtcbiAgICAgICAgdGVzdDogL1xcLmpzKHgpPyQvLFxuICAgICAgICB1c2U6IHtcbiAgICAgICAgICBsb2FkZXI6IFwiYmFiZWwtbG9hZGVyXCJcbiAgICAgICAgfSxcbiAgICAgICAgZXhjbHVkZTogL25vZGVfbW9kdWxlcy9cbiAgICAgIH0sXG4gICAgICB7XG4gICAgICAgIHRlc3Q6IC9cXC4oY3NzfGxlc3MpJC8sXG4gICAgICAgIHVzZTogW1wic3R5bGUtbG9hZGVyXCIsIFwiY3NzLWxvYWRlclwiLCBcImxlc3MtbG9hZGVyXCJdXG4gICAgICB9LFxuICAgICAge1xuICAgICAgICB0ZXN0OiAvXFwuKHNhc3N8c2NzcykkLyxcbiAgICAgICAgdXNlOiBbXCJzdHlsZS1sb2FkZXJcIiwgXCJjc3MtbG9hZGVyXCIsIFwic2Fzcy1sb2FkZXJcIl1cbiAgICAgIH0sXG4gICAgICB7XG4gICAgICAgIHRlc3Q6IC9mb250c1xcLyguKilcXC4odHRmfG90Znxlb3R8c3ZnfHdvZmYoMik/KShcXD9bYS16MC05XSspPyQvLFxuICAgICAgICB1c2U6IFwiZmlsZS1sb2FkZXI/bmFtZT1mb250cy9bbmFtZV0uW2V4dF0mcHVibGljUGF0aD0uL1wiXG4gICAgICB9LFxuICAgICAge1xuICAgICAgICB0ZXN0OiAvXFwuKHBuZ3xqcGd8c3ZnfGdpZnxtcDQpJC8sXG4gICAgICAgIHVzZTogXCJmaWxlLWxvYWRlcj9uYW1lPWFzc2V0cy9bbmFtZV0uW2hhc2hdLltleHRdJnB1YmxpY1BhdGg9Li9cIlxuICAgICAgfVxuICAgIF1cbiAgfVxufTtcbiJdfQ==",
    "ast": null,
    "map": {
      "version": 3,
      "sources": [
        "webpack.config.js"
      ],
      "names": [
        "path",
        "require",
        "webpack",
        "HTMLWebpackPlugin",
        "GeneratePDF",
        "ENV",
        "process",
        "env",
        "NODE_ENV",
        "hotMiddlewareScript",
        "entry",
        "plugins",
        "template",
        "resolve",
        "filename",
        "inject",
        "HotModuleReplacementPlugin",
        "module",
        "exports",
        "modules",
        "output",
        "publicPath",
        "rules",
        "test",
        "use",
        "loader",
        "exclude"
      ],
      "mappings": ";;;;;;;;AAAA,IAAMA,OAAOC,QAAQ,MAAR,CAAb;AACA,IAAMC,UAAUD,QAAQ,SAAR,CAAhB;AACA,IAAME,oBAAoBF,QAAQ,qBAAR,CAA1B;AACA,IAAMG,cAAcH,QAAQ,0BAAR,CAApB;;AAEA,IAAMI,MAAMC,QAAQC,GAAR,CAAYC,QAAxB;;AAEA,IAAMC,sBACJ,6EADF;;AAGA,IAAIC,QAAQ,CAAC,oBAAD,CAAZ;AACA,IAAIC,UAAU,CACZ,IAAIR,iBAAJ,CAAsB;AACpBS,YAAUZ,KAAKa,OAAL,CAAa,QAAb,EAAuB,YAAvB,CADU;AAEpBC,YAAU,YAFU;AAGpBC,UAAQ;AAHY,CAAtB,CADY,CAAd;;AAQA,IAAIV,QAAQ,YAAZ,EAA0B;AACxBM,uDAAcA,OAAd,IAAuB,IAAIT,QAAQc,0BAAZ,EAAvB;AACAN,qDAAYA,KAAZ,IAAmBD,mBAAnB;AACD;;AAEDQ,OAAOC,OAAP,GAAiB;AACfR,cADe;AAEfG,WAAS;AACPM,aAAS,CAAC,QAAD,EAAW,cAAX;AADF,GAFM;AAKfC,UAAQ;AACNpB,UAAMA,KAAKa,OAAL,CAAa,QAAb,CADA;AAENQ,gBAAY,GAFN;AAGNP,cAAU,oBAAkB;AAC1B,UAAIT,OAAO,YAAX,EAAyB;AACvB,eAAO,kBAAP;AACD,OAFD,MAEO;AACL,eAAO,WAAP;AACD;AACF;AATK,GALO;AAgBfM,kBAhBe;AAiBfM,UAAQ;AACNK,WAAO,CACL;AACEC,YAAM,WADR;AAEEC,WAAK;AACHC,gBAAQ;AADL,OAFP;AAKEC,eAAS;AALX,KADK,EAQL;AACEH,YAAM,eADR;AAEEC,WAAK,CAAC,cAAD,EAAiB,YAAjB,EAA+B,aAA/B;AAFP,KARK,EAYL;AACED,YAAM,gBADR;AAEEC,WAAK,CAAC,cAAD,EAAiB,YAAjB,EAA+B,aAA/B;AAFP,KAZK,EAgBL;AACED,YAAM,wDADR;AAEEC,WAAK;AAFP,KAhBK,EAoBL;AACED,YAAM,0BADR;AAEEC,WAAK;AAFP,KApBK;AADD;AAjBO,CAAjB",
      "file": "webpack.config.js",
      "sourceRoot": "/canvas",
      "sourcesContent": [
        "const path = require(\"path\");\nconst webpack = require(\"webpack\");\nconst HTMLWebpackPlugin = require(\"html-webpack-plugin\");\nconst GeneratePDF = require(\"./lib/pdf-webpack-plugin\");\n\nconst ENV = process.env.NODE_ENV;\n\nconst hotMiddlewareScript =\n  \"webpack-hot-middleware/client?path=/__webpack_hmr&timeout=20000&reload=true\";\n\nlet entry = [\"./client/index.jsx\"];\nlet plugins = [\n  new HTMLWebpackPlugin({\n    template: path.resolve(\"client\", \"index.html\"),\n    filename: \"index.html\",\n    inject: \"body\"\n  })\n];\n\nif (ENV !== \"production\") {\n  plugins = [...plugins, new webpack.HotModuleReplacementPlugin()];\n  entry = [...entry, hotMiddlewareScript];\n}\n\nmodule.exports = {\n  entry,\n  resolve: {\n    modules: [\"client\", \"node_modules\"]\n  },\n  output: {\n    path: path.resolve(\"public\"),\n    publicPath: \"/\",\n    filename: function(...args) {\n      if (ENV == \"production\") {\n        return \"[name]-[hash].js\";\n      } else {\n        return \"[name].js\";\n      }\n    }\n  },\n  plugins,\n  module: {\n    rules: [\n      {\n        test: /\\.js(x)?$/,\n        use: {\n          loader: \"babel-loader\"\n        },\n        exclude: /node_modules/\n      },\n      {\n        test: /\\.(css|less)$/,\n        use: [\"style-loader\", \"css-loader\", \"less-loader\"]\n      },\n      {\n        test: /\\.(sass|scss)$/,\n        use: [\"style-loader\", \"css-loader\", \"sass-loader\"]\n      },\n      {\n        test: /fonts\\/(.*)\\.(ttf|otf|eot|svg|woff(2)?)(\\?[a-z0-9]+)?$/,\n        use: \"file-loader?name=fonts/[name].[ext]&publicPath=./\"\n      },\n      {\n        test: /\\.(png|jpg|svg|gif|mp4)$/,\n        use: \"file-loader?name=assets/[name].[hash].[ext]&publicPath=./\"\n      }\n    ]\n  }\n};\n"
      ]
    },
    "mtime": 1525787134000
  },
  "{\"filename\":\"/canvas/lib/pdf-webpack-plugin.js\",\"env\":{\"development\":{\"plugins\":[]}},\"retainLines\":false,\"highlightCode\":true,\"suppressDeprecationMessages\":false,\"presets\":[],\"plugins\":[[[],null],[[],null],[[],null],[[],null],[[],null],[[],null],[[],null],[[],null],[[],null],[[],null],[[],null],[[],null],[[],{\"loose\":false,\"spec\":false}],[[],null],[[],null],[[],{\"spec\":false}],[[],null],[[],{\"loose\":false}],[[],null],[[],null],[[],null],[[],{\"loose\":false}],[[],{\"loose\":false}],[[],null],[[],null],[[],null],[[],{\"loose\":false}],[[],null],[[],{\"loose\":false}],[[],null],[[],null],[[],{\"loose\":false}],[[],{\"async\":false,\"asyncGenerators\":false}],[[],null],[[],null],[[],null],[[],null],[[],null],[[],null],[[],null],[[],null],[[],null],[[],null],[[],null],[[],null],[[],null],[[],null],[[],null],[[],null],[[],null],[[],null],[[],null],[[],null],[[],{\"loose\":false,\"spec\":false}],[[],null],[[],null],[[],{\"spec\":false}],[[],null],[[],{\"loose\":false}],[[],null],[[],null],[[],null],[[],{\"loose\":false}],[[],{\"loose\":false}],[[],null],[[],null],[[],null],[[],{\"loose\":false}],[[],null],[[],{\"loose\":false}],[[],null],[[],null],[[],{\"loose\":false}],[[],{\"async\":false,\"asyncGenerators\":false}]],\"ignore\":[],\"code\":true,\"metadata\":true,\"ast\":true,\"comments\":true,\"compact\":\"auto\",\"minified\":false,\"sourceRoot\":\"/canvas/lib\",\"babelrc\":true,\"sourceType\":\"module\",\"moduleIds\":false,\"passPerPreset\":false,\"parserOpts\":false,\"generatorOpts\":false}:6.26.0:production": {
    "metadata": {
      "usedHelpers": [
        "createClass",
        "classCallCheck",
        "asyncToGenerator",
        "interopRequireDefault"
      ],
      "marked": [],
      "modules": {
        "imports": [],
        "exports": {
          "exported": [],
          "specifiers": []
        }
      }
    },
    "options": {
      "filename": "/canvas/lib/pdf-webpack-plugin.js",
      "filenameRelative": "/canvas/lib/pdf-webpack-plugin.js",
      "env": {},
      "retainLines": false,
      "highlightCode": true,
      "suppressDeprecationMessages": false,
      "presets": [],
      "plugins": [
        [
          [],
          null
        ],
        [
          [],
          null
        ],
        [
          [],
          null
        ],
        [
          [],
          null
        ],
        [
          [],
          null
        ],
        [
          [],
          null
        ],
        [
          [],
          null
        ],
        [
          [],
          null
        ],
        [
          [],
          null
        ],
        [
          [],
          null
        ],
        [
          [],
          null
        ],
        [
          [],
          null
        ],
        [
          [],
          {
            "loose": false,
            "spec": false
          }
        ],
        [
          [],
          null
        ],
        [
          [],
          null
        ],
        [
          [],
          {
            "spec": false
          }
        ],
        [
          [],
          null
        ],
        [
          [],
          {
            "loose": false
          }
        ],
        [
          [],
          null
        ],
        [
          [],
          null
        ],
        [
          [],
          null
        ],
        [
          [],
          {
            "loose": false
          }
        ],
        [
          [],
          {
            "loose": false
          }
        ],
        [
          [],
          null
        ],
        [
          [],
          null
        ],
        [
          [],
          null
        ],
        [
          [],
          {
            "loose": false
          }
        ],
        [
          [],
          null
        ],
        [
          [],
          {
            "loose": false
          }
        ],
        [
          [],
          null
        ],
        [
          [],
          null
        ],
        [
          [],
          {
            "loose": false
          }
        ],
        [
          [],
          {
            "async": false,
            "asyncGenerators": false
          }
        ],
        [
          [],
          null
        ],
        [
          [],
          null
        ],
        [
          [],
          null
        ],
        [
          [],
          null
        ],
        [
          [],
          null
        ],
        [
          [],
          null
        ],
        [
          [],
          null
        ],
        [
          [],
          null
        ],
        [
          [],
          null
        ],
        [
          [],
          null
        ],
        [
          [],
          null
        ],
        [
          [],
          null
        ],
        [
          [],
          null
        ],
        [
          [],
          null
        ],
        [
          [],
          null
        ],
        [
          [],
          null
        ],
        [
          [],
          null
        ],
        [
          [],
          null
        ],
        [
          [],
          null
        ],
        [
          [],
          null
        ],
        [
          [],
          {
            "loose": false,
            "spec": false
          }
        ],
        [
          [],
          null
        ],
        [
          [],
          null
        ],
        [
          [],
          {
            "spec": false
          }
        ],
        [
          [],
          null
        ],
        [
          [],
          {
            "loose": false
          }
        ],
        [
          [],
          null
        ],
        [
          [],
          null
        ],
        [
          [],
          null
        ],
        [
          [],
          {
            "loose": false
          }
        ],
        [
          [],
          {
            "loose": false
          }
        ],
        [
          [],
          null
        ],
        [
          [],
          null
        ],
        [
          [],
          null
        ],
        [
          [],
          {
            "loose": false
          }
        ],
        [
          [],
          null
        ],
        [
          [],
          {
            "loose": false
          }
        ],
        [
          [],
          null
        ],
        [
          [],
          null
        ],
        [
          [],
          {
            "loose": false
          }
        ],
        [
          [],
          {
            "async": false,
            "asyncGenerators": false
          }
        ]
      ],
      "ignore": [],
      "code": true,
      "metadata": true,
      "ast": false,
      "comments": true,
      "compact": "auto",
      "minified": false,
      "sourceMaps": "both",
      "sourceMapTarget": "pdf-webpack-plugin.js",
      "sourceFileName": "pdf-webpack-plugin.js",
      "sourceRoot": "/canvas/lib",
      "babelrc": false,
      "sourceType": "module",
      "moduleRoot": "/canvas/lib",
      "moduleIds": false,
      "passPerPreset": false,
      "parserOpts": false,
      "generatorOpts": false,
      "basename": "pdf-webpack-plugin"
    },
    "ignored": false,
    "code": "\"use strict\";\n\nvar _regenerator = require(\"babel-runtime/regenerator\");\n\nvar _regenerator2 = _interopRequireDefault(_regenerator);\n\nvar _asyncToGenerator2 = require(\"babel-runtime/helpers/asyncToGenerator\");\n\nvar _asyncToGenerator3 = _interopRequireDefault(_asyncToGenerator2);\n\nvar _classCallCheck2 = require(\"babel-runtime/helpers/classCallCheck\");\n\nvar _classCallCheck3 = _interopRequireDefault(_classCallCheck2);\n\nvar _createClass2 = require(\"babel-runtime/helpers/createClass\");\n\nvar _createClass3 = _interopRequireDefault(_createClass2);\n\nfunction _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }\n\nvar puppeteer = require(\"puppeteer\");\nvar _ = require(\"underscore\");\nvar path = require(\"path\");\n\nvar GeneratePDF = function () {\n  function GeneratePDF(options) {\n    (0, _classCallCheck3.default)(this, GeneratePDF);\n\n    this.options = _.extend({\n      path: undefined,\n      filename: \"file.pdf\",\n      format: \"A4\",\n      scale: 1,\n      printBackground: true,\n      landscape: false,\n      content: \"\"\n    }, options);\n  }\n\n  (0, _createClass3.default)(GeneratePDF, [{\n    key: \"apply\",\n    value: function apply(compiler) {\n      var _this = this;\n\n      var options = this.options;\n      compiler.hooks.done.tap(\"GeneratePDF\", function (stats) {\n        var _stats$compilation = stats.compilation,\n            assets = _stats$compilation.assets,\n            outputOptions = _stats$compilation.outputOptions;\n\n        (0, _asyncToGenerator3.default)( /*#__PURE__*/_regenerator2.default.mark(function _callee() {\n          var browser, page, html, key;\n          return _regenerator2.default.wrap(function _callee$(_context) {\n            while (1) {\n              switch (_context.prev = _context.next) {\n                case 0:\n                  _context.next = 2;\n                  return puppeteer.launch({\n                    args: [\"--no-sandbox\", \"--disable-setuid-sandbox\"]\n                  });\n\n                case 2:\n                  browser = _context.sent;\n                  _context.next = 5;\n                  return browser.newPage();\n\n                case 5:\n                  page = _context.sent;\n\n                  if (!options.content) {\n                    _context.next = 20;\n                    break;\n                  }\n\n                  html = \"<!DOCTYPE html><html><head><meta charset=\\\"utf-8\\\"></head><body>\" + options.content + \"</body></html>\";\n                  _context.next = 10;\n                  return page.setContent(html);\n\n                case 10:\n                  _context.t0 = _regenerator2.default.keys(assets);\n\n                case 11:\n                  if ((_context.t1 = _context.t0()).done) {\n                    _context.next = 18;\n                    break;\n                  }\n\n                  key = _context.t1.value;\n\n                  if (!(path.extname(key) == \".js\")) {\n                    _context.next = 16;\n                    break;\n                  }\n\n                  _context.next = 16;\n                  return page.addScriptTag({ path: assets[key].existsAt });\n\n                case 16:\n                  _context.next = 11;\n                  break;\n\n                case 18:\n                  _context.next = 33;\n                  break;\n\n                case 20:\n                  _context.t2 = _regenerator2.default.keys(assets);\n\n                case 21:\n                  if ((_context.t3 = _context.t2()).done) {\n                    _context.next = 33;\n                    break;\n                  }\n\n                  key = _context.t3.value;\n\n                  if (!(path.extname(key) == \".html\")) {\n                    _context.next = 28;\n                    break;\n                  }\n\n                  _context.next = 26;\n                  return page.goto(\"file://\" + assets[key].existsAt);\n\n                case 26:\n                  _context.next = 31;\n                  break;\n\n                case 28:\n                  if (!(path.extname(key) == \".js\")) {\n                    _context.next = 31;\n                    break;\n                  }\n\n                  _context.next = 31;\n                  return page.addScriptTag({ path: assets[key].existsAt });\n\n                case 31:\n                  _context.next = 21;\n                  break;\n\n                case 33:\n                  _context.next = 35;\n                  return page.setViewport({\n                    width: 800,\n                    height: 600,\n                    deviceScaleFactor: 2\n                  });\n\n                case 35:\n                  _context.next = 37;\n                  return page.pdf({\n                    path: options.path || outputOptions.path + \"/\" + options.filename,\n                    format: options.format,\n                    scale: options.scale,\n                    landscape: options.landscape,\n                    printBackground: options.printBackground\n                  });\n\n                case 37:\n                  _context.next = 39;\n                  return browser.close();\n\n                case 39:\n                case \"end\":\n                  return _context.stop();\n              }\n            }\n          }, _callee, _this);\n        }))();\n      });\n    }\n  }]);\n  return GeneratePDF;\n}();\n\nmodule.exports = GeneratePDF;\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbInBkZi13ZWJwYWNrLXBsdWdpbi5qcyJdLCJuYW1lcyI6WyJwdXBwZXRlZXIiLCJyZXF1aXJlIiwiXyIsInBhdGgiLCJHZW5lcmF0ZVBERiIsIm9wdGlvbnMiLCJleHRlbmQiLCJ1bmRlZmluZWQiLCJmaWxlbmFtZSIsImZvcm1hdCIsInNjYWxlIiwicHJpbnRCYWNrZ3JvdW5kIiwibGFuZHNjYXBlIiwiY29udGVudCIsImNvbXBpbGVyIiwiaG9va3MiLCJkb25lIiwidGFwIiwic3RhdHMiLCJjb21waWxhdGlvbiIsImFzc2V0cyIsIm91dHB1dE9wdGlvbnMiLCJsYXVuY2giLCJhcmdzIiwiYnJvd3NlciIsIm5ld1BhZ2UiLCJwYWdlIiwiaHRtbCIsInNldENvbnRlbnQiLCJrZXkiLCJleHRuYW1lIiwiYWRkU2NyaXB0VGFnIiwiZXhpc3RzQXQiLCJnb3RvIiwic2V0Vmlld3BvcnQiLCJ3aWR0aCIsImhlaWdodCIsImRldmljZVNjYWxlRmFjdG9yIiwicGRmIiwiY2xvc2UiLCJtb2R1bGUiLCJleHBvcnRzIl0sIm1hcHBpbmdzIjoiOzs7Ozs7Ozs7Ozs7Ozs7Ozs7OztBQUFBLElBQU1BLFlBQVlDLFFBQVEsV0FBUixDQUFsQjtBQUNBLElBQU1DLElBQUlELFFBQVEsWUFBUixDQUFWO0FBQ0EsSUFBTUUsT0FBT0YsUUFBUSxNQUFSLENBQWI7O0lBRU1HLFc7QUFDSix1QkFBWUMsT0FBWixFQUFxQjtBQUFBOztBQUNuQixTQUFLQSxPQUFMLEdBQWVILEVBQUVJLE1BQUYsQ0FDYjtBQUNFSCxZQUFNSSxTQURSO0FBRUVDLGdCQUFVLFVBRlo7QUFHRUMsY0FBUSxJQUhWO0FBSUVDLGFBQU8sQ0FKVDtBQUtFQyx1QkFBaUIsSUFMbkI7QUFNRUMsaUJBQVcsS0FOYjtBQU9FQyxlQUFTO0FBUFgsS0FEYSxFQVViUixPQVZhLENBQWY7QUFZRDs7OzswQkFDS1MsUSxFQUFVO0FBQUE7O0FBQ2QsVUFBTVQsVUFBVSxLQUFLQSxPQUFyQjtBQUNBUyxlQUFTQyxLQUFULENBQWVDLElBQWYsQ0FBb0JDLEdBQXBCLENBQXdCLGFBQXhCLEVBQXVDLGlCQUFTO0FBQUEsaUNBQ1pDLE1BQU1DLFdBRE07QUFBQSxZQUN0Q0MsTUFEc0Msc0JBQ3RDQSxNQURzQztBQUFBLFlBQzlCQyxhQUQ4QixzQkFDOUJBLGFBRDhCOztBQUU5QyxpRkFBQztBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBLHlCQUN1QnJCLFVBQVVzQixNQUFWLENBQWlCO0FBQ3JDQywwQkFBTSxDQUFDLGNBQUQsRUFBaUIsMEJBQWpCO0FBRCtCLG1CQUFqQixDQUR2Qjs7QUFBQTtBQUNPQyx5QkFEUDtBQUFBO0FBQUEseUJBSW9CQSxRQUFRQyxPQUFSLEVBSnBCOztBQUFBO0FBSU9DLHNCQUpQOztBQUFBLHVCQUtLckIsUUFBUVEsT0FMYjtBQUFBO0FBQUE7QUFBQTs7QUFNU2Msc0JBTlQsd0VBT0t0QixRQUFRUSxPQVBiO0FBQUE7QUFBQSx5QkFTU2EsS0FBS0UsVUFBTCxDQUFnQkQsSUFBaEIsQ0FUVDs7QUFBQTtBQUFBLDJEQVVtQlAsTUFWbkI7O0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTs7QUFVWVMscUJBVlo7O0FBQUEsd0JBV1MxQixLQUFLMkIsT0FBTCxDQUFhRCxHQUFiLEtBQXFCLEtBWDlCO0FBQUE7QUFBQTtBQUFBOztBQUFBO0FBQUEseUJBWWFILEtBQUtLLFlBQUwsQ0FBa0IsRUFBRTVCLE1BQU1pQixPQUFPUyxHQUFQLEVBQVlHLFFBQXBCLEVBQWxCLENBWmI7O0FBQUE7QUFBQTtBQUFBOztBQUFBO0FBQUE7QUFBQTs7QUFBQTtBQUFBLDJEQWdCbUJaLE1BaEJuQjs7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBOztBQWdCWVMscUJBaEJaOztBQUFBLHdCQWlCUzFCLEtBQUsyQixPQUFMLENBQWFELEdBQWIsS0FBcUIsT0FqQjlCO0FBQUE7QUFBQTtBQUFBOztBQUFBO0FBQUEseUJBa0JhSCxLQUFLTyxJQUFMLENBQVUsWUFBWWIsT0FBT1MsR0FBUCxFQUFZRyxRQUFsQyxDQWxCYjs7QUFBQTtBQUFBO0FBQUE7O0FBQUE7QUFBQSx3QkFtQmdCN0IsS0FBSzJCLE9BQUwsQ0FBYUQsR0FBYixLQUFxQixLQW5CckM7QUFBQTtBQUFBO0FBQUE7O0FBQUE7QUFBQSx5QkFvQmFILEtBQUtLLFlBQUwsQ0FBa0IsRUFBRTVCLE1BQU1pQixPQUFPUyxHQUFQLEVBQVlHLFFBQXBCLEVBQWxCLENBcEJiOztBQUFBO0FBQUE7QUFBQTs7QUFBQTtBQUFBO0FBQUEseUJBd0JPTixLQUFLUSxXQUFMLENBQWlCO0FBQ3JCQywyQkFBTyxHQURjO0FBRXJCQyw0QkFBUSxHQUZhO0FBR3JCQyx1Q0FBbUI7QUFIRSxtQkFBakIsQ0F4QlA7O0FBQUE7QUFBQTtBQUFBLHlCQTZCT1gsS0FBS1ksR0FBTCxDQUFTO0FBQ2JuQywwQkFBTUUsUUFBUUYsSUFBUixJQUFtQmtCLGNBQWNsQixJQUFqQyxTQUF5Q0UsUUFBUUcsUUFEMUM7QUFFYkMsNEJBQVFKLFFBQVFJLE1BRkg7QUFHYkMsMkJBQU9MLFFBQVFLLEtBSEY7QUFJYkUsK0JBQVdQLFFBQVFPLFNBSk47QUFLYkQscUNBQWlCTixRQUFRTTtBQUxaLG1CQUFULENBN0JQOztBQUFBO0FBQUE7QUFBQSx5QkFvQ09hLFFBQVFlLEtBQVIsRUFwQ1A7O0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUEsU0FBRDtBQXNDRCxPQXhDRDtBQXlDRDs7Ozs7QUFHSEMsT0FBT0MsT0FBUCxHQUFpQnJDLFdBQWpCIiwiZmlsZSI6InBkZi13ZWJwYWNrLXBsdWdpbi5qcyIsInNvdXJjZVJvb3QiOiIvY2FudmFzL2xpYiIsInNvdXJjZXNDb250ZW50IjpbImNvbnN0IHB1cHBldGVlciA9IHJlcXVpcmUoXCJwdXBwZXRlZXJcIik7XG5jb25zdCBfID0gcmVxdWlyZShcInVuZGVyc2NvcmVcIik7XG5jb25zdCBwYXRoID0gcmVxdWlyZShcInBhdGhcIik7XG5cbmNsYXNzIEdlbmVyYXRlUERGIHtcbiAgY29uc3RydWN0b3Iob3B0aW9ucykge1xuICAgIHRoaXMub3B0aW9ucyA9IF8uZXh0ZW5kKFxuICAgICAge1xuICAgICAgICBwYXRoOiB1bmRlZmluZWQsXG4gICAgICAgIGZpbGVuYW1lOiBcImZpbGUucGRmXCIsXG4gICAgICAgIGZvcm1hdDogXCJBNFwiLFxuICAgICAgICBzY2FsZTogMSxcbiAgICAgICAgcHJpbnRCYWNrZ3JvdW5kOiB0cnVlLFxuICAgICAgICBsYW5kc2NhcGU6IGZhbHNlLFxuICAgICAgICBjb250ZW50OiBcIlwiXG4gICAgICB9LFxuICAgICAgb3B0aW9uc1xuICAgICk7XG4gIH1cbiAgYXBwbHkoY29tcGlsZXIpIHtcbiAgICBjb25zdCBvcHRpb25zID0gdGhpcy5vcHRpb25zO1xuICAgIGNvbXBpbGVyLmhvb2tzLmRvbmUudGFwKFwiR2VuZXJhdGVQREZcIiwgc3RhdHMgPT4ge1xuICAgICAgY29uc3QgeyBhc3NldHMsIG91dHB1dE9wdGlvbnMgfSA9IHN0YXRzLmNvbXBpbGF0aW9uO1xuICAgICAgKGFzeW5jICgpID0+IHtcbiAgICAgICAgY29uc3QgYnJvd3NlciA9IGF3YWl0IHB1cHBldGVlci5sYXVuY2goe1xuICAgICAgICAgIGFyZ3M6IFtcIi0tbm8tc2FuZGJveFwiLCBcIi0tZGlzYWJsZS1zZXR1aWQtc2FuZGJveFwiXVxuICAgICAgICB9KTtcbiAgICAgICAgY29uc3QgcGFnZSA9IGF3YWl0IGJyb3dzZXIubmV3UGFnZSgpO1xuICAgICAgICBpZiAob3B0aW9ucy5jb250ZW50KSB7XG4gICAgICAgICAgY29uc3QgaHRtbCA9IGA8IURPQ1RZUEUgaHRtbD48aHRtbD48aGVhZD48bWV0YSBjaGFyc2V0PVwidXRmLThcIj48L2hlYWQ+PGJvZHk+JHtcbiAgICAgICAgICAgIG9wdGlvbnMuY29udGVudFxuICAgICAgICAgIH08L2JvZHk+PC9odG1sPmA7XG4gICAgICAgICAgYXdhaXQgcGFnZS5zZXRDb250ZW50KGh0bWwpO1xuICAgICAgICAgIGZvciAodmFyIGtleSBpbiBhc3NldHMpIHtcbiAgICAgICAgICAgIGlmIChwYXRoLmV4dG5hbWUoa2V5KSA9PSBcIi5qc1wiKSB7XG4gICAgICAgICAgICAgIGF3YWl0IHBhZ2UuYWRkU2NyaXB0VGFnKHsgcGF0aDogYXNzZXRzW2tleV0uZXhpc3RzQXQgfSk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgfVxuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgIGZvciAodmFyIGtleSBpbiBhc3NldHMpIHtcbiAgICAgICAgICAgIGlmIChwYXRoLmV4dG5hbWUoa2V5KSA9PSBcIi5odG1sXCIpIHtcbiAgICAgICAgICAgICAgYXdhaXQgcGFnZS5nb3RvKFwiZmlsZTovL1wiICsgYXNzZXRzW2tleV0uZXhpc3RzQXQpO1xuICAgICAgICAgICAgfSBlbHNlIGlmIChwYXRoLmV4dG5hbWUoa2V5KSA9PSBcIi5qc1wiKSB7XG4gICAgICAgICAgICAgIGF3YWl0IHBhZ2UuYWRkU2NyaXB0VGFnKHsgcGF0aDogYXNzZXRzW2tleV0uZXhpc3RzQXQgfSk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICAgIGF3YWl0IHBhZ2Uuc2V0Vmlld3BvcnQoe1xuICAgICAgICAgIHdpZHRoOiA4MDAsXG4gICAgICAgICAgaGVpZ2h0OiA2MDAsXG4gICAgICAgICAgZGV2aWNlU2NhbGVGYWN0b3I6IDJcbiAgICAgICAgfSk7XG4gICAgICAgIGF3YWl0IHBhZ2UucGRmKHtcbiAgICAgICAgICBwYXRoOiBvcHRpb25zLnBhdGggfHwgYCR7b3V0cHV0T3B0aW9ucy5wYXRofS8ke29wdGlvbnMuZmlsZW5hbWV9YCxcbiAgICAgICAgICBmb3JtYXQ6IG9wdGlvbnMuZm9ybWF0LFxuICAgICAgICAgIHNjYWxlOiBvcHRpb25zLnNjYWxlLFxuICAgICAgICAgIGxhbmRzY2FwZTogb3B0aW9ucy5sYW5kc2NhcGUsXG4gICAgICAgICAgcHJpbnRCYWNrZ3JvdW5kOiBvcHRpb25zLnByaW50QmFja2dyb3VuZFxuICAgICAgICB9KTtcbiAgICAgICAgYXdhaXQgYnJvd3Nlci5jbG9zZSgpO1xuICAgICAgfSkoKTtcbiAgICB9KTtcbiAgfVxufVxuXG5tb2R1bGUuZXhwb3J0cyA9IEdlbmVyYXRlUERGO1xuIl19",
    "ast": null,
    "map": {
      "version": 3,
      "sources": [
        "pdf-webpack-plugin.js"
      ],
      "names": [
        "puppeteer",
        "require",
        "_",
        "path",
        "GeneratePDF",
        "options",
        "extend",
        "undefined",
        "filename",
        "format",
        "scale",
        "printBackground",
        "landscape",
        "content",
        "compiler",
        "hooks",
        "done",
        "tap",
        "stats",
        "compilation",
        "assets",
        "outputOptions",
        "launch",
        "args",
        "browser",
        "newPage",
        "page",
        "html",
        "setContent",
        "key",
        "extname",
        "addScriptTag",
        "existsAt",
        "goto",
        "setViewport",
        "width",
        "height",
        "deviceScaleFactor",
        "pdf",
        "close",
        "module",
        "exports"
      ],
      "mappings": ";;;;;;;;;;;;;;;;;;;;AAAA,IAAMA,YAAYC,QAAQ,WAAR,CAAlB;AACA,IAAMC,IAAID,QAAQ,YAAR,CAAV;AACA,IAAME,OAAOF,QAAQ,MAAR,CAAb;;IAEMG,W;AACJ,uBAAYC,OAAZ,EAAqB;AAAA;;AACnB,SAAKA,OAAL,GAAeH,EAAEI,MAAF,CACb;AACEH,YAAMI,SADR;AAEEC,gBAAU,UAFZ;AAGEC,cAAQ,IAHV;AAIEC,aAAO,CAJT;AAKEC,uBAAiB,IALnB;AAMEC,iBAAW,KANb;AAOEC,eAAS;AAPX,KADa,EAUbR,OAVa,CAAf;AAYD;;;;0BACKS,Q,EAAU;AAAA;;AACd,UAAMT,UAAU,KAAKA,OAArB;AACAS,eAASC,KAAT,CAAeC,IAAf,CAAoBC,GAApB,CAAwB,aAAxB,EAAuC,iBAAS;AAAA,iCACZC,MAAMC,WADM;AAAA,YACtCC,MADsC,sBACtCA,MADsC;AAAA,YAC9BC,aAD8B,sBAC9BA,aAD8B;;AAE9C,iFAAC;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,yBACuBrB,UAAUsB,MAAV,CAAiB;AACrCC,0BAAM,CAAC,cAAD,EAAiB,0BAAjB;AAD+B,mBAAjB,CADvB;;AAAA;AACOC,yBADP;AAAA;AAAA,yBAIoBA,QAAQC,OAAR,EAJpB;;AAAA;AAIOC,sBAJP;;AAAA,uBAKKrB,QAAQQ,OALb;AAAA;AAAA;AAAA;;AAMSc,sBANT,wEAOKtB,QAAQQ,OAPb;AAAA;AAAA,yBASSa,KAAKE,UAAL,CAAgBD,IAAhB,CATT;;AAAA;AAAA,2DAUmBP,MAVnB;;AAAA;AAAA;AAAA;AAAA;AAAA;;AAUYS,qBAVZ;;AAAA,wBAWS1B,KAAK2B,OAAL,CAAaD,GAAb,KAAqB,KAX9B;AAAA;AAAA;AAAA;;AAAA;AAAA,yBAYaH,KAAKK,YAAL,CAAkB,EAAE5B,MAAMiB,OAAOS,GAAP,EAAYG,QAApB,EAAlB,CAZb;;AAAA;AAAA;AAAA;;AAAA;AAAA;AAAA;;AAAA;AAAA,2DAgBmBZ,MAhBnB;;AAAA;AAAA;AAAA;AAAA;AAAA;;AAgBYS,qBAhBZ;;AAAA,wBAiBS1B,KAAK2B,OAAL,CAAaD,GAAb,KAAqB,OAjB9B;AAAA;AAAA;AAAA;;AAAA;AAAA,yBAkBaH,KAAKO,IAAL,CAAU,YAAYb,OAAOS,GAAP,EAAYG,QAAlC,CAlBb;;AAAA;AAAA;AAAA;;AAAA;AAAA,wBAmBgB7B,KAAK2B,OAAL,CAAaD,GAAb,KAAqB,KAnBrC;AAAA;AAAA;AAAA;;AAAA;AAAA,yBAoBaH,KAAKK,YAAL,CAAkB,EAAE5B,MAAMiB,OAAOS,GAAP,EAAYG,QAApB,EAAlB,CApBb;;AAAA;AAAA;AAAA;;AAAA;AAAA;AAAA,yBAwBON,KAAKQ,WAAL,CAAiB;AACrBC,2BAAO,GADc;AAErBC,4BAAQ,GAFa;AAGrBC,uCAAmB;AAHE,mBAAjB,CAxBP;;AAAA;AAAA;AAAA,yBA6BOX,KAAKY,GAAL,CAAS;AACbnC,0BAAME,QAAQF,IAAR,IAAmBkB,cAAclB,IAAjC,SAAyCE,QAAQG,QAD1C;AAEbC,4BAAQJ,QAAQI,MAFH;AAGbC,2BAAOL,QAAQK,KAHF;AAIbE,+BAAWP,QAAQO,SAJN;AAKbD,qCAAiBN,QAAQM;AALZ,mBAAT,CA7BP;;AAAA;AAAA;AAAA,yBAoCOa,QAAQe,KAAR,EApCP;;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,SAAD;AAsCD,OAxCD;AAyCD;;;;;AAGHC,OAAOC,OAAP,GAAiBrC,WAAjB",
      "file": "pdf-webpack-plugin.js",
      "sourceRoot": "/canvas/lib",
      "sourcesContent": [
        "const puppeteer = require(\"puppeteer\");\nconst _ = require(\"underscore\");\nconst path = require(\"path\");\n\nclass GeneratePDF {\n  constructor(options) {\n    this.options = _.extend(\n      {\n        path: undefined,\n        filename: \"file.pdf\",\n        format: \"A4\",\n        scale: 1,\n        printBackground: true,\n        landscape: false,\n        content: \"\"\n      },\n      options\n    );\n  }\n  apply(compiler) {\n    const options = this.options;\n    compiler.hooks.done.tap(\"GeneratePDF\", stats => {\n      const { assets, outputOptions } = stats.compilation;\n      (async () => {\n        const browser = await puppeteer.launch({\n          args: [\"--no-sandbox\", \"--disable-setuid-sandbox\"]\n        });\n        const page = await browser.newPage();\n        if (options.content) {\n          const html = `<!DOCTYPE html><html><head><meta charset=\"utf-8\"></head><body>${\n            options.content\n          }</body></html>`;\n          await page.setContent(html);\n          for (var key in assets) {\n            if (path.extname(key) == \".js\") {\n              await page.addScriptTag({ path: assets[key].existsAt });\n            }\n          }\n        } else {\n          for (var key in assets) {\n            if (path.extname(key) == \".html\") {\n              await page.goto(\"file://\" + assets[key].existsAt);\n            } else if (path.extname(key) == \".js\") {\n              await page.addScriptTag({ path: assets[key].existsAt });\n            }\n          }\n        }\n        await page.setViewport({\n          width: 800,\n          height: 600,\n          deviceScaleFactor: 2\n        });\n        await page.pdf({\n          path: options.path || `${outputOptions.path}/${options.filename}`,\n          format: options.format,\n          scale: options.scale,\n          landscape: options.landscape,\n          printBackground: options.printBackground\n        });\n        await browser.close();\n      })();\n    });\n  }\n}\n\nmodule.exports = GeneratePDF;\n"
      ]
    },
    "mtime": 1523903738000
  },
  "{\"filename\":\"/canvas/src/app.js\",\"env\":{\"development\":{\"plugins\":[]}},\"retainLines\":false,\"highlightCode\":true,\"suppressDeprecationMessages\":false,\"presets\":[],\"plugins\":[[[],null],[[],null],[[],null],[[],null],[[],null],[[],null],[[],null],[[],null],[[],null],[[],null],[[],null],[[],null],[[],{\"loose\":false,\"spec\":false}],[[],null],[[],null],[[],{\"spec\":false}],[[],null],[[],{\"loose\":false}],[[],null],[[],null],[[],null],[[],{\"loose\":false}],[[],{\"loose\":false}],[[],null],[[],null],[[],null],[[],{\"loose\":false}],[[],null],[[],{\"loose\":false}],[[],null],[[],null],[[],{\"loose\":false}],[[],{\"async\":false,\"asyncGenerators\":false}],[[],null],[[],null],[[],null],[[],null],[[],null],[[],null],[[],null],[[],null],[[],null],[[],null],[[],null],[[],null],[[],null],[[],null],[[],null],[[],null],[[],null],[[],null],[[],null],[[],null],[[],{\"loose\":false,\"spec\":false}],[[],null],[[],null],[[],{\"spec\":false}],[[],null],[[],{\"loose\":false}],[[],null],[[],null],[[],null],[[],{\"loose\":false}],[[],{\"loose\":false}],[[],null],[[],null],[[],null],[[],{\"loose\":false}],[[],null],[[],{\"loose\":false}],[[],null],[[],null],[[],{\"loose\":false}],[[],{\"async\":false,\"asyncGenerators\":false}]],\"ignore\":[],\"code\":true,\"metadata\":true,\"ast\":true,\"comments\":true,\"compact\":\"auto\",\"minified\":false,\"sourceRoot\":\"/canvas/src\",\"babelrc\":true,\"sourceType\":\"module\",\"moduleIds\":false,\"passPerPreset\":false,\"parserOpts\":false,\"generatorOpts\":false}:6.26.0:production": {
    "metadata": {
      "usedHelpers": [
        "asyncToGenerator",
        "extends",
        "interopRequireDefault"
      ],
      "marked": [],
      "modules": {
        "imports": [
          {
            "source": "express",
            "imported": [
              "default"
            ],
            "specifiers": [
              {
                "kind": "named",
                "imported": "default",
                "local": "express"
              }
            ]
          },
          {
            "source": "body-parser",
            "imported": [
              "default"
            ],
            "specifiers": [
              {
                "kind": "named",
                "imported": "default",
                "local": "bodyParser"
              }
            ]
          },
          {
            "source": "ioredis",
            "imported": [
              "default"
            ],
            "specifiers": [
              {
                "kind": "named",
                "imported": "default",
                "local": "Redis"
              }
            ]
          },
          {
            "source": "puppeteer",
            "imported": [
              "default"
            ],
            "specifiers": [
              {
                "kind": "named",
                "imported": "default",
                "local": "puppeteer"
              }
            ]
          },
          {
            "source": "crypto",
            "imported": [
              "default"
            ],
            "specifiers": [
              {
                "kind": "named",
                "imported": "default",
                "local": "crypto"
              }
            ]
          },
          {
            "source": "fs",
            "imported": [
              "default"
            ],
            "specifiers": [
              {
                "kind": "named",
                "imported": "default",
                "local": "fs"
              }
            ]
          },
          {
            "source": "path",
            "imported": [
              "default"
            ],
            "specifiers": [
              {
                "kind": "named",
                "imported": "default",
                "local": "path"
              }
            ]
          }
        ],
        "exports": {
          "exported": [],
          "specifiers": []
        }
      }
    },
    "options": {
      "filename": "/canvas/src/app.js",
      "filenameRelative": "/canvas/src/app.js",
      "env": {},
      "retainLines": false,
      "highlightCode": true,
      "suppressDeprecationMessages": false,
      "presets": [],
      "plugins": [
        [
          [],
          null
        ],
        [
          [],
          null
        ],
        [
          [],
          null
        ],
        [
          [],
          null
        ],
        [
          [],
          null
        ],
        [
          [],
          null
        ],
        [
          [],
          null
        ],
        [
          [],
          null
        ],
        [
          [],
          null
        ],
        [
          [],
          null
        ],
        [
          [],
          null
        ],
        [
          [],
          null
        ],
        [
          [],
          {
            "loose": false,
            "spec": false
          }
        ],
        [
          [],
          null
        ],
        [
          [],
          null
        ],
        [
          [],
          {
            "spec": false
          }
        ],
        [
          [],
          null
        ],
        [
          [],
          {
            "loose": false
          }
        ],
        [
          [],
          null
        ],
        [
          [],
          null
        ],
        [
          [],
          null
        ],
        [
          [],
          {
            "loose": false
          }
        ],
        [
          [],
          {
            "loose": false
          }
        ],
        [
          [],
          null
        ],
        [
          [],
          null
        ],
        [
          [],
          null
        ],
        [
          [],
          {
            "loose": false
          }
        ],
        [
          [],
          null
        ],
        [
          [],
          {
            "loose": false
          }
        ],
        [
          [],
          null
        ],
        [
          [],
          null
        ],
        [
          [],
          {
            "loose": false
          }
        ],
        [
          [],
          {
            "async": false,
            "asyncGenerators": false
          }
        ],
        [
          [],
          null
        ],
        [
          [],
          null
        ],
        [
          [],
          null
        ],
        [
          [],
          null
        ],
        [
          [],
          null
        ],
        [
          [],
          null
        ],
        [
          [],
          null
        ],
        [
          [],
          null
        ],
        [
          [],
          null
        ],
        [
          [],
          null
        ],
        [
          [],
          null
        ],
        [
          [],
          null
        ],
        [
          [],
          null
        ],
        [
          [],
          null
        ],
        [
          [],
          null
        ],
        [
          [],
          null
        ],
        [
          [],
          null
        ],
        [
          [],
          null
        ],
        [
          [],
          null
        ],
        [
          [],
          null
        ],
        [
          [],
          {
            "loose": false,
            "spec": false
          }
        ],
        [
          [],
          null
        ],
        [
          [],
          null
        ],
        [
          [],
          {
            "spec": false
          }
        ],
        [
          [],
          null
        ],
        [
          [],
          {
            "loose": false
          }
        ],
        [
          [],
          null
        ],
        [
          [],
          null
        ],
        [
          [],
          null
        ],
        [
          [],
          {
            "loose": false
          }
        ],
        [
          [],
          {
            "loose": false
          }
        ],
        [
          [],
          null
        ],
        [
          [],
          null
        ],
        [
          [],
          null
        ],
        [
          [],
          {
            "loose": false
          }
        ],
        [
          [],
          null
        ],
        [
          [],
          {
            "loose": false
          }
        ],
        [
          [],
          null
        ],
        [
          [],
          null
        ],
        [
          [],
          {
            "loose": false
          }
        ],
        [
          [],
          {
            "async": false,
            "asyncGenerators": false
          }
        ]
      ],
      "ignore": [],
      "code": true,
      "metadata": true,
      "ast": false,
      "comments": true,
      "compact": "auto",
      "minified": false,
      "sourceMaps": "both",
      "sourceMapTarget": "app.js",
      "sourceFileName": "app.js",
      "sourceRoot": "/canvas/src",
      "babelrc": false,
      "sourceType": "module",
      "moduleRoot": "/canvas/src",
      "moduleIds": false,
      "passPerPreset": false,
      "parserOpts": false,
      "generatorOpts": false,
      "basename": "app"
    },
    "ignored": false,
    "code": "\"use strict\";\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\n\nvar _stringify = require(\"babel-runtime/core-js/json/stringify\");\n\nvar _stringify2 = _interopRequireDefault(_stringify);\n\nvar _extends2 = require(\"babel-runtime/helpers/extends\");\n\nvar _extends3 = _interopRequireDefault(_extends2);\n\nvar _promise = require(\"babel-runtime/core-js/promise\");\n\nvar _promise2 = _interopRequireDefault(_promise);\n\nvar _regenerator = require(\"babel-runtime/regenerator\");\n\nvar _regenerator2 = _interopRequireDefault(_regenerator);\n\nvar _getIterator2 = require(\"babel-runtime/core-js/get-iterator\");\n\nvar _getIterator3 = _interopRequireDefault(_getIterator2);\n\nvar _asyncToGenerator2 = require(\"babel-runtime/helpers/asyncToGenerator\");\n\nvar _asyncToGenerator3 = _interopRequireDefault(_asyncToGenerator2);\n\nvar _express = require(\"express\");\n\nvar _express2 = _interopRequireDefault(_express);\n\nvar _bodyParser = require(\"body-parser\");\n\nvar _bodyParser2 = _interopRequireDefault(_bodyParser);\n\nvar _ioredis = require(\"ioredis\");\n\nvar _ioredis2 = _interopRequireDefault(_ioredis);\n\nvar _puppeteer = require(\"puppeteer\");\n\nvar _puppeteer2 = _interopRequireDefault(_puppeteer);\n\nvar _crypto = require(\"crypto\");\n\nvar _crypto2 = _interopRequireDefault(_crypto);\n\nvar _fs = require(\"fs\");\n\nvar _fs2 = _interopRequireDefault(_fs);\n\nvar _path = require(\"path\");\n\nvar _path2 = _interopRequireDefault(_path);\n\nfunction _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }\n\nvar FILES_DIR = _path2.default.join(__dirname, \"../files\");\nvar FORMATS = [\"A3\", \"A2\"];\nvar URL = process.env.URL || \"http://localhost:8000\";\n\n/*\n * First render\n */\nif (!_fs2.default.existsSync(FILES_DIR)) {\n  _fs2.default.mkdirSync(FILES_DIR);\n}\nsetTimeout((0, _asyncToGenerator3.default)( /*#__PURE__*/_regenerator2.default.mark(function _callee() {\n  var _iteratorNormalCompletion, _didIteratorError, _iteratorError, _iterator, _step, format;\n\n  return _regenerator2.default.wrap(function _callee$(_context) {\n    while (1) {\n      switch (_context.prev = _context.next) {\n        case 0:\n          _iteratorNormalCompletion = true;\n          _didIteratorError = false;\n          _iteratorError = undefined;\n          _context.prev = 3;\n          _iterator = (0, _getIterator3.default)(FORMATS);\n\n        case 5:\n          if (_iteratorNormalCompletion = (_step = _iterator.next()).done) {\n            _context.next = 12;\n            break;\n          }\n\n          format = _step.value;\n          _context.next = 9;\n          return render(null, \"default\", format);\n\n        case 9:\n          _iteratorNormalCompletion = true;\n          _context.next = 5;\n          break;\n\n        case 12:\n          _context.next = 18;\n          break;\n\n        case 14:\n          _context.prev = 14;\n          _context.t0 = _context[\"catch\"](3);\n          _didIteratorError = true;\n          _iteratorError = _context.t0;\n\n        case 18:\n          _context.prev = 18;\n          _context.prev = 19;\n\n          if (!_iteratorNormalCompletion && _iterator.return) {\n            _iterator.return();\n          }\n\n        case 21:\n          _context.prev = 21;\n\n          if (!_didIteratorError) {\n            _context.next = 24;\n            break;\n          }\n\n          throw _iteratorError;\n\n        case 24:\n          return _context.finish(21);\n\n        case 25:\n          return _context.finish(18);\n\n        case 26:\n          console.log(\"Default PDF rendered\");\n\n        case 27:\n        case \"end\":\n          return _context.stop();\n      }\n    }\n  }, _callee, undefined, [[3, 14, 18, 26], [19,, 21, 25]]);\n})), 10000);\n\nvar app = (0, _express2.default)();\nvar redis = new _ioredis2.default(process.env.REDIS || \"redis://localhost:6379/electoral-canvas\");\n\nredis.on(\"connect\", function () {\n  console.log(\"Connected to redis server\");\n});\n\napp.use(_bodyParser2.default.json());\napp.use(_bodyParser2.default.urlencoded({ extended: true }));\n\nvar getCanvasPath = function getCanvasPath(name, format) {\n  return _path2.default.join(FILES_DIR, \"canvas-\" + name + \"-\" + format + \".pdf\");\n};\n\nvar render = function () {\n  var _ref2 = (0, _asyncToGenerator3.default)( /*#__PURE__*/_regenerator2.default.mark(function _callee2(id, name, format) {\n    var pageUrl, browser, page;\n    return _regenerator2.default.wrap(function _callee2$(_context2) {\n      while (1) {\n        switch (_context2.prev = _context2.next) {\n          case 0:\n            pageUrl = id ? URL + \"/\" + id : URL;\n            _context2.next = 3;\n            return _puppeteer2.default.launch({\n              args: [\"--no-sandbox\", \"--disable-setuid-sandbox\"]\n            });\n\n          case 3:\n            browser = _context2.sent;\n            _context2.next = 6;\n            return browser.newPage();\n\n          case 6:\n            page = _context2.sent;\n            _context2.next = 9;\n            return page.goto(pageUrl);\n\n          case 9:\n            _context2.next = 11;\n            return page.pdf({\n              path: getCanvasPath(id || name, format),\n              format: format,\n              scale: 1,\n              landscape: true,\n              printBackground: true\n            });\n\n          case 11:\n            _context2.next = 13;\n            return browser.close();\n\n          case 13:\n          case \"end\":\n            return _context2.stop();\n        }\n      }\n    }, _callee2, this);\n  }));\n\n  return function render(_x, _x2, _x3) {\n    return _ref2.apply(this, arguments);\n  };\n}();\n\nvar renderCanvas = function () {\n  var _ref3 = (0, _asyncToGenerator3.default)( /*#__PURE__*/_regenerator2.default.mark(function _callee3(id, name) {\n    var _this = this;\n\n    var _iteratorNormalCompletion2, _didIteratorError2, _iteratorError2, _loop, _iterator2, _step2;\n\n    return _regenerator2.default.wrap(function _callee3$(_context4) {\n      while (1) {\n        switch (_context4.prev = _context4.next) {\n          case 0:\n            _iteratorNormalCompletion2 = true;\n            _didIteratorError2 = false;\n            _iteratorError2 = undefined;\n            _context4.prev = 3;\n            _loop = /*#__PURE__*/_regenerator2.default.mark(function _loop() {\n              var format, exists;\n              return _regenerator2.default.wrap(function _loop$(_context3) {\n                while (1) {\n                  switch (_context3.prev = _context3.next) {\n                    case 0:\n                      format = _step2.value;\n                      _context3.next = 3;\n                      return new _promise2.default(function (resolve, reject) {\n                        _fs2.default.open(getCanvasPath(id || name, format), \"r\", function (err, fd) {\n                          if (err && err.code === \"ENOENT\") {\n                            resolve(false);\n                          } else {\n                            resolve(true);\n                          }\n                        });\n                      });\n\n                    case 3:\n                      exists = _context3.sent;\n\n                      if (exists) {\n                        _context3.next = 8;\n                        break;\n                      }\n\n                      console.log(\"Generating \" + format + \" PDF for \" + (id || name));\n                      _context3.next = 8;\n                      return render(id, name, format);\n\n                    case 8:\n                    case \"end\":\n                      return _context3.stop();\n                  }\n                }\n              }, _loop, _this);\n            });\n            _iterator2 = (0, _getIterator3.default)(FORMATS);\n\n          case 6:\n            if (_iteratorNormalCompletion2 = (_step2 = _iterator2.next()).done) {\n              _context4.next = 11;\n              break;\n            }\n\n            return _context4.delegateYield(_loop(), \"t0\", 8);\n\n          case 8:\n            _iteratorNormalCompletion2 = true;\n            _context4.next = 6;\n            break;\n\n          case 11:\n            _context4.next = 17;\n            break;\n\n          case 13:\n            _context4.prev = 13;\n            _context4.t1 = _context4[\"catch\"](3);\n            _didIteratorError2 = true;\n            _iteratorError2 = _context4.t1;\n\n          case 17:\n            _context4.prev = 17;\n            _context4.prev = 18;\n\n            if (!_iteratorNormalCompletion2 && _iterator2.return) {\n              _iterator2.return();\n            }\n\n          case 20:\n            _context4.prev = 20;\n\n            if (!_didIteratorError2) {\n              _context4.next = 23;\n              break;\n            }\n\n            throw _iteratorError2;\n\n          case 23:\n            return _context4.finish(20);\n\n          case 24:\n            return _context4.finish(17);\n\n          case 25:\n          case \"end\":\n            return _context4.stop();\n        }\n      }\n    }, _callee3, this, [[3, 13, 17, 25], [18,, 20, 24]]);\n  }));\n\n  return function renderCanvas(_x4, _x5) {\n    return _ref3.apply(this, arguments);\n  };\n}();\n\nvar parseFromLiane = function parseFromLiane(canvas) {\n  var result = (0, _extends3.default)({}, canvas);\n  if (result.basic_info && result.basic_info.location) {\n    result.basic_info.location = result.basic_info.location.city.name;\n  }\n  if (result.commitments && result.commitments.commitments) {\n    result.commitments = result.commitments.commitments.map(function (c) {\n      return c.title;\n    });\n  }\n  if (result.causes && result.causes.causes) {\n    result.causes = result.causes.causes.map(function (c) {\n      return c.title;\n    });\n  }\n  if (result.principles && result.principles.principles) {\n    result.principles = result.principles.principles.map(function (p) {\n      return p.title;\n    });\n  }\n  if (result.assets && result.assets.assets) {\n    result.assets = result.assets.assets.map(function (p) {\n      return p.description;\n    }).join(\"; \");\n  }\n  if (result.team && result.team.team) {\n    result.team = result.team.team.map(function (t) {\n      return [t.name, t.role];\n    });\n  }\n  if (result.potential_voter && result.potential_voter.profiles) {\n    result.electorate = result.potential_voter.profiles.map(function (profile) {\n      return (0, _extends3.default)({}, profile, {\n        location: profile.territory ? profile.territory.location.city.name : \"\"\n      });\n    });\n  }\n  return result;\n};\n\napp.post(\"/\", function (req, res) {\n  // Validate\n  if (!req.body.canvas) {\n    res.status(500).send(\"You must provide a canvas object\");\n  }\n\n  var canvas = req.body.canvas;\n\n  if (req.body.fromLiane) {\n    canvas = parseFromLiane(req.body.canvas);\n  }\n\n  var hash = _crypto2.default.createHash(\"sha1\").update((0, _stringify2.default)(canvas)).digest(\"hex\");\n\n  var id = hash.substr(0, 7);\n  var fromCache = false;\n\n  redis.get(id).then(function (payload) {\n    fromCache = !!payload;\n    payload = payload ? JSON.parse(payload) : {\n      id: id,\n      key: hash,\n      data: canvas\n    };\n    if (!fromCache) {\n      redis.set(payload.id, (0, _stringify2.default)(payload));\n    }\n    renderCanvas(payload.id).then(function () {\n      if (req.body.json) {\n        res.send({ id: payload.id });\n      } else {\n        res.redirect(\"/\" + payload.id);\n      }\n    }).catch(function (err) {\n      console.log(err);\n      res.send({ error: true });\n    });\n  });\n});\n\napp.get(/^\\/(\\b[0-9a-f]{5,40}\\b)$/, function (req, res) {\n  var id = req.params[0];\n  redis.get(id).then(function (payload) {\n    if (!payload) {\n      res.status(404).send(\"Not Found\");\n    } else {\n      res.send(JSON.parse(payload).data);\n    }\n  }).catch(function (err) {\n    console.log(err);\n  });\n});\n\nexports.default = app;\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImFwcC5qcyJdLCJuYW1lcyI6WyJGSUxFU19ESVIiLCJqb2luIiwiX19kaXJuYW1lIiwiRk9STUFUUyIsIlVSTCIsInByb2Nlc3MiLCJlbnYiLCJleGlzdHNTeW5jIiwibWtkaXJTeW5jIiwic2V0VGltZW91dCIsImZvcm1hdCIsInJlbmRlciIsImNvbnNvbGUiLCJsb2ciLCJhcHAiLCJyZWRpcyIsIlJFRElTIiwib24iLCJ1c2UiLCJqc29uIiwidXJsZW5jb2RlZCIsImV4dGVuZGVkIiwiZ2V0Q2FudmFzUGF0aCIsIm5hbWUiLCJpZCIsInBhZ2VVcmwiLCJsYXVuY2giLCJhcmdzIiwiYnJvd3NlciIsIm5ld1BhZ2UiLCJwYWdlIiwiZ290byIsInBkZiIsInBhdGgiLCJzY2FsZSIsImxhbmRzY2FwZSIsInByaW50QmFja2dyb3VuZCIsImNsb3NlIiwicmVuZGVyQ2FudmFzIiwicmVzb2x2ZSIsInJlamVjdCIsIm9wZW4iLCJlcnIiLCJmZCIsImNvZGUiLCJleGlzdHMiLCJwYXJzZUZyb21MaWFuZSIsImNhbnZhcyIsInJlc3VsdCIsImJhc2ljX2luZm8iLCJsb2NhdGlvbiIsImNpdHkiLCJjb21taXRtZW50cyIsIm1hcCIsImMiLCJ0aXRsZSIsImNhdXNlcyIsInByaW5jaXBsZXMiLCJwIiwiYXNzZXRzIiwiZGVzY3JpcHRpb24iLCJ0ZWFtIiwidCIsInJvbGUiLCJwb3RlbnRpYWxfdm90ZXIiLCJwcm9maWxlcyIsImVsZWN0b3JhdGUiLCJwcm9maWxlIiwidGVycml0b3J5IiwicG9zdCIsInJlcSIsInJlcyIsImJvZHkiLCJzdGF0dXMiLCJzZW5kIiwiZnJvbUxpYW5lIiwiaGFzaCIsImNyZWF0ZUhhc2giLCJ1cGRhdGUiLCJkaWdlc3QiLCJzdWJzdHIiLCJmcm9tQ2FjaGUiLCJnZXQiLCJ0aGVuIiwicGF5bG9hZCIsIkpTT04iLCJwYXJzZSIsImtleSIsImRhdGEiLCJzZXQiLCJyZWRpcmVjdCIsImNhdGNoIiwiZXJyb3IiLCJwYXJhbXMiXSwibWFwcGlu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LENBQUNDLE9BQUwsRUFBYztBQUNaYixVQUFJRSxNQUFKLENBQVcsR0FBWCxFQUFnQkMsSUFBaEIsQ0FBcUIsV0FBckI7QUFDRCxLQUZELE1BRU87QUFDTEgsVUFBSUcsSUFBSixDQUFTVyxLQUFLQyxLQUFMLENBQVdGLE9BQVgsRUFBb0JJLElBQTdCO0FBQ0Q7QUFDRixHQVJILEVBU0dHLEtBVEgsQ0FTUyxlQUFPO0FBQ1ovRSxZQUFRQyxHQUFSLENBQVk2QixHQUFaO0FBQ0QsR0FYSDtBQVlELENBZEQ7O2tCQWdCZTVCLEciLCJmaWxlIjoiYXBwLmpzIiwic291cmNlUm9vdCI6Ii9jYW52YXMvc3JjIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IGV4cHJlc3MgZnJvbSBcImV4cHJlc3NcIjtcbmltcG9ydCBib2R5UGFyc2VyIGZyb20gXCJib2R5LXBhcnNlclwiO1xuaW1wb3J0IFJlZGlzIGZyb20gXCJpb3JlZGlzXCI7XG5pbXBvcnQgcHVwcGV0ZWVyIGZyb20gXCJwdXBwZXRlZXJcIjtcbmltcG9ydCBjcnlwdG8gZnJvbSBcImNyeXB0b1wiO1xuaW1wb3J0IGZzIGZyb20gXCJmc1wiO1xuaW1wb3J0IHBhdGggZnJvbSBcInBhdGhcIjtcblxuY29uc3QgRklMRVNfRElSID0gcGF0aC5qb2luKF9fZGlybmFtZSwgXCIuLi9maWxlc1wiKTtcbmNvbnN0IEZPUk1BVFMgPSBbXCJBM1wiLCBcIkEyXCJdO1xuY29uc3QgVVJMID0gcHJvY2Vzcy5lbnYuVVJMIHx8IFwiaHR0cDovL2xvY2FsaG9zdDo4MDAwXCI7XG5cbi8qXG4gKiBGaXJzdCByZW5kZXJcbiAqL1xuaWYgKCFmcy5leGlzdHNTeW5jKEZJTEVTX0RJUikpIHtcbiAgZnMubWtkaXJTeW5jKEZJTEVTX0RJUik7XG59XG5zZXRUaW1lb3V0KGFzeW5jICgpID0+IHtcbiAgZm9yIChjb25zdCBmb3JtYXQgb2YgRk9STUFUUykge1xuICAgIGF3YWl0IHJlbmRlcihudWxsLCBcImRlZmF1bHRcIiwgZm9ybWF0KTtcbiAgfVxuICBjb25zb2xlLmxvZyhcIkRlZmF1bHQgUERGIHJlbmRlcmVkXCIpO1xufSwgMTAwMDApO1xuXG5jb25zdCBhcHAgPSBleHByZXNzKCk7XG5jb25zdCByZWRpcyA9IG5ldyBSZWRpcyhcbiAgcHJvY2Vzcy5lbnYuUkVESVMgfHwgXCJyZWRpczovL2xvY2FsaG9zdDo2Mzc5L2VsZWN0b3JhbC1jYW52YXNcIlxuKTtcblxucmVkaXMub24oXCJjb25uZWN0XCIsICgpID0+IHtcbiAgY29uc29sZS5sb2coXCJDb25uZWN0ZWQgdG8gcmVkaXMgc2VydmVyXCIpO1xufSk7XG5cbmFwcC51c2UoYm9keVBhcnNlci5qc29uKCkpO1xuYXBwLnVzZShib2R5UGFyc2VyLnVybGVuY29kZWQoeyBleHRlbmRlZDogdHJ1ZSB9KSk7XG5cbmNvbnN0IGdldENhbnZhc1BhdGggPSAobmFtZSwgZm9ybWF0KSA9PiB7XG4gIHJldHVybiBwYXRoLmpvaW4oRklMRVNfRElSLCBgY2FudmFzLSR7bmFtZX0tJHtmb3JtYXR9LnBkZmApO1xufTtcblxuY29uc3QgcmVuZGVyID0gYXN5bmMgZnVuY3Rpb24oaWQsIG5hbWUsIGZvcm1hdCkge1xuICBjb25zdCBwYWdlVXJsID0gaWQgPyBVUkwgKyBcIi9cIiArIGlkIDogVVJMO1xuICBjb25zdCBicm93c2VyID0gYXdhaXQgcHVwcGV0ZWVyLmxhdW5jaCh7XG4gICAgYXJnczogW1wiLS1uby1zYW5kYm94XCIsIFwiLS1kaXNhYmxlLXNldHVpZC1zYW5kYm94XCJdXG4gIH0pO1xuICBjb25zdCBwYWdlID0gYXdhaXQgYnJvd3Nlci5uZXdQYWdlKCk7XG4gIGF3YWl0IHBhZ2UuZ290byhwYWdlVXJsKTtcbiAgYXdhaXQgcGFnZS5wZGYoe1xuICAgIHBhdGg6IGdldENhbnZhc1BhdGgoaWQgfHwgbmFtZSwgZm9ybWF0KSxcbiAgICBmb3JtYXQsXG4gICAgc2NhbGU6IDEsXG4gICAgbGFuZHNjYXBlOiB0cnVlLFxuICAgIHByaW50QmFja2dyb3VuZDogdHJ1ZVxuICB9KTtcbiAgYXdhaXQgYnJvd3Nlci5jbG9zZSgpO1xufTtcblxuY29uc3QgcmVuZGVyQ2FudmFzID0gYXN5bmMgZnVuY3Rpb24oaWQsIG5hbWUpIHtcbiAgZm9yIChjb25zdCBmb3JtYXQgb2YgRk9STUFUUykge1xuICAgIGNvbnN0IGV4aXN0cyA9IGF3YWl0IG5ldyBQcm9taXNlKChyZXNvbHZlLCByZWplY3QpID0+IHtcbiAgICAgIGZzLm9wZW4oZ2V0Q2FudmFzUGF0aChpZCB8fCBuYW1lLCBmb3JtYXQpLCBcInJcIiwgKGVyciwgZmQpID0+IHtcbiAgICAgICAgaWYgKGVyciAmJiBlcnIuY29kZSA9PT0gXCJFTk9FTlRcIikge1xuICAgICAgICAgIHJlc29sdmUoZmFsc2UpO1xuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgIHJlc29sdmUodHJ1ZSk7XG4gICAgICAgIH1cbiAgICAgIH0pO1xuICAgIH0pO1xuICAgIGlmICghZXhpc3RzKSB7XG4gICAgICBjb25zb2xlLmxvZyhgR2VuZXJhdGluZyAke2Zvcm1hdH0gUERGIGZvciAke2lkIHx8IG5hbWV9YCk7XG4gICAgICBhd2FpdCByZW5kZXIoaWQsIG5hbWUsIGZvcm1hdCk7XG4gICAgfVxuICB9XG59O1xuXG5jb25zdCBwYXJzZUZyb21MaWFuZSA9IGZ1bmN0aW9uKGNhbnZhcykge1xuICBsZXQgcmVzdWx0ID0geyAuLi5jYW52YXMgfTtcbiAgaWYgKHJlc3VsdC5iYXNpY19pbmZvICYmIHJlc3VsdC5iYXNpY19pbmZvLmxvY2F0aW9uKSB7XG4gICAgcmVzdWx0LmJhc2ljX2luZm8ubG9jYXRpb24gPSByZXN1bHQuYmFzaWNfaW5mby5sb2NhdGlvbi5jaXR5Lm5hbWU7XG4gIH1cbiAgaWYgKHJlc3VsdC5jb21taXRtZW50cyAmJiByZXN1bHQuY29tbWl0bWVudHMuY29tbWl0bWVudHMpIHtcbiAgICByZXN1bHQuY29tbWl0bWVudHMgPSByZXN1bHQuY29tbWl0bWVudHMuY29tbWl0bWVudHMubWFwKGMgPT4gYy50aXRsZSk7XG4gIH1cbiAgaWYgKHJlc3VsdC5jYXVzZXMgJiYgcmVzdWx0LmNhdXNlcy5jYXVzZXMpIHtcbiAgICByZXN1bHQuY2F1c2VzID0gcmVzdWx0LmNhdXNlcy5jYXVzZXMubWFwKGMgPT4gYy50aXRsZSk7XG4gIH1cbiAgaWYgKHJlc3VsdC5wcmluY2lwbGVzICYmIHJlc3VsdC5wcmluY2lwbGVzLnByaW5jaXBsZXMpIHtcbiAgICByZXN1bHQucHJpbmNpcGxlcyA9IHJlc3VsdC5wcmluY2lwbGVzLnByaW5jaXBsZXMubWFwKHAgPT4gcC50aXRsZSk7XG4gIH1cbiAgaWYgKHJlc3VsdC5hc3NldHMgJiYgcmVzdWx0LmFzc2V0cy5hc3NldHMpIHtcbiAgICByZXN1bHQuYXNzZXRzID0gcmVzdWx0LmFzc2V0cy5hc3NldHMubWFwKHAgPT4gcC5kZXNjcmlwdGlvbikuam9pbihcIjsgXCIpO1xuICB9XG4gIGlmIChyZXN1bHQudGVhbSAmJiByZXN1bHQudGVhbS50ZWFtKSB7XG4gICAgcmVzdWx0LnRlYW0gPSByZXN1bHQudGVhbS50ZWFtLm1hcCh0ID0+IFt0Lm5hbWUsIHQucm9sZV0pO1xuICB9XG4gIGlmIChyZXN1bHQucG90ZW50aWFsX3ZvdGVyICYmIHJlc3VsdC5wb3RlbnRpYWxfdm90ZXIucHJvZmlsZXMpIHtcbiAgICByZXN1bHQuZWxlY3RvcmF0ZSA9IHJlc3VsdC5wb3RlbnRpYWxfdm90ZXIucHJvZmlsZXMubWFwKHByb2ZpbGUgPT4ge1xuICAgICAgcmV0dXJuIHtcbiAgICAgICAgLi4ucHJvZmlsZSxcbiAgICAgICAgbG9jYXRpb246IHByb2ZpbGUudGVycml0b3J5ID8gcHJvZmlsZS50ZXJyaXRvcnkubG9jYXRpb24uY2l0eS5uYW1lIDogXCJcIlxuICAgICAgfTtcbiAgICB9KTtcbiAgfVxuICByZXR1cm4gcmVzdWx0O1xufTtcblxuYXBwLnBvc3QoXCIvXCIsIChyZXEsIHJlcykgPT4ge1xuICAvLyBWYWxpZGF0ZVxuICBpZiAoIXJlcS5ib2R5LmNhbnZhcykge1xuICAgIHJlcy5zdGF0dXMoNTAwKS5zZW5kKFwiWW91IG11c3QgcHJvdmlkZSBhIGNhbnZhcyBvYmplY3RcIik7XG4gIH1cblxuICBsZXQgY2FudmFzID0gcmVxLmJvZHkuY2FudmFzO1xuXG4gIGlmIChyZXEuYm9keS5mcm9tTGlhbmUpIHtcbiAgICBjYW52YXMgPSBwYXJzZUZyb21MaWFuZShyZXEuYm9keS5jYW52YXMpO1xuICB9XG5cbiAgY29uc3QgaGFzaCA9IGNyeXB0b1xuICAgIC5jcmVhdGVIYXNoKFwic2hhMVwiKVxuICAgIC51cGRhdGUoSlNPTi5zdHJpbmdpZnkoY2FudmFzKSlcbiAgICAuZGlnZXN0KFwiaGV4XCIpO1xuXG4gIGNvbnN0IGlkID0gaGFzaC5zdWJzdHIoMCwgNyk7XG4gIGxldCBmcm9tQ2FjaGUgPSBmYWxzZTtcblxuICByZWRpcy5nZXQoaWQpLnRoZW4ocGF5bG9hZCA9PiB7XG4gICAgZnJvbUNhY2hlID0gISFwYXlsb2FkO1xuICAgIHBheWxvYWQgPSBwYXlsb2FkXG4gICAgICA/IEpTT04ucGFyc2UocGF5bG9hZClcbiAgICAgIDoge1xuICAgICAgICAgIGlkLFxuICAgICAgICAgIGtleTogaGFzaCxcbiAgICAgICAgICBkYXRhOiBjYW52YXNcbiAgICAgICAgfTtcbiAgICBpZiAoIWZyb21DYWNoZSkge1xuICAgICAgcmVkaXMuc2V0KHBheWxvYWQuaWQsIEpTT04uc3RyaW5naWZ5KHBheWxvYWQpKTtcbiAgICB9XG4gICAgcmVuZGVyQ2FudmFzKHBheWxvYWQuaWQpXG4gICAgICAudGhlbigoKSA9PiB7XG4gICAgICAgIGlmIChyZXEuYm9keS5qc29uKSB7XG4gICAgICAgICAgcmVzLnNlbmQoeyBpZDogcGF5bG9hZC5pZCB9KTtcbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICByZXMucmVkaXJlY3QoYC8ke3BheWxvYWQuaWR9YCk7XG4gICAgICAgIH1cbiAgICAgIH0pXG4gICAgICAuY2F0Y2goZXJyID0+IHtcbiAgICAgICAgY29uc29sZS5sb2coZXJyKTtcbiAgICAgICAgcmVzLnNlbmQoeyBlcnJvcjogdHJ1ZSB9KTtcbiAgICAgIH0pO1xuICB9KTtcbn0pO1xuXG5hcHAuZ2V0KC9eXFwvKFxcYlswLTlhLWZdezUsNDB9XFxiKSQvLCAocmVxLCByZXMpID0+IHtcbiAgY29uc3QgaWQgPSByZXEucGFyYW1zWzBdO1xuICByZWRpc1xuICAgIC5nZXQoaWQpXG4gICAgLnRoZW4ocGF5bG9hZCA9PiB7XG4gICAgICBpZiAoIXBheWxvYWQpIHtcbiAgICAgICAgcmVzLnN0YXR1cyg0MDQpLnNlbmQoXCJOb3QgRm91bmRcIik7XG4gICAgICB9IGVsc2Uge1xuICAgICAgICByZXMuc2VuZChKU09OLnBhcnNlKHBheWxvYWQpLmRhdGEpO1xuICAgICAgfVxuICAgIH0pXG4gICAgLmNhdGNoKGVyciA9PiB7XG4gICAgICBjb25zb2xlLmxvZyhlcnIpO1xuICAgIH0pO1xufSk7XG5cbmV4cG9ydCBkZWZhdWx0IGFwcDtcbiJdfQ==",
    "ast": null,
    "map": {
      "version": 3,
      "sources": [
        "app.js"
      ],
      "names": [
        "FILES_DIR",
        "join",
        "__dirname",
        "FORMATS",
        "URL",
        "process",
        "env",
        "existsSync",
        "mkdirSync",
        "setTimeout",
        "format",
        "render",
        "console",
        "log",
        "app",
        "redis",
        "REDIS",
        "on",
        "use",
        "json",
        "urlencoded",
        "extended",
        "getCanvasPath",
        "name",
        "id",
        "pageUrl",
        "launch",
        "args",
        "browser",
        "newPage",
        "page",
        "goto",
        "pdf",
        "path",
        "scale",
        "landscape",
        "printBackground",
        "close",
        "renderCanvas",
        "resolve",
        "reject",
        "open",
        "err",
        "fd",
        "code",
        "exists",
        "parseFromLiane",
        "canvas",
        "result",
        "basic_info",
        "location",
        "city",
        "commitments",
        "map",
        "c",
        "title",
        "causes",
        "principles",
        "p",
        "assets",
        "description",
        "team",
        "t",
        "role",
        "potential_voter",
        "profiles",
        "electorate",
        "profile",
        "territory",
        "post",
        "req",
        "res",
        "body",
        "status",
        "send",
        "fromLiane",
        "hash",
        "createHash",
        "update",
        "digest",
        "substr",
        "fromCache",
        "get",
        "then",
        "payload",
        "JSON",
        "parse",
        "key",
        "data",
        "set",
        "redirect",
        "catch",
        "error",
        "params"
      ],
      "mappings": ";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAAA;;;;AACA;;;;AACA;;;;AACA;;;;AACA;;;;AACA;;;;AACA;;;;;;AAEA,IAAMA,YAAY,eAAKC,IAAL,CAAUC,SAAV,EAAqB,UAArB,CAAlB;AACA,IAAMC,UAAU,CAAC,IAAD,EAAO,IAAP,CAAhB;AACA,IAAMC,MAAMC,QAAQC,GAAR,CAAYF,GAAZ,IAAmB,uBAA/B;;AAEA;;;AAGA,IAAI,CAAC,aAAGG,UAAH,CAAcP,SAAd,CAAL,EAA+B;AAC7B,eAAGQ,SAAH,CAAaR,SAAb;AACD;AACDS,oFAAW;AAAA;;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,iDACYN,OADZ;;AAAA;AAAA;AAAA;AAAA;AAAA;;AACEO,gBADF;AAAA;AAAA,iBAEDC,OAAO,IAAP,EAAa,SAAb,EAAwBD,MAAxB,CAFC;;AAAA;AAAA;AAAA;AAAA;;AAAA;AAAA;AAAA;;AAAA;AAAA;AAAA;AAAA;AAAA;;AAAA;AAAA;AAAA;;AAAA;AAAA;AAAA;;AAAA;AAAA;;AAAA;AAAA;AAAA;AAAA;;AAAA;;AAAA;AAAA;;AAAA;AAAA;;AAAA;AAITE,kBAAQC,GAAR,CAAY,sBAAZ;;AAJS;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,CAAX,IAKG,KALH;;AAOA,IAAMC,MAAM,wBAAZ;AACA,IAAMC,QAAQ,sBACZV,QAAQC,GAAR,CAAYU,KAAZ,IAAqB,yCADT,CAAd;;AAIAD,MAAME,EAAN,CAAS,SAAT,EAAoB,YAAM;AACxBL,UAAQC,GAAR,CAAY,2BAAZ;AACD,CAFD;;AAIAC,IAAII,GAAJ,CAAQ,qBAAWC,IAAX,EAAR;AACAL,IAAII,GAAJ,CAAQ,qBAAWE,UAAX,CAAsB,EAAEC,UAAU,IAAZ,EAAtB,CAAR;;AAEA,IAAMC,gBAAgB,SAAhBA,aAAgB,CAACC,IAAD,EAAOb,MAAP,EAAkB;AACtC,SAAO,eAAKT,IAAL,CAAUD,SAAV,cAA+BuB,IAA/B,SAAuCb,MAAvC,UAAP;AACD,CAFD;;AAIA,IAAMC;AAAA,uFAAS,kBAAea,EAAf,EAAmBD,IAAnB,EAAyBb,MAAzB;AAAA;AAAA;AAAA;AAAA;AAAA;AACPe,mBADO,GACGD,KAAKpB,MAAM,GAAN,GAAYoB,EAAjB,GAAsBpB,GADzB;AAAA;AAAA,mBAES,oBAAUsB,MAAV,CAAiB;AACrCC,oBAAM,CAAC,cAAD,EAAiB,0BAAjB;AAD+B,aAAjB,CAFT;;AAAA;AAEPC,mBAFO;AAAA;AAAA,mBAKMA,QAAQC,OAAR,EALN;;AAAA;AAKPC,gBALO;AAAA;AAAA,mBAMPA,KAAKC,IAAL,CAAUN,OAAV,CANO;;AAAA;AAAA;AAAA,mBAOPK,KAAKE,GAAL,CAAS;AACbC,oBAAMX,cAAcE,MAAMD,IAApB,EAA0Bb,MAA1B,CADO;AAEbA,4BAFa;AAGbwB,qBAAO,CAHM;AAIbC,yBAAW,IAJE;AAKbC,+BAAiB;AALJ,aAAT,CAPO;;AAAA;AAAA;AAAA,mBAcPR,QAAQS,KAAR,EAdO;;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,GAAT;;AAAA;AAAA;AAAA;AAAA,GAAN;;AAiBA,IAAMC;AAAA,uFAAe,kBAAed,EAAf,EAAmBD,IAAnB;AAAA;;AAAA;;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AACRb,4BADQ;AAAA;AAAA,6BAEI,sBAAY,UAAC6B,OAAD,EAAUC,MAAV,EAAqB;AACpD,qCAAGC,IAAH,CAAQnB,cAAcE,MAAMD,IAApB,EAA0Bb,MAA1B,CAAR,EAA2C,GAA3C,EAAgD,UAACgC,GAAD,EAAMC,EAAN,EAAa;AAC3D,8BAAID,OAAOA,IAAIE,IAAJ,KAAa,QAAxB,EAAkC;AAChCL,oCAAQ,KAAR;AACD,2BAFD,MAEO;AACLA,oCAAQ,IAAR;AACD;AACF,yBAND;AAOD,uBARoB,CAFJ;;AAAA;AAEXM,4BAFW;;AAAA,0BAWZA,MAXY;AAAA;AAAA;AAAA;;AAYfjC,8BAAQC,GAAR,iBAA0BH,MAA1B,kBAA4Cc,MAAMD,IAAlD;AAZe;AAAA,6BAaTZ,OAAOa,EAAP,EAAWD,IAAX,EAAiBb,MAAjB,CAbS;;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,oDACEP,OADF;;AAAA;AAAA;AAAA;AAAA;AAAA;;AAAA;;AAAA;AAAA;AAAA;AAAA;;AAAA;AAAA;AAAA;;AAAA;AAAA;AAAA;AAAA;AAAA;;AAAA;AAAA;AAAA;;AAAA;AAAA;AAAA;;AAAA;AAAA;;AAAA;AAAA;AAAA;AAAA;;AAAA;;AAAA;AAAA;;AAAA;AAAA;;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,GAAf;;AAAA;AAAA;AAAA;AAAA,GAAN;;AAkBA,IAAM2C,iBAAiB,SAAjBA,cAAiB,CAASC,MAAT,EAAiB;AACtC,MAAIC,oCAAcD,MAAd,CAAJ;AACA,MAAIC,OAAOC,UAAP,IAAqBD,OAAOC,UAAP,CAAkBC,QAA3C,EAAqD;AACnDF,WAAOC,UAAP,CAAkBC,QAAlB,GAA6BF,OAAOC,UAAP,CAAkBC,QAAlB,CAA2BC,IAA3B,CAAgC5B,IAA7D;AACD;AACD,MAAIyB,OAAOI,WAAP,IAAsBJ,OAAOI,WAAP,CAAmBA,WAA7C,EAA0D;AACxDJ,WAAOI,WAAP,GAAqBJ,OAAOI,WAAP,CAAmBA,WAAnB,CAA+BC,GAA/B,CAAmC;AAAA,aAAKC,EAAEC,KAAP;AAAA,KAAnC,CAArB;AACD;AACD,MAAIP,OAAOQ,MAAP,IAAiBR,OAAOQ,MAAP,CAAcA,MAAnC,EAA2C;AACzCR,WAAOQ,MAAP,GAAgBR,OAAOQ,MAAP,CAAcA,MAAd,CAAqBH,GAArB,CAAyB;AAAA,aAAKC,EAAEC,KAAP;AAAA,KAAzB,CAAhB;AACD;AACD,MAAIP,OAAOS,UAAP,IAAqBT,OAAOS,UAAP,CAAkBA,UAA3C,EAAuD;AACrDT,WAAOS,UAAP,GAAoBT,OAAOS,UAAP,CAAkBA,UAAlB,CAA6BJ,GAA7B,CAAiC;AAAA,aAAKK,EAAEH,KAAP;AAAA,KAAjC,CAApB;AACD;AACD,MAAIP,OAAOW,MAAP,IAAiBX,OAAOW,MAAP,CAAcA,MAAnC,EAA2C;AACzCX,WAAOW,MAAP,GAAgBX,OAAOW,MAAP,CAAcA,MAAd,CAAqBN,GAArB,CAAyB;AAAA,aAAKK,EAAEE,WAAP;AAAA,KAAzB,EAA6C3D,IAA7C,CAAkD,IAAlD,CAAhB;AACD;AACD,MAAI+C,OAAOa,IAAP,IAAeb,OAAOa,IAAP,CAAYA,IAA/B,EAAqC;AACnCb,WAAOa,IAAP,GAAcb,OAAOa,IAAP,CAAYA,IAAZ,CAAiBR,GAAjB,CAAqB;AAAA,aAAK,CAACS,EAAEvC,IAAH,EAASuC,EAAEC,IAAX,CAAL;AAAA,KAArB,CAAd;AACD;AACD,MAAIf,OAAOgB,eAAP,IAA0BhB,OAAOgB,eAAP,CAAuBC,QAArD,EAA+D;AAC7DjB,WAAOkB,UAAP,GAAoBlB,OAAOgB,eAAP,CAAuBC,QAAvB,CAAgCZ,GAAhC,CAAoC,mBAAW;AACjE,wCACKc,OADL;AAEEjB,kBAAUiB,QAAQC,SAAR,GAAoBD,QAAQC,SAAR,CAAkBlB,QAAlB,CAA2BC,IAA3B,CAAgC5B,IAApD,GAA2D;AAFvE;AAID,KALmB,CAApB;AAMD;AACD,SAAOyB,MAAP;AACD,CA7BD;;AA+BAlC,IAAIuD,IAAJ,CAAS,GAAT,EAAc,UAACC,GAAD,EAAMC,GAAN,EAAc;AAC1B;AACA,MAAI,CAACD,IAAIE,IAAJ,CAASzB,MAAd,EAAsB;AACpBwB,QAAIE,MAAJ,CAAW,GAAX,EAAgBC,IAAhB,CAAqB,kCAArB;AACD;;AAED,MAAI3B,SAASuB,IAAIE,IAAJ,CAASzB,MAAtB;;AAEA,MAAIuB,IAAIE,IAAJ,CAASG,SAAb,EAAwB;AACtB5B,aAASD,eAAewB,IAAIE,IAAJ,CAASzB,MAAxB,CAAT;AACD;;AAED,MAAM6B,OAAO,iBACVC,UADU,CACC,MADD,EAEVC,MAFU,CAEH,yBAAe/B,MAAf,CAFG,EAGVgC,MAHU,CAGH,KAHG,CAAb;;AAKA,MAAMvD,KAAKoD,KAAKI,MAAL,CAAY,CAAZ,EAAe,CAAf,CAAX;AACA,MAAIC,YAAY,KAAhB;;AAEAlE,QAAMmE,GAAN,CAAU1D,EAAV,EAAc2D,IAAd,CAAmB,mBAAW;AAC5BF,gBAAY,CAAC,CAACG,OAAd;AACAA,cAAUA,UACNC,KAAKC,KAAL,CAAWF,OAAX,CADM,GAEN;AACE5D,YADF;AAEE+D,WAAKX,IAFP;AAGEY,YAAMzC;AAHR,KAFJ;AAOA,QAAI,CAACkC,SAAL,EAAgB;AACdlE,YAAM0E,GAAN,CAAUL,QAAQ5D,EAAlB,EAAsB,yBAAe4D,OAAf,CAAtB;AACD;AACD9C,iBAAa8C,QAAQ5D,EAArB,EACG2D,IADH,CACQ,YAAM;AACV,UAAIb,IAAIE,IAAJ,CAASrD,IAAb,EAAmB;AACjBoD,YAAIG,IAAJ,CAAS,EAAElD,IAAI4D,QAAQ5D,EAAd,EAAT;AACD,OAFD,MAEO;AACL+C,YAAImB,QAAJ,OAAiBN,QAAQ5D,EAAzB;AACD;AACF,KAPH,EAQGmE,KARH,CAQS,eAAO;AACZ/E,cAAQC,GAAR,CAAY6B,GAAZ;AACA6B,UAAIG,IAAJ,CAAS,EAAEkB,OAAO,IAAT,EAAT;AACD,KAXH;AAYD,GAxBD;AAyBD,CA7CD;;AA+CA9E,IAAIoE,GAAJ,CAAQ,0BAAR,EAAoC,UAACZ,GAAD,EAAMC,GAAN,EAAc;AAChD,MAAM/C,KAAK8C,IAAIuB,MAAJ,CAAW,CAAX,CAAX;AACA9E,QACGmE,GADH,CACO1D,EADP,EAEG2D,IAFH,CAEQ,mBAAW;AACf,QAAI,CAACC,OAAL,EAAc;AACZb,UAAIE,MAAJ,CAAW,GAAX,EAAgBC,IAAhB,CAAqB,WAArB;AACD,KAFD,MAEO;AACLH,UAAIG,IAAJ,CAASW,KAAKC,KAAL,CAAWF,OAAX,EAAoBI,IAA7B;AACD;AACF,GARH,EASGG,KATH,CASS,eAAO;AACZ/E,YAAQC,GAAR,CAAY6B,GAAZ;AACD,GAXH;AAYD,CAdD;;kBAgBe5B,G",
      "file": "app.js",
      "sourceRoot": "/canvas/src",
      "sourcesContent": [
        "import express from \"express\";\nimport bodyParser from \"body-parser\";\nimport Redis from \"ioredis\";\nimport puppeteer from \"puppeteer\";\nimport crypto from \"crypto\";\nimport fs from \"fs\";\nimport path from \"path\";\n\nconst FILES_DIR = path.join(__dirname, \"../files\");\nconst FORMATS = [\"A3\", \"A2\"];\nconst URL = process.env.URL || \"http://localhost:8000\";\n\n/*\n * First render\n */\nif (!fs.existsSync(FILES_DIR)) {\n  fs.mkdirSync(FILES_DIR);\n}\nsetTimeout(async () => {\n  for (const format of FORMATS) {\n    await render(null, \"default\", format);\n  }\n  console.log(\"Default PDF rendered\");\n}, 10000);\n\nconst app = express();\nconst redis = new Redis(\n  process.env.REDIS || \"redis://localhost:6379/electoral-canvas\"\n);\n\nredis.on(\"connect\", () => {\n  console.log(\"Connected to redis server\");\n});\n\napp.use(bodyParser.json());\napp.use(bodyParser.urlencoded({ extended: true }));\n\nconst getCanvasPath = (name, format) => {\n  return path.join(FILES_DIR, `canvas-${name}-${format}.pdf`);\n};\n\nconst render = async function(id, name, format) {\n  const pageUrl = id ? URL + \"/\" + id : URL;\n  const browser = await puppeteer.launch({\n    args: [\"--no-sandbox\", \"--disable-setuid-sandbox\"]\n  });\n  const page = await browser.newPage();\n  await page.goto(pageUrl);\n  await page.pdf({\n    path: getCanvasPath(id || name, format),\n    format,\n    scale: 1,\n    landscape: true,\n    printBackground: true\n  });\n  await browser.close();\n};\n\nconst renderCanvas = async function(id, name) {\n  for (const format of FORMATS) {\n    const exists = await new Promise((resolve, reject) => {\n      fs.open(getCanvasPath(id || name, format), \"r\", (err, fd) => {\n        if (err && err.code === \"ENOENT\") {\n          resolve(false);\n        } else {\n          resolve(true);\n        }\n      });\n    });\n    if (!exists) {\n      console.log(`Generating ${format} PDF for ${id || name}`);\n      await render(id, name, format);\n    }\n  }\n};\n\nconst parseFromLiane = function(canvas) {\n  let result = { ...canvas };\n  if (result.basic_info && result.basic_info.location) {\n    result.basic_info.location = result.basic_info.location.city.name;\n  }\n  if (result.commitments && result.commitments.commitments) {\n    result.commitments = result.commitments.commitments.map(c => c.title);\n  }\n  if (result.causes && result.causes.causes) {\n    result.causes = result.causes.causes.map(c => c.title);\n  }\n  if (result.principles && result.principles.principles) {\n    result.principles = result.principles.principles.map(p => p.title);\n  }\n  if (result.assets && result.assets.assets) {\n    result.assets = result.assets.assets.map(p => p.description).join(\"; \");\n  }\n  if (result.team && result.team.team) {\n    result.team = result.team.team.map(t => [t.name, t.role]);\n  }\n  if (result.potential_voter && result.potential_voter.profiles) {\n    result.electorate = result.potential_voter.profiles.map(profile => {\n      return {\n        ...profile,\n        location: profile.territory ? profile.territory.location.city.name : \"\"\n      };\n    });\n  }\n  return result;\n};\n\napp.post(\"/\", (req, res) => {\n  // Validate\n  if (!req.body.canvas) {\n    res.status(500).send(\"You must provide a canvas object\");\n  }\n\n  let canvas = req.body.canvas;\n\n  if (req.body.fromLiane) {\n    canvas = parseFromLiane(req.body.canvas);\n  }\n\n  const hash = crypto\n    .createHash(\"sha1\")\n    .update(JSON.stringify(canvas))\n    .digest(\"hex\");\n\n  const id = hash.substr(0, 7);\n  let fromCache = false;\n\n  redis.get(id).then(payload => {\n    fromCache = !!payload;\n    payload = payload\n      ? JSON.parse(payload)\n      : {\n          id,\n          key: hash,\n          data: canvas\n        };\n    if (!fromCache) {\n      redis.set(payload.id, JSON.stringify(payload));\n    }\n    renderCanvas(payload.id)\n      .then(() => {\n        if (req.body.json) {\n          res.send({ id: payload.id });\n        } else {\n          res.redirect(`/${payload.id}`);\n        }\n      })\n      .catch(err => {\n        console.log(err);\n        res.send({ error: true });\n      });\n  });\n});\n\napp.get(/^\\/(\\b[0-9a-f]{5,40}\\b)$/, (req, res) => {\n  const id = req.params[0];\n  redis\n    .get(id)\n    .then(payload => {\n      if (!payload) {\n        res.status(404).send(\"Not Found\");\n      } else {\n        res.send(JSON.parse(payload).data);\n      }\n    })\n    .catch(err => {\n      console.log(err);\n    });\n});\n\nexport default app;\n"
      ]
    },
    "mtime": 1525786590000
  }
}